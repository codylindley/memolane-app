m.utilities={breakURLCache:function(f){return f+"?breakCache="+(new Date).getTime()},browser:{init:function(){this.browser=this.searchString(this.dataBrowser)||$.i18n.t("An unknown browser","this message informs the user that we weren't able to identify the browser they're using");this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||$.i18n.t("an unknown version","this message informs the user that we weren't able to identify the version of the browser they're using");
this.OS=this.searchString(this.dataOS)||$.i18n.t("an unknown OS","this message informs the user that we weren't able to identify the operating system they're using")},searchString:function(f){for(var a=0;a<f.length;a++){var b=f[a].string,c=f[a].prop;this.versionSearchString=f[a].versionSearch||f[a].identity;if(b){if(b.indexOf(f[a].subString)!=-1)return f[a].identity}else if(c)return f[a].identity}},searchVersion:function(f){var a=f.indexOf(this.versionSearchString);return a==-1?void 0:parseFloat(f.substring(a+
this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",
identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,
subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]},capitalizeString:function(f){return f.charAt(0).toUpperCase()+f.slice(1)},wait:function(f){return $.Deferred(function(a){setTimeout(a.resolve,f)})},dateFormatRelative:function(f){var f=new Date(f*1E3),a=new Date,b="",b=(a.getTime()-f.getTime())/6E4,c=a.getHours()*60+a.getMinutes();return b=f.getYear()<a.getYear()?this.dateFormat(f,
"mmm d, yyyy",false):b-c>1440?this.dateFormat(f,"mmm d",false):b-c>0?$.i18n.t("yesterday"):Math.floor(b)<=0?$.i18n.t("seconds ago","indicating that something happened within the last 60 seconds"):b<60?$.i18n.t("%s min ago","number of minutes since something",[Math.floor(b)]):$.i18n.t("%s hrs ago","number of hours since something",[Math.floor(b/60)])},cleanMemoId:function(f){return f.replace(/[:=-_@\.\/]/g,"")},dateFormat:function(){var f=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,
a=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,b=/[^-+\dA-Z]/g,c=function(a,b){a=String(a);for(b=b||2;a.length<b;)a="0"+a;return a};return function(d,e,g){var h,p,k;d==0&&(d=1);k={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",shortDateWithZero:"mm/dd/yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",fullDatePlusTime:"dddd, mmmm d - h:MM tt",fullDateAndTime:"mm/dd/yyyy hh:MM:ss TT",
dateTimeForMemoChangeDate:"m-d-yyyy hh:MM:ss TT",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};h=[$.i18n.t("Sun","shorthand for Sunday"),$.i18n.t("Mon","shorthand for Monday"),$.i18n.t("Tue","shorthand for Tuesday"),$.i18n.t("Wed","shorthand for Wednesday"),$.i18n.t("Thu","shorthand for Thursday"),$.i18n.t("Fri","shorthand for Friday"),$.i18n.t("Sat","shorthand for Saturday"),
$.i18n.t("Sunday"),$.i18n.t("Monday"),$.i18n.t("Tuesday"),$.i18n.t("Wednesday"),$.i18n.t("Thursday"),$.i18n.t("Friday"),$.i18n.t("Saturday")];p=[$.i18n.t("Jan","shorthand for January"),$.i18n.t("Feb","shorthand for February"),$.i18n.t("Mar","shorthand for March"),$.i18n.t("Apr","shorthand for April"),$.i18n.t("May","shorthand for May"),$.i18n.t("Jun","shorthand for June"),$.i18n.t("Jul","shorthand for July"),$.i18n.t("Aug","shorthand for August"),$.i18n.t("Sep","shorthand for September"),$.i18n.t("Oct",
"shorthand for October"),$.i18n.t("Nov","shorthand for November"),$.i18n.t("Dec","shorthand for December"),$.i18n.t("January"),$.i18n.t("February"),$.i18n.t("March"),$.i18n.t("April"),$.i18n.t("May"),$.i18n.t("June"),$.i18n.t("July"),$.i18n.t("August"),$.i18n.t("September"),$.i18n.t("October"),$.i18n.t("November"),$.i18n.t("December")];arguments.length==1&&Object.prototype.toString.call(d)=="[object String]"&&!/\d/.test(d)&&(e=d,d=void 0);d=d?new Date(d):new Date;if(isNaN(d))throw SyntaxError("invalid date");
e=String(k[e]||e||k["default"]);e.slice(0,4)=="UTC:"&&(e=e.slice(4),g=true);var l=g?"getUTC":"get";k=d[l+"Date"]();var n=d[l+"Day"](),o=d[l+"Month"](),r=d[l+"FullYear"](),q=d[l+"Hours"](),s=d[l+"Minutes"](),v=d[l+"Seconds"](),l=d[l+"Milliseconds"](),t=g?0:d.getTimezoneOffset(),u={d:k,dd:c(k),ddd:h[n],dddd:h[n+7],m:o+1,mm:c(o+1),mmm:p[o],mmmm:p[o+12],yy:String(r).slice(2),yyyy:r,h:q%12||12,hh:c(q%12||12),H:q,HH:c(q),M:s,MM:c(s),s:v,ss:c(v),l:c(l,3),L:c(l>99?Math.round(l/10):l),t:q<12?"a":"p",tt:q<
12?"am":"pm",T:q<12?"A":"P",TT:q<12?"AM":"PM",Z:g?"UTC":(String(d).match(a)||[""]).pop().replace(b,""),o:(t>0?"-":"+")+c(Math.floor(Math.abs(t)/60)*100+Math.abs(t)%60,4),S:["th","st","nd","rd"][k%10>3?0:(k%100-k%10!=10)*k%10]};return e.replace(f,function(a){return a in u?u[a]:a.slice(1,a.length-1)})}}(),convertURLstringsToAnchors:function(f,a){var b='<a href="$1" target="_blank">$1</a>';a&&(b='<span class="aStyle">$1</span>');return f.replace(/((http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:\/~\+#]*[\w\-\@?^=%&amp;\/~\+#])?)/ig,
b)},linkify:function(f){return f.replace(/(\()((?:ht|f)tps?:\/\/[a-z0-9\-._~!$&'()*+,;=:\/?#[\]@%]+)(\))|(\[)((?:ht|f)tps?:\/\/[a-z0-9\-._~!$&'()*+,;=:\/?#[\]@%]+)(\])|(\{)((?:ht|f)tps?:\/\/[a-z0-9\-._~!$&'()*+,;=:\/?#[\]@%]+)(\})|(<|&(?:lt|#60|#x3c);)((?:ht|f)tps?:\/\/[a-z0-9\-._~!$&'()*+,;=:\/?#[\]@%]+)(>|&(?:gt|#62|#x3e);)|((?:^|[^=\s'"\]])\s*['"]?|[^=\s]\s+)(\b(?:ht|f)tps?:\/\/[a-z0-9\-._~!$'()*+,;=:\/?#[\]@%]+(?:(?!&(?:gt|#0*62|#x0*3e);|&(?:amp|apos|quot|#0*3[49]|#x0*2[27]);[.!&',:?;]?(?:[^a-z0-9\-._~!$&'()*+,;=:\/?#[\]@%]|$))&[a-z0-9\-._~!$'()*+,;=:\/?#[\]@%]*)*[a-z0-9\-_~$()*+=\/#[\]@%])/img,
'$1$4$7$10$13<a href="$2$5$8$11$14">$2$5$8$11$14</a>$3$6$9$12')},linkifyHtml:function(f){f=f.replace(/&amp;apos;/g,"&#39;");section_html_pattern=/([^<]+(?:(?!<a\b)<[^<]*)*|(?:(?!<a\b)<[^<]*)+)|(<a\b[^>]*>[^<]*(?:(?!<\/a\b)<[^<]*)*<\/a\s*>)/ig;return f.replace(section_html_pattern,_linkify_html_callback)},urlHash:{set:function(f){var f=$.toQueryParams(f),a=$.toQueryParams(location.hash),b;for(b in f)a[b]=f[b];return $.toQueryString(a)},remove:function(f){var f=$.toQueryParams(f),a=$.toQueryParams(location.hash),
b={},c;for(c in a)f[c]==void 0&&(b[c]=a[c]);return $.toQueryString(b)},get:function(f){var a;a=m.embeddedParams&&typeof m.embeddedParams.memo_hash!="undefined"&&m.embeddedParams.memo_hash!=""?m.embeddedParams.memo_hash:location.hash;return typeof f=="undefined"?$.toQueryParams(a):$.toQueryParams(a)[f]},go:function(f){location.hash=f.substr(0,1)=="#"?f:"#"+f;return false}},getMessages:function(){$(window).bind("message",function(f){for(name in f.originalEvent.data){if(name.match(/custom_hostname/))m.embeddedParams.custom_hostname=
f.originalEvent.data[name];if(name.match(/custom_pathname/))m.embeddedParams.custom_pathname=f.originalEvent.data[name]}$(window).unbind("message");return true})},fixedModulus:function(f,a){return(f%a+a)%a}};
m.globalTemplates={dialogs:{removeLane:'<div id="" class="memolaneDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">'+$.i18n.t("Remove Lane")+'</div>\t\t<div class="close closeMemolaneDialog cancelAddingBtn">'+$.i18n.t("cancel","close remove lane dialog")+'</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<p><strong>'+$.i18n.t("Are you sure you want to remove")+' "${title}" '+$.i18n.t("from Memolane?")+"</strong></p>\t\t<p>"+$.i18n.t("All settings will be lost, and any work you've put into curating this lane will be permanently gone!")+
'</p>\t\t<p><a href="#" class="btn-red float-left removeConfirm close">'+$.i18n.t("Yes, REMOVE the lane")+'</a> <a href="#" class="secondaryAction float-left close">'+$.i18n.t("No, I don't want that")+"</a></p>\t</div></div>",removeLaneContributor:'<div id="" class="memolaneDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">'+$.i18n.t("Stop Contributing?")+'</div>\t\t<div class="close closeMemolaneDialog cancelAddingBtn">'+$.i18n.t("cancel","close remove lane contributor dialog")+'</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<p><strong>'+
$.i18n.t("Are you sure you wish to stop contributing to this lane:")+' ${lane_title}</strong></p>\t\t<p><a href="#" class="btn-red float-left removeConfirm close">'+$.i18n.t("Remove me as a contributor from this lane")+'</a> <a href="#" class="secondaryAction float-left close">'+$.i18n.t("No, I don't want that")+"</a></p>\t</div></div>",addFriend:'<div id="" class="memolaneDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">'+$.i18n.t("Friend Request Sent")+'</div>\t\t<div class="close closeMemolaneDialog cancelAddingBtn">'+
$.i18n.t("close","close dialog")+'</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<p><strong>'+$.i18n.t("Cross your fingers!")+"</strong></p>\t\t<p>"+$.i18n.t("You just sent a friend request to")+' ${first_name} ${last_name}.</p>\t\t<p><a href="#" class="btn-green float-left close">'+$.i18n.t("OK","ok button for dialog")+"</a></p>\t</div></div>",acceptFriendRequest:'<div id="" class="memolaneDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">Accepted Friend Request</div>\t\t<div class="close closeMemolaneDialog cancelAddingBtn">'+
$.i18n.t("close","close dialog")+'</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<p><strong>'+$.i18n.t("We're friends!</strong>")+"</p>\t\t<p>"+$.i18n.t("You just accepted <strong>${full_name}'s</strong> friend request!")+"</p>\t\t<p>"+$.i18n.t('You can now see each other\'s "Friends Only" memos.')+'</p>\t\t<p><a href="#" class="btn-green float-left close">'+$.i18n.t("OK","ok button for dialog")+"</a></p>\t</div></div>",rejectFriendRequest:'<div id="" class="memolaneDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">'+
$.i18n.t("Ignored Friend Request")+'</div>\t\t<div class="close closeMemolaneDialog cancelAddingBtn">'+$.i18n.t("close","close dialog")+'</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<p><strong>'+$.i18n.t("It's not you, it's me")+"</strong></p>\t\t<p>"+$.i18n.t("You just ignored <strong>${full_name}'s</strong> friend request.")+"</p>\t\t<p>"+$.i18n.t("At this point, you can only see each other's public memos.")+"</p>\t</div></div>",cancelFriendRequest:'<div id="" class="memolaneDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">'+
$.i18n.t("Cancelled Friend Request")+'</div>\t\t<div class="close closeMemolaneDialog cancelAddingBtn">'+$.i18n.t("close","close dialog")+'</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<p><strong>'+$.i18n.t("It's not you, it's me")+"</strong></p>\t\t<p>"+$.i18n.t("You just cancelled your request for <strong>${full_name}'s</strong> friendship.")+"</p>\t\t<p>"+$.i18n.t("At this point, you can only see each other's public memos.")+"</p>\t</div></div>",removeFriend:'<div id="" class="memolaneDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">'+
$.i18n.t("Remove Friend?")+'</div>\t\t<div class="close closeMemolaneDialog cancelAddingBtn">'+$.i18n.t("cancel","close remove friend dialog")+'</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<p><strong>'+$.i18n.t("Are you sure you want to cancel your Memolane friendship with")+" ${full_name}</strong>?</p>\t\t<p>"+$.i18n.t("You and")+" ${full_name} "+$.i18n.t("will lose the ability to see each other's \"Friends Only\" memos and contribute to each other's lanes.")+
'</p>\t\t<p><a href="#" class="btn-red float-left removeConfirm close">'+$.i18n.t("Yes, REMOVE the friend")+'</a> <a href="#" class="secondaryAction float-left close">'+$.i18n.t("No, I don't want that")+"</a></p>\t</div></div>",genericListOfUsersDialog:'<div id="list-users" class="memolaneDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">${$item.dialogTitle}</div>\t\t<div class="close closeMemolaneDialog cancelAddingBtn">'+$.i18n.t("close","close dialog")+'</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent"><ul>\t{{each liked_by}}\t\t<li class="clearfix">\t\t<a href="/${user.username}" title="'+
$.i18n.t("view user profile")+'">\t\t<img src="/${user.username}/images" height="20" width="20" class="search-result-icon search-user-avatar" alt="'+$.i18n.t("top bar avatar","this labels the lane avatar")+'"/>\t\t<span class="list-user-fullname-username">\t\t${user.full_name}\t\t<span class="list-users-username">(${user.username})</span>\t\t<span class="list-users-date">'+$.i18n.t("Liked ")+" ${m.utilities.dateFormatRelative(timestamp)}</span>\t\t</span> </a></li>\t{{/each}}</ul>\t</div></div>"}};
m.deviceIsIpad=navigator.userAgent.match(/iPad/i)!=null;m.deviceIsIphone=navigator.userAgent.match(/iPhone/i)!=null;m.deviceIsAndroid=navigator.userAgent.toLowerCase().indexOf("android")>-1;m.isIE9=$.browser.version==="9.0"?true:false;m.isIE8=$.browser.version==="8.0"?true:false;m.clickOrTouchStart=Modernizr.touch?"touchstart":"click";m.clickOrTouchEnd=Modernizr.touch?"touchend":"click";m.mouseEnterOrTouchStart=Modernizr.touch?"touchstart":"mouseenter";
m.mouseLeaveOrTouchEnd=Modernizr.touch?"touchend":"mouseleave";m.mouseDownOrTouchStart=Modernizr.touch?"touchstart":"mousedown";m.mouseMoveOrTouchMove=Modernizr.touch?"touchmove":"mousemove";m.mouseUpOrTouchEnd=Modernizr.touch?"touchend":"mouseup";m.mouseOutOrTouchEnd=Modernizr.touch?"touchend":"mouseout";m.mouseOverOrTouchStart=Modernizr.touch?"touchstart":"mouseover";
m.language=function(f,a){return{$langSettings:a("#language-settings"),initialize:function(){this.$langSettings.bind(m.clickOrTouchStart,this.openLangSettingsDialog)},openLangSettingsDialog:function(){a('<div id="language-settings-dialog" class="memolaneDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">'+a.i18n.t("Language Settings")+'</div>\t\t<div class="close closeMemolaneDialog cancelAddingBtn">'+a.i18n.t("cancel","cancel dialog actions")+'</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t<p>'+
a.i18n.t("Select your preferred language:")+'</p>\t<ul>\t<li><label id="en-flag"><input type="radio" value="en" name="language-selected" /></li></label>\t<li><label id="ja-flag"><input type="radio" value="ja" name="language-selected" /></li></label>\t</ul> \t<div class="clear"></div>\t<p><a href="#" id="change-language-btn" class="btn-green float-left close">'+a.i18n.t("OK","ok button for dialog")+"</a></p>\t</div></div>").find("input").each(function(){a(this).val()===m.currentLanguage&&a(this).prop("checked",
true)}).end().find("#change-language-btn").click(function(){var b=a(this).closest(".dialogContent").find("input:checked").val(),c=f.location.hash||"";f.location.href=f.location.href.split("#")[0].split("?")[0]+"?lang="+b+c}).end().lightbox_me({centered:true});return false}}}(this,jQuery,this.undefined);m.language.initialize();
m.topBar=function(f,a){return{initialize:function(){a(f).bind("resize",function(){m.topBar.runLayout()});this.runLayout()},runLayout:function(){var b=a("body"),c=a("#header"),d=a("#tb-search input");b.width()<1E3&&(c.removeClass("more1024").addClass("less1024"),d.attr("value",a.i18n.t("Search","term used to label search box")));b.width()>=1E3&&(c.removeClass("less1024").addClass("more1024"),m.currentLane?d.attr("value",a.i18n.t("Search memos, lanes & users")):d.attr("value",a.i18n.t("Search lanes & users")))}}}(this,
jQuery,this.undefined);m.topBar.initialize();
m.topBarDropDowns=function(f,a){return{$tbDropDowns:a(".tb-dropdown"),$dropDowns:a(".dd-container"),$dropDownsListContent:a(".dd-list-content"),jScrollGutter:5,loaderClass:"small-loader-on-grey",ddListHeight:350,ddWaitHeight:100,friendsContext:"main",friendRequests:0,hashOnPageLoad:window.location.hash.substring(1).toLowerCase(),initialize:function(){var b=this;this.$tbDropDowns.bind(m.clickOrTouchStart,a.proxy(this.initDD,this));this.$dropDownsListContent.jScrollPane({verticalGutter:b.jScrollGutter});a(document).bind(m.clickOrTouchStart,
a.proxy(this.closeAllDropdownsFromClickOff,this));this.$dropDownsListContent.delegate(".dd-friends-remove",m.clickOrTouchStart,function(){b.removeFriendDialog(a(this));return false}).delegate(".dd-friends-pending-remove",m.clickOrTouchStart,function(c){b.removeFriendPendingRequest(c,a(this));return false}).delegate(".dd-friends-friend-yes",m.clickOrTouchStart,function(c){b.acceptFriendRequest(c,a(this));return false}).delegate(".dd-friends-friend-no",m.clickOrTouchStart,function(c){b.rejectFriendRequest(c,
a(this));return false}).delegate(".dd-lanes-remove",m.clickOrTouchStart,function(){b.removeLaneDialog(a(this));return false}).delegate(".dd-lanes-fav-remove",m.clickOrTouchStart,function(){b.removeLaneFav(a(this));return false}).delegate(".dd-lanes-edit",m.clickOrTouchStart,function(){b.editLane(a(this))}).delegate(".dd-lanes-remove-contrib",m.clickOrTouchStart,function(){b.removeLaneContributorDialog(a(this));return false});a(".dd-friends-types").delegate("a",m.clickOrTouchStart,function(a){b.toggleFriendsTypes(a);
return false});this.getNewNewsNumber();this.getIncomingFriendsRequestsNumber();if(this.hashOnPageLoad){var c=m.utilities.urlHash.get("topBar");c&&setTimeout(function(){switch(c){case "getFriends":a("#dd-friends-button").trigger("click");break;case "getNews":a("#dd-news-button").trigger("click");break;case "getLanes":a("#dd-lanes-button").trigger("click")}},1500)}a("#dd-lanes .smallButtonBar li a").bind(m.clickOrTouchStart,function(){var c=a(this);if(c.hasClass("smallButtonActive"))return false;var e=
a(this).parent().attr("id");c.closest("ul").find("a").removeClass("smallButtonActive").end().end().addClass("smallButtonActive");a("#dd-fav-lanes,#dd-your-lanes").hide();a("#"+e.slice(0,e.indexOf("-btn"))).addClass("visibility-hidden").show().height(100);c=a("#"+e.slice(0,e.indexOf("-btn"))+" ul").height();c=c>400?400:c;a("#"+e.slice(0,e.indexOf("-btn"))).show().css("height",c+"px").removeClass(b.loaderClass).jScrollPane({verticalGutter:b.jScrollGutter}).removeClass("visibility-hidden").find(".jspVerticalBar").removeClass("visibility-hidden");
return false})},initDD:function(b){var b=a(b.currentTarget),c=b.attr("data-ddid"),d=a("#"+c),e=a(".dd-container");if(d.css("visibility")==="visible")return this.closeDropdown(b,d),false;else{switch(c){case "dd-friends":this.getFriends();break;case "dd-lanes":this.getLanes();break;case "dd-news":this.getNews()}e.filter(function(){return a(this).css("visibility")=="visible"}).length&&this.closeAllDropdowns();this.positionDropdown(b,d)}},getNews:function(){var b=this,c=a("#dd-news");c.find(".dd-list-content").addClass(b.loaderClass).css("height",
b.ddWaitHeight).find("ul").empty().end().find(".jspVerticalBar").addClass("visibility-hidden");b.getNewNewsNumber();a.ajax({url:"/feed",cache:false,success:function(d){for(var e=0,g=d.feed.length,h={},f=h="",k="";e<g;)h=d.feed[e],h.date_str=m.utilities.dateFormatRelative(h.created_at),k=b.templates.news[h.type],h=a("<div />").append(a.tmpl(k,h)).html(),f=h+f,e++;g===0&&(f='<li class="no-dd-list-item">'+a.i18n.t("No news yet")+"</li>");c.find(".dd-list-content ul").html(f);d=c.find(".dd-list-content ul").height();
d=d>b.ddListHeight?b.ddListHeight:d;c.find(".dd-list-content").removeClass(b.loaderClass).css("height",d+"px").jScrollPane({verticalGutter:b.jScrollGutter}).find(".jspVerticalBar").removeClass("visibility-hidden")}})},getNewNewsNumber:function(){var b=4;a.ajax({url:"/feed/volume",success:function(c){b=parseInt(c.volume);b>0?a("#tb-news-count").css("display","inline").children("span").text(b):a("#tb-news-count").css("display","none")}})},hideNewNewsIndicator:function(){var b=a("#tb-news-count");b.css("display")!=
"none"&&b.fadeOut()},getFriends:function(){var b=this;a("#dd-friends");var c=a(".dd-friends-main-pane"),d=a(".dd-friends-pending-pane");a(".dd-friends-types .smallButtonBar a").removeClass("smallButtonActive");a("#dd-friends-main").addClass("smallButtonActive");d.show().find("ul").empty();c.show();c.css("height",b.ddWaitHeight).addClass(b.loaderClass).find("ul").empty().end().find(".jspVerticalBar").addClass("visibility-hidden");a.ajax({url:"/friends/all",cache:false,success:function(e){var g=0,h=
{},h="",f={},k="",l="",n="",l=e.length,n=n=0,o={pending:0,requested:0,accepted:0};for(content={pending:"",accepted:"",requested:""};g<l;)h=e[g],n=h.status,o[n]++,f=b.templates.friends[n],h=a("<div />").append(a.tmpl(f,h)).html(),content[n]+=h,g++;o.requested||o.accepted?(k+=content.requested,k+=content.accepted):k='<li class="no-dd-list-item">'+a.i18n.t("You got peeps, everyone does. Why not make a friend. You can use search to find Memolane users to befriend. Or visit a user's dashboard and request some good old-fashioned friendship.")+
"</li>";l=o.pending?content.pending:'<li class="no-dd-list-item">'+a.i18n.t("At this time you haven't requested any friendships. Don't be shy, Memolane is best enjoyed with friends.")+"</li>";c.find("ul").html(k);n=c.find("ul").height();n=n>b.ddListHeight?b.ddListHeight:n;c.css("height",n+"px").removeClass(b.loaderClass).jScrollPane({verticalGutter:b.jScrollGutter}).find(".jspVerticalBar").removeClass("visibility-hidden");d.find("ul").html(l);n=d.find("ul").height();n=n>b.ddListHeight?b.ddListHeight:
n;d.hide().css("height",n+"px").removeClass(b.loaderClass).jScrollPane({verticalGutter:b.jScrollGutter}).find(".jspVerticalBar").removeClass("visibility-hidden");b.setNewFriendsIndicator(o.requested)}})},getIncomingFriendsRequestsNumber:function(){var b=this;a.ajax({url:"/friends/requested",cache:false,success:function(a){b.setNewFriendsIndicator(a.length)}})},setNewFriendsIndicator:function(b){this.friendRequests=b;b>0?a("#tb-friends-count").css("display","inline").children("span").text(b):a("#tb-friends-count").css("display",
"none")},toggleFriendsTypes:function(b){var c=a(b.target),d=c.attr("id").replace("dd-","");this.friendsContext=d;a("#dd-friends .dd-list-content").hide();a(".dd-"+d+"-pane").show();a(".dd-friends-types .smallButtonBar a").removeClass("smallButtonActive");c.addClass("smallButtonActive");".dd-"+d+"-pane"===".dd-friends-pending-pane"&&a(".dd-friends-pending-pane").data("jsp").reinitialise();b.preventDefault()},removeFriendDialog:function(b){var c=this,d={first_name:b.attr("data-first_name"),last_name:b.attr("data-last_name"),
full_name:b.attr("data-full_name"),username:b.attr("data-username")},b=a.tmpl(m.globalTemplates.dialogs.removeFriend,d);b.find(".removeConfirm").bind(m.clickOrTouchEnd,{something:"other"},function(a){m.dashboard?m.dashboard.removeFriend(d.username):c.removeFriend(d.username);a.preventDefault()});b.lightbox_me({centered:true})},removeFriend:function(b){var c=this;a.ajax({type:"delete",url:"/friends/"+b,success:function(){c.getFriends()}})},rejectFriendRequest:function(b,c){var d={first_name:c.attr("data-first_name"),
last_name:c.attr("data-last_name"),full_name:c.attr("data-full_name"),username:c.attr("data-username")};$dialog=a.tmpl(m.globalTemplates.dialogs.rejectFriendRequest,d);$dialog.lightbox_me({centered:true});m.dashboard?m.dashboard.removeFriend(d.username):this.removeFriend(d.username);this.getFriends();this.setNewFriendsIndicator(this.friendRequests-1)},acceptFriendRequest:function(b,c){var d={username:c.attr("data-username"),first_name:c.attr("data-first_name"),last_name:c.attr("data-last_name"),full_name:c.attr("data-full_name")};
m.dashboard?m.dashboard.acceptFriend(d.username):a.ajax({type:"post",cache:false,url:"/friends/"+d.username+"/accept",success:function(){$dialog=a.tmpl(m.globalTemplates.dialogs.acceptFriendRequest,d);$dialog.lightbox_me({centered:true})}});this.getFriends();this.setNewFriendsIndicator(this.friendRequests-1)},removeFriendPendingRequest:function(a,c){var d=c.data("username");m.dashboard?m.dashboard.removeFriend(d):this.removeFriend(d);this.getFriends()},getLanes:function(){var b=this,c=a("#dd-lanes"),
d=a("#dd-your-lanes");a("#dd-your-lanes-btn a").addClass("smallButtonActive");a("#dd-fav-lanes-btn a").removeClass("smallButtonActive");a("#dd-fav-lanes").hide().find("ul").empty();d.show().css("height",b.ddWaitHeight).addClass(b.loaderClass).find("ul").empty().end().find(".jspVerticalBar").addClass("visibility-hidden");a.ajax({url:"/"+m.currentUser.username+"/lanes",cache:false,success:function(e){e.length?a.tmpl(b.templates.lanes.main,e).appendTo(c.find("#dd-your-lanes ul")):a('<li class="no-dd-list-item">'+
a.i18n.t('Start creating a lane by clicking on the "New Lane" button above.')+"</li>").appendTo(c.find("#dd-your-lanes ul"));e=d.find("ul").height();e=e>400?400:e;c.find("#dd-your-lanes").css("height",e+"px").removeClass(b.loaderClass).jScrollPane({verticalGutter:b.jScrollGutter}).find(".jspVerticalBar").removeClass("visibility-hidden")}});a.ajax({url:"/"+m.currentUser.username+"/favorite_lanes",cache:false,data:{username:m.currentUser.username},success:function(d){d.length?a.tmpl(b.templates.lanes.fav,
d).appendTo(c.find("#dd-fav-lanes ul")):a('<li class="no-dd-list-item">'+a.i18n.t("Add lanes to this list by going to a lane and clicking the star icon on the upper right. That way, you'll never lose track of your favorites.")+"</li>").appendTo(c.find("#dd-fav-lanes ul"))}})},removeLaneDialog:function(b){var c=this,d=b.attr("data-lane_title"),e=b.attr("data-lane_id"),d=a.tmpl(m.globalTemplates.dialogs.removeLane,{title:d});d.find(".removeConfirm").bind(m.clickOrTouchEnd,function(d){b.closest("li").remove();
var h=a("#dd-your-lanes").find("ul").height(),h=h>400?400:h;a("#dd-your-lanes").css("height",h+"px").removeClass(c.loaderClass).jScrollPane({verticalGutter:c.jScrollGutter});m.dashUser?m.dashboard.removeLane(e):c.removeLane(e);d.preventDefault()});d.lightbox_me({centered:true})},removeLaneFav:function(b){var c=b.attr("data-lane_id");b.closest("li").remove();b=a("#dd-fav-lanes").find("ul").height();b=b>400?400:b;a("#dd-fav-lanes").css("height",b+"px").removeClass(this.loaderClass).jScrollPane({verticalGutter:this.jScrollGutter});
m.dashUser?a(".dashFaves #"+c).find(".remove-fav").trigger(m.clickOrTouchEnd):m.currentLane&&m.currentLane.id===c?a("#favorite-un-fav").trigger(m.clickOrTouchEnd):a.ajax({url:"/lanes/favorite",type:"DELETE",data:{lane_id:c}})},removeLaneContributorDialog:function(b){var c=this,d=b.attr("data-lane_title"),e=b.attr("data-lane_id"),g=b.attr("data-owner"),b="",d={lane_title:d},b=m.globalTemplates.dialogs.removeLaneContributor,d=a.tmpl(b,d);d.find(".removeConfirm").bind(m.clickOrTouchEnd,function(a){m.dashboard?
m.dashboard.removeLaneContributor(e):c.removeLaneContributor(e,g);a.preventDefault()});d.lightbox_me({centered:true})},editLane:function(a){a=a.data("id");if(m.currentLane&&m.currentLane.id==a)return window.location="/"+m.currentUser.username+"/"+m.currentLane.title+"?e=1#drawer=edit",false},removeLane:function(b){var c=this;a.ajax({type:"delete",url:"/lanes/"+b,success:function(){if(m.currentLane&&m.currentLane.id==b)return window.location="/"+m.currentUser.username,false;else c.getLanes()}})},removeLaneContributor:function(b,
c){var d=this;a.ajax({type:"delete",url:"/lanes/contributor",data:{lane_id:b,username:m.currentUser.username},success:function(){if(m.currentLane&&m.currentLane.id==b)return window.location="/"+c+"/"+m.currentLane.title,false;else d.getLanes()}})},openDropdown:function(a,c){a.addClass("tb-dropdown-open");m.search&&m.search.closeSearchDD();c.css("visibility","visible")},closeDropdown:function(a,c){a.data("ddid")=="dd-news"&&this.hideNewNewsIndicator();a.removeClass("tb-dropdown-open");c.css("visibility",
"hidden")},closeAllDropdownsFromClickOff:function(b){a(b.target).closest(".dd-container,.tb-dropdown, .memolaneDialog").length||this.closeAllDropdowns()},closeAllDropdowns:function(){a(".dd-container").css("visibility","hidden");this.$tbDropDowns.removeClass("tb-dropdown-open")},positionDropdown:function(b,c){var b=b||a(".tb-dropdown-open"),c=c||a(".dd-container").filter(function(){return a(this).css("visibility")=="visible"}),d=b.offset().left,e=b.offset().top+45,g=a(window).width();d+c.width()>
g&&(d-=d+c.width()-g);c.css({top:e+"px",left:d+"px"});c.css("visibility")==="hidden"&&this.openDropdown(b,c);return false},templates:{news:{friendship_request:"",welcome_shout:'<li class="clearfix {{if is_new==true}}new-news{{/if}}">\t<div class="dd-news-item">\t\t<img src="/img/dropdowns/news-welcome.png">'+a.i18n.t("Welcome to Memolane. Start sharing the timeline of your social life today by spreading the word to your friends on",'followed by "Twitter and Facebook"')+'\t\t<a class="shareURL" href="#" data-share-link="/'+
(m.currentUser?m.currentUser.username:"")+'" data-share-text="'+a.i18n.t("Check out my new Memolane profile")+'" data-share-dialog-text="'+a.i18n.t("Share profile on")+'"><span class="icon"></span>'+a.i18n.t("Twitter and Facebook")+'</a>.\t</div>\t<div class="dd-news-item-date">${date_str}</div></li>',welcome_invite:'<li class="clearfix {{if is_new==true}}new-news{{/if}}">\t<div class="dd-news-item">\t\t<img src="/img/dropdowns/news-tell-friends.png">'+a.i18n.t("Tell a friend about Memolane!")+'\t</div>\t<div class="dd-news-item-date">${date_str}</div></li>',
new_user_invited_by:'<li class="clearfix {{if is_new==true}}new-news{{/if}}">\t<div class="dd-news-item">\t\t<a href="/${content.other.username}"><img src="/${content.other.username}/image"></a>'+a.i18n.t('<a href="**SEND_INVITOR_FRIEND_REQUEST**">Click here</a> to send them a friend request','note: do NOT alter the "SEND_INVITOR_FRIEND_REQUEST" text')+'\t</div>\t<div class="dd-news-item-date">${date_str}</div></li>',friendship:'<li class="clearfix {{if is_new==true}}new-news{{/if}}">\t<div class="dd-news-item">'+
a.i18n.t('<a href="/${content.friend.username}">${content.friend.full_name}</a> and <a href="/${content.other.username}">${content.other.full_name}</a> are now friends')+'\t</div>\t<div class="dd-news-item-date">${date_str}</div></li>',friendship_request_accepted:'<li class="clearfix {{if is_new==true}}new-news{{/if}}">\t<div class="dd-news-item">\t\t<a href="/${content.friend.username}"><img src="/${content.friend.username}/image"></a>'+a.i18n.t('<a href="/${content.friend.username}">${content.friend.full_name}</a> is now your friend')+
'\t</div>\t<div class="dd-news-item-date">${date_str}</div></li>',lane_new_contributor:'<li class="clearfix {{if is_new==true}}new-news{{/if}}">\t<div class="dd-news-item">\t\t<a href="/lanes/${content.lane.id}" title="'+a.i18n.t("view lane")+'">\t\t\t<img src="/lanes/${content.lane.id}/avatar.small" alt="'+a.i18n.t("top bar avatar","this labels the lane avatar")+'"/>\t\t</a>\t\t<a href="/${content.new_contributor.username}">${content.new_contributor.full_name}</a> '+a.i18n.t('has been added to the lane <span class="lane-name-DD"><a href="/lanes/${content.lane.id}" title="view lane">${content.lane.title}</a></span>',
"this phrase is preceded by the contributor's first and last name")+'\t</div><div class="dd-news-item-date">${date_str}</div></li>',added_to_lane:'<li class="clearfix {{if is_new==true}}new-news{{/if}}">\t<div class="dd-news-item">\t\t<a href="/${content.added_by.username}"><img src="/${content.added_by.username}/image"></a>\t\t<a href="/${content.added_by.username}">${content.added_by.full_name}</a> '+a.i18n.t("has added you as a contributor to the lane","this phrase is preceded by the user's first and last name")+
'\t\t <a href="/lanes/${content.lane.id}">${content.lane.title}</a></div>\t<div class="dd-news-item-date">${date_str}</div></li>'},lanes:{main:'<li class="clearfix">\t<a href="/${owner.username}/${title}" title="'+a.i18n.t("view lane")+'">\t\t<div class="dd-list-item">\t\t\t<img src="/lanes/${id}/avatar.small" alt="'+a.i18n.t("top bar avatar","this labels the lane avatar")+'"/>\t\t\t<span class="lane-name-DD">${title}</span>\t{{if role=="contributor"}}\t\t\t<span class="lane-type-DD">('+a.i18n.t("contributor",
"this label indicates that the user is a contributor to the given lane")+')</span>\t\t</div>\t\t<a href="#" class="dd-lanes-remove-contrib" data-lane_id="${id}" data-owner="${owner.username}" data-lane_title="${title}" title="'+a.i18n.t("remove my content from this lane")+'">X</a>\t{{else}}\t\t</div>\t\t<a href="#" class="dd-lanes-remove" data-lane_id="${id}" data-lane_title="${title}"  title="'+a.i18n.t("delete lane")+'">X</a>\t\t<a href="/${owner.username}/${title}#drawer=edit" class="dd-lanes-edit" title="'+
a.i18n.t("edit lane")+'" data-id="${id}">X</a>\t{{/if}}\t</a></li>',fav:'<li class="clearfix">\t<a href="/${owner.username}/${title}" title="'+a.i18n.t("view lane")+'">\t<div class="dd-list-item">\t\t<img src="/lanes/${id}/avatar.small" alt="'+a.i18n.t("top bar avatar","this labels the lane avatar")+'"/>\t\t<span class="lane-name-DD">${title}</span>\t\t<span class="lane-type-DD">'+a.i18n.t("by ${owner.full_name}")+' (${owner.username})</span>\t</div>{{if true}}\t<a href="#" class="dd-lanes-fav-remove" data-lane_id="${id}" data-lane_title="${title}"  title="'+
a.i18n.t("Remove from favorites")+'" >X</a>{{/if}}</a></li>'},friends:{accepted:'<li class="clearfix">\t<a href="/${other_username}" title="'+a.i18n.t("view dashboard")+'">\t<div class="dd-list-item">\t\t<img src="/${other_username}/image" alt="'+a.i18n.t("top bar avatar","this labels the lane avatar")+'"/>\t\t<span class="name-friends-DD">${other_full_name}</span> \t\t<span class="user-name-friends-DD">(${other_username})</span></div>\t\t<a href="#" class="dd-friends-remove" title="'+a.i18n.t("remove friend")+
'" data-username="${other_username}" data-first_name="${other_first_name}"  data-last_name="${other_last_name}" data-full_name="${other_full_name}">X</a>\t</div></a></li>',requested:'<li class="clearfix friend-request-list">\t<a href="/${other_username}" title="'+a.i18n.t("view dashboard")+'">\t\t<div class="dd-list-item">\t\t\t<img src="/${other_username}/image" alt="'+a.i18n.t("top bar avatar","this labels the lane avatar")+'"/>\t\t\t<span class="name-friends-DD">${other_full_name}</span> \t\t\t<span class="user-name-friends-DD">(${other_username})</span>\t\t</div>\t\t<a href="#" data-username="${other_username}" data-first_name="${other_first_name}" \t\t\tdata-last_name="${other_last_name}" data-full_name="${other_full_name}" class="dd-friends-friend-no" \t\t\ttitle="'+
a.i18n.t("Ignore Friendship Request")+'">'+a.i18n.t("Ignore","this is the short label for denying a friendship request")+'</a> \t\t<a href="#" data-username="${other_username}" data-first_name="${other_first_name}" data-last_name="${other_last_name}" data-full_name="${other_full_name}" class="dd-friends-friend-yes" title="'+a.i18n.t("Confirm Friendship Request")+'">Confirm</a></a></li>',pending:'<li class="clearfix">\t<a href="/${other_username}" title="'+a.i18n.t("view dashboard")+'">\t<div class="dd-list-item">\t\t<img src="/${other_username}/image" alt="'+
a.i18n.t("top bar avatar","this labels the lane avatar")+'"/>\t\t<span class="name-friends-DD">${other_full_name}</span> \t\t<span class="user-name-friends-DD">(${other_username})</span></div>\t\t<a href="#" data-username="${other_username}" class="dd-friends-pending-remove" title="'+a.i18n.t("remove friend request")+'" data-username="${other_username}" data-first_name="${other_first_name}" data-last_name="${other_last_name}" data-full_name="${other_full_name}">X</a>\t</div></a></li>'}}}}(this,jQuery,
this.undefined);m.currentUser!=null&&m.topBarDropDowns.initialize();
m.addFriends=function(f,a){return{continuePollingGmail:false,initialize:function(){var b=this;a(".addFriends").bind(m.clickOrTouchEnd,a.proxy(this.initialAddFriendsDialog,this));a("body").delegate("#addFriendsDialog input[type=checkbox]",m.clickOrTouchEnd,function(){var b=a(this).closest("div");b.find("input[type=checkbox]:checked").length?b.find(".inactive").removeClass("inactive"):b.find("a").addClass("inactive")});a("body").delegate("#addFriendsDialog .skipStep",m.clickOrTouchEnd,function(){a(this).closest("div").hide().siblings().show();
return false});a("body").delegate("#addFriendsDialog .selectAll",m.clickOrTouchEnd,function(){a(this).closest("div").find("input[type=checkbox]").prop("checked",true).end().find(".inactive").removeClass("inactive");return false});a("body").delegate("#addFriendsDialog .selectNone",m.clickOrTouchEnd,function(){a(this).closest("div").find("input[type=checkbox]").prop("checked",false).end().find("a").addClass("inactive");return false});a("body").delegate("#addFriendsDialog #gmailAddExistingFriends",m.clickOrTouchEnd,
a.proxy(this.addExisting,this));a("body").delegate("#addFriendsDialog #gmailInviteFriends",m.clickOrTouchEnd,a.proxy(this.inviteFriends,this));a("body").delegate("#addFriendsDialog #facebookAddExistingFriends",m.clickOrTouchEnd,a.proxy(this.addExisting,this));a("body").delegate("#addFriendsByEmail","keyup",function(){b.validateEmailList()?a(this).siblings(".inactive").removeClass("inactive"):a(this).siblings(".addFriendsBtnEmail").addClass("inactive")});a("body").delegate("#addFriendsDialog .addFriendsBtnEmail",
m.clickOrTouchEnd,a.proxy(this.sendEmailInvites,this));a.validity.setup({outputMode:"modal"});a.validity.patterns.emailList=/^(([a-zA-Z0-9_\-\.\+]+)@([a-zA-Z0-9_\-\.]+)\.([a-zA-Z]{2,5}){1,25})+([\,.][ .]*(([a-zA-Z0-9_\-\.\+]+)@([a-zA-Z0-9_\-\.]+)\.([a-zA-Z]{2,5}){1,25})+)*$/;a.validity.messages.emailList=a.i18n.t("Email invites must be formatted as a series of email addresses, separated by commas.")},validateEmailList:function(){var b=a("#addFriendsByEmail");return b.val().length?(a.validity.start(),
b.match("emailList"),a.validity.end().valid):false},sendEmailInvites:function(b){var c=this,d=a("#addFriendsByEmail").val();d.length&&this.validateEmailList()&&(d=d.replace(/ /g,"").replace(/\+/g,"%2B"),d=d.split(","),a.ajax({type:"post",url:"/add_friends/email_invite",data:{emails:d},success:function(b){a("#addFriendsDialog").find(".dialogContent").empty().append(a.tmpl(c.templates.emailDialogContent,b)).end().trigger("reposition")},error:function(){a("#addFriendsDialog").find(".dialogContent").empty().append(a.tmpl(c.templates.genericError)).end().trigger("reposition")}}));
b.preventDefault()},pollGmail:function(){var b=this;a.when(m.utilities.wait(1E3),b.checkGmail()).done(function(){b.continuePollingGmail&&b.pollGmail()})},checkGmail:function(){var b=this;a.ajax({type:"get",cache:false,url:"/add_friends/auth_gmail_verifier",success:function(c){if(c.status!="not ready")b.continuePollingGmail=false,a.ajax({type:"get",url:"/add_friends/contacts_gmail",data:{oauth_verifier:c},success:function(c){c.existing_users.length||c.users_to_invite.length?a("#addFriendsDialog").find(".dialogContent").empty().append(a.tmpl(b.templates.GmailDialogContent,
c)).end().trigger("reposition"):c.friends.length?a("#addFriendsDialog").find(".dialogContent").empty().append(a.tmpl(b.templates.GmailDialogError_TooPopular)).end().trigger("reposition"):a("#addFriendsDialog").find(".dialogContent").empty().append(a.tmpl(b.templates.GmailDialogError_GenericOrNoFriends)).end().trigger("reposition")},error:function(){a("#addFriendsDialog").find(".dialogContent").empty().append(a.tmpl(b.templates.GmailDialogError_BadKey)).end().trigger("reposition")}})},error:function(){b.continuePollingGmail=
false;a("#addFriendsDialog").find(".dialogContent").empty().append(a.tmpl(b.templates.genericError)).end().trigger("reposition")}})},checkFacebook:function(){var b=this;a.ajax({type:"get",cache:false,url:"/add_friends/contacts_facebook",success:function(c){a("#addFriendsDialog").find(".dialogContent").empty().append(a.tmpl(b.templates.FacebookDialogContent,c)).end().trigger("reposition")},error:function(c){a.parseJSON(c.responseText).error.type=="object_not_found"?a("#addFriendsDialog").find(".dialogContent").empty().append(a.tmpl(b.templates.FacebookDialogError_noAccount)).end().trigger("reposition"):
a("#addFriendsDialog").find(".dialogContent").empty().append(a.tmpl(b.templates.genericError)).end().trigger("reposition")}})},addExisting:function(){var b=this,c=a("#addFriends-existing .submitFriendship");if(c.not(".inactive)").length){var d=[];a("#addFriends-existing input[type=checkbox]:checked").each(function(){d.push(this.getAttribute("value"))});d.length&&a.ajax({type:"post",url:"/add_friends/batch_request",data:{uids:d},success:function(){c.is(".addFriendsLastStep")?a("#addFriendsDialog").find(".dialogContent").empty().append(a.tmpl(b.templates.successMessage)).end().trigger("reposition"):
c.parent("div").hide().siblings().show()},error:function(){a("#addFriendsDialog").find(".dialogContent").empty().append(a.tmpl(b.templates.genericError)).end().trigger("reposition")}})}return false},inviteFriends:function(){var b=this;if(a("#addFriends-invite .submitFriendship").not(".inactive)").length){var c=[];a("#addFriends-invite input[type=checkbox]:checked").each(function(){c.push(this.getAttribute("value"))});c.length&&a.ajax({type:"post",url:"/add_friends/email_invite",data:{emails:c},success:function(){a("#addFriendsDialog").find(".dialogContent").empty().append(a.tmpl(b.templates.successMessage)).end().trigger("reposition")},
error:function(){a("#addFriendsDialog").find(".dialogContent").empty().append(a.tmpl(b.templates.genericError)).end().trigger("reposition")}})}return false},initialAddFriendsDialog:function(b){var c=this,d=a.tmpl(this.templates.addFriendsDialog);d.find(".addFriendsBtnGmail").bind(m.clickOrTouchEnd,function(){c.continuePollingGmail=true;c.pollGmail();a(this).parent().find(".loading").show()});d.find(".addFriendsBtnFacebook").bind(m.clickOrTouchEnd,function(b){c.checkFacebook();a(this).parent().find(".loading").show();
b.preventDefault()});d.lightbox_me();b.preventDefault()},templates:{addFriendsDialog:'<div id="addFriendsDialog" class="memolaneDialog" style="width:500px;">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">'+a.i18n.t("Add friends")+'</div>\t\t<div class="close closeMemolaneDialog removeService">'+a.i18n.t("cancel","close dialog")+'</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<div style="float:left; width:150px; text-align:center;">\t\t\t<div style="padding-bottom:20px; border-bottom:1px solid #e1e1e1;">\t\t\t\t<img src="/img/common/services/icon-gmail.png" alt="Gmail logo" style="padding-bottom:5px;" /><p style="margin-bottom:10px;">'+
a.i18n.t("Select friends from<br />your Gmail address book.")+'</p><a href="/add_friends/auth_gmail" target="_blank" class="btn-green addFriendsBtnGmail">'+a.i18n.t("Gmail","gmail web email")+'</a><img class="loading" src="/img/common/smallLoaderOnGrey.gif" />\t\t\t</div>\t\t\t<div style="margin-top:20px;">\t\t\t\t<img src="/img/common/services/icon-facebook.png" alt="Facebook logo" style="padding-bottom:5px;" /><p style="margin-bottom:10px;">'+a.i18n.t("Select friends from<br />your Facebook.")+
'</p><a href="#" class="btn-green addFriendsBtnFacebook">'+a.i18n.t("Facebook","Facebook, the online web application")+'</a><img class="loading" src="/img/common/smallLoaderOnGrey.gif" />\t\t\t</div>\t\t</div>\t\t<div style="float:left; width:270px; border-left:1px solid #e1e1e1; padding-left:20px; margin-left:20px;">\t\t\t<p>'+a.i18n.t("If you know the email addresses of the people you would like to invite to Memolane and send friend requests to, enter them below (separated by commas).")+'</p>\t\t\t<textarea id="addFriendsByEmail" style="margin-bottom:15px; width:260px; height:141px;"></textarea>\t\t\t<a href="#" class="btn-green addFriendsBtnEmail submitFriendship inactive">'+
a.i18n.t("Send e-mail invite(s)")+"</a>\t\t</div>\t</div></div>",GmailDialogContent:'{{if existing_users.length}}\t<div id="addFriends-existing" class="addFriendsStep">\t\t<p>'+a.i18n.t("These people are already on Memolane.  Select the ones you want to send a friend request to:")+"</p>\t\t{{if existing_users.length > 1}}<p>"+a.i18n.t("Select:","select either all of the items or none")+' <a href="#" class="selectAll">'+a.i18n.t("all","select all items")+'</a> | <a href="#" class="selectNone">'+a.i18n.t("none",
"select none of the items")+'</a></p>{{/if}}\t\t<ul>\t\t\t{{each existing_users}}\t\t\t\t<li><input type="checkbox" checked="checked" value="${username}" /> <img src="${image}" /> <p>${name}<br /><span>${email}</span></p></li>\t\t\t{{/each}}\t\t</ul>\t\t<a href="#" id="gmailAddExistingFriends" class="btn-green submitFriendship{{if !users_to_invite.length}} addFriendsLastStep{{/if}}">'+a.i18n.t("Send request(s) to selected friend(s)</a> or")+' {{if users_to_invite.length}}<a href="#" class="skipStep">'+
a.i18n.t("skip this step")+'</a>{{else}}<a href="#" class="close">'+a.i18n.t("close window")+'</a>{{/if}}\t</div>{{/if}}{{if users_to_invite.length}}\t<div id="addFriends-invite" class="addFriendsStep">\t\t<p>'+a.i18n.t("Everyone listed below is not on Memolane yet. Send them an invite and simultaneously ask them to be your friend.","text on the gmail friends invite dialog")+"</p>\t\t{{if users_to_invite.length > 1}}<p>"+a.i18n.t("Select:","select either all of the items or none")+' <a href="#" class="selectAll">'+
a.i18n.t("all","select all items")+'</a> | <a href="#" class="selectNone">'+a.i18n.t("none","select none of the items")+'</a></p>{{/if}}\t\t<ul>\t\t\t{{each users_to_invite}}\t\t\t\t<li><input type="checkbox" checked="checked" value="${emails[0]}" /> <img src="${image}" /> <p>${name}<br /><span>${emails[0]}</span></p></li>\t\t\t{{/each}}\t\t</ul>\t\t<a href="#" id="gmailInviteFriends" class="btn-green submitFriendship addFriendsLastStep">'+a.i18n.t("Send invite(s) to selected friend(s)</a>")+"</a> "+
a.i18n.t("or","_or_ between invite button and close link on invite friends dialog")+' <a href="#" class="close">'+a.i18n.t("close window")+"</a>\t</div>{{/if}}",GmailDialogError_BadKey:"<p>"+a.i18n.t("It looks like we're either having server issues, or you denied our request to connect to Gmail.")+"</p><p>"+a.i18n.t('Click "Add Friends" to try again.')+'</p><p style="margin-bottom:0;"><a href="#" class="btn-green close">'+a.i18n.t("OK","ok button for dialog")+"</a></p>",GmailDialogError_TooPopular:"<p>"+
a.i18n.t("It looks like you're too popular!")+"</p><p>"+a.i18n.t("You're already Memolane friends with all of your Gmail contacts!")+'</p><p style="margin-bottom:0;"><a href="#" class="btn-green close">'+a.i18n.t("OK","ok button for dialog")+"</a></p>",GmailDialogError_GenericOrNoFriends:"<p>"+a.i18n.t("It looks like either we're having a server issue, or we didn't get a list of contacts.")+"</p><p>"+a.i18n.t("You may want to check your Gmail contacts list to ensure there are email addresses there.</p>")+
'<p style="margin-bottom:0;"><a href="#" class="btn-green close">'+a.i18n.t("OK","ok button for dialog")+"</a></p>",FacebookDialogContent:'{{if existing_users && existing_users.length}}\t<div id="addFriends-existing" class="addFriendsStep addFriendsFacebook">\t\t<p>'+a.i18n.t("These people are already on Memolane.  Select the ones you want to send a friend request to:")+"</p>\t\t{{if existing_users.length > 1}}<p>"+a.i18n.t("Select:","select either all of the items or none")+' <a href="#" class="selectAll">'+
a.i18n.t("all","select all items")+'</a> | <a href="#" class="selectNone">'+a.i18n.t("none","select none of the items")+'</a></p>{{/if}}\t\t<ul>\t\t\t{{each existing_users}}\t\t\t\t<li><input type="checkbox" checked="checked" value="${username}" /> <img src="${image}" /> <p>${full_name}<br /><span>${email}</span></p></li>\t\t\t{{/each}}\t\t</ul>\t\t<a href="#" id="facebookAddExistingFriends" class="btn-green submitFriendship addFriendsLastStep">'+a.i18n.t("Send request(s) to selected friend(s)")+
"</a> "+a.i18n.t("or","_or_ between two buttons. X button or Y button")+' <a href="#" class="close">'+a.i18n.t("close window")+'</a>\t</div>{{else}}\t<div class="addFriendsStep">\t\t{{if friends && friends.length}}\t\t\t<p>'+a.i18n.t("It looks like you're already Memolane friends with all of your Facebook contacts - way to go social animal.")+"</p>\t\t{{else}}\t\t\t<p>"+a.i18n.t("Unfortunately, we were not able to find any existing Memolane users from your Facebook account.")+'</p>\t\t{{/if}}\t\t<p style="margin-bottom:0;"><a href="#" class="btn-green close">'+
a.i18n.t("OK","ok button for dialog")+"</a></p>\t</div>{{/if}}",FacebookDialogError_noAccount:"<p>"+a.i18n.t("You need to connect your Facebook account to Memolane in order to add friends from there.")+"</p><p>"+a.i18n.t('Go to your <a href="/settings/services">my services</a> page to do so.')+'</p><p style="margin-bottom:0;"><a href="#" class="btn-green close">'+a.i18n.t("OK","ok button for dialog")+"</a></p>",emailDialogContent:"{{if friends_requests_sent && friends_requests_sent.length}}\t<p>"+
a.i18n.t("The following people are already on Memolane, so we sent them a friend request instead.")+'</p>\t<ul class="noCheckbox">\t\t{{each friends_requests_sent}}\t\t\t<li><img src="${image}" /> <p class="addedFriendsEmail">${full_name}</p></li>\t\t{{/each}}\t</ul>\t<p style="margin-bottom:0;"><a href="#" class="btn-green close">'+a.i18n.t("Done","done button for dialog")+'</a></p>{{else}}\t<p>Hurray!  Your invites have been sent!</p>\t<p style="margin-bottom:0;"><a href="#" class="btn-green close">'+
a.i18n.t("OK","ok button for dialog")+"</a></p>{{/if}}",genericError:"<p>It looks like there was a problem.</p><p>"+a.i18n.t('You may want to try again in a bit, or let us know this happened (by clicking the "Feedback" link on the upper right).')+'</p><p style="margin-bottom:0;"><a href="#" class="btn-green close">'+a.i18n.t("OK","ok button for dialog")+"</a></p>",successMessage:'<p>Hurray!  Your invites have been sent!</p><p style="margin-bottom:0;"><a href="#" class="btn-green close">'+a.i18n.t("OK",
"ok button for dialog")+"</a></p>"}}}(this,jQuery,this.undefined);m.addFriends.initialize();
m.search=function(f,a,b){return{$searchInput:a("#search-input"),$closeSearchBtn:a("#close-search-btn"),$searchDD:a("#dd-search"),$tbSearch:a("#tb-search"),$searchTypesA:a("#search-types a"),$searchResults:a(".search-results"),searchDDOpen:false,searchContext:m.currentLane?"search-memos":"search-lanes",loaderClass:"small-loader-on-grey",jScrollGutter:5,maxDDContentHeight:320,searchLaneScope:"world",searchTimeout:b,initialize:function(){m.currentLane||(a("#search-memos").hide(),a("#search-lanes").show(),
a("#search-lanes-filter-friends").show());var b=this;this.$searchInput.focus(a.proxy(this.searchInputFocus,this)).blur(a.proxy(this.searchInputBlur,this)).keyup(a.proxy(this.searchInputkeyup,this));this.$closeSearchBtn.bind(m.clickOrTouchStart,a.proxy(function(){this.closeSearchDD()},this));a(document).bind(m.clickOrTouchStart,a.proxy(this.closeSearchDDFromClickOff,this));this.$searchTypesA.bind(m.clickOrTouchStart,a.proxy(function(a){this.toggleSearchContext(a)},this));this.$searchResults.delegate(".request-friendship",
m.clickOrTouchStart,function(){b.addFriendDialog(a(this));return false});a("#search-lanes-filter-friends input").bind(m.clickOrTouchStart,function(){b.setLaneSearchFilter(a(this))})},searchInputFocus:function(b){var d=a(b.target),e=d.val();d.val(e===b.target.defaultValue?"":e).addClass("search-focused").data("hasFocus",true);this.$closeSearchBtn.show()},searchInputBlur:function(b){var d=a(b.target);this.$searchDD.css("visibility")!=="visible"&&(d.val(b.target.defaultValue).removeClass("search-focused").data("hasFocus",
false),this.$closeSearchBtn.hide(),this.$tbSearch.css("background-color","transparent"))},closeSearchDD:function(){this.$searchDD.css("visibility","hidden");this.$searchInput.trigger("blur");this.searchDDOpen=false},closeSearchDDFromClickOff:function(b){a(b.target).closest("#dd-search, #tb-search, .memolaneDialog").length||this.closeSearchDD()},searchInputkeyup:function(b){a(b.target);b=this.$searchInput.val();if(b.length!=0&&b.length>=3||this.searchDDOpen)this.searchDDOpen===false&&(this.$tbSearch.css("background-color",
"#f1f1f1"),this.openSearchDD()),this.doSearchDebounce(this.searchContext),foo=false},openSearchDD:function(){this.searchDDOpen=true;m.topBarDropDowns.closeAllDropdowns();this.$searchDD.css("visibility","visible")},toggleSearchContext:function(b){var d=a(b.target),e=d.attr("id").replace("dd-","");e==="search-lanes"?a("#search-lanes-filter-friends").show():a("#search-lanes-filter-friends").hide();this.searchContext=e;this.$searchResults.hide();this.$searchTypesA.removeClass("smallButtonActive");d.addClass("smallButtonActive");
this.doSearchDebounce(e);b.preventDefault()},setLaneSearchFilter:function(a){a.attr("id");this.searchLaneScope=a.is(":checked")===true?"friends":"world";this.doContextSearch(0,"search-lanes")},doSearchDebounce:_.debounce(function(a){this.doContextSearch(0,a)},200),doContextSearch:function(b,d,e){var g=this,h=a("#"+d).show(),f=h.find("ul"),k=this.$searchInput.val(),l="",n="",o="",e=e||10,r=a("#"+d+"-hits");g.searchContext=d;switch(d){case "search-memos":l="/search/memos";o="memos";n="";lane=m.currentLane.id;
break;case "search-lanes":l="/search/lanes";o="lanes";n=g.searchLaneScope;lane="";break;case "search-users":l="/search/users",o="users",n="world",lane=""}b==0&&(f.html(""),h.find(".search-results-scrollable").data("jsp")&&h.find(".search-results-scrollable").data("jsp").destroy(),h.show());a("#"+d+"-loader").show();e>b?a.ajax({type:"get",url:l,data:{q:k,start:b,limit:10,scope:n,lane:lane},success:function(e,k,l){a("#"+d+"-loader").hide();b==0&&h.removeClass(g.loaderClass);parseInt(e.hits)==0||l.status==
204?f.find(".search-no-results").length===0&&(a.tmpl(g.templates[d].empty,{}).appendTo(f),r.html(""),h.find(".search-results-scrollable").height(40)):(a.tmpl(g.templates[d].results,e[o]).appendTo(f),f.height()>=g.maxDDContentHeight?h.find(".search-results-scrollable").height(g.maxDDContentHeight).jScrollPane({verticalGutter:g.jScrollGutter}):h.find(".search-results-scrollable").height(f.height()),h.find(".jspScrollable").bind("jsp-scroll-y",function(h,f,p,k){k===true&&(h=b+10,e.hits>h&&g.doContextSearch(h,
d,e.hits),a(this).unbind("jsp-scroll-y"))}),b==0?r.html(e.hits+" "+a.i18n.t("total results","this is preceded by the number of search results returned")):h.find(".search-results-scrollable").data("jsp").reinitialise())}}):a("#"+d+"-loader").hide()},linkToMemo:function(a,b){return m.utilities.breakURLCache(window.location.pathname)+"#time="+b+"&memo="+m.utilities.cleanMemoId(a)},addFriendDialog:function(b){b={username:b.data("username"),first_name:b.data("first_name"),last_name:b.data("last_name")};
a.tmpl(m.globalTemplates.dialogs.addFriend,b).lightbox_me({centered:true});m.dashboard?m.dashboard.addFriend(b.username):a.ajax({type:"post",url:"/friends/"+b.username,success:function(){}})},templates:{"search-memos":{results:'<li class="clearfix"><a href="${m.search.linkToMemo(id, created_at)}" title="'+a.i18n.t("view memo")+'"><div class="search-service-icon ${service}-icon"></div><img src="/${user.username}/images" alt="lane" class="search-user-avatar" title="${title}" height="20" width="20" /><div class="search-memos-txt">${title.substring(0, 75) + ( title.length > 75 ? "..." : "") }<span class="search-memos-date">${m.utilities.dateFormat((created_at*1000), "UTC:ddd mmm dd yyyy HH:MM:ss")}</span></div></a></li>',
empty:'<li class="clearfix search-no-results">'+a.i18n.t("No memos match that search term")+"</li>"},"search-lanes":{results:'{{if user}}<li class="clearfix"><a href="/${user.username}/${title}" title="'+a.i18n.t("view lane")+'"><img src="/lanes/${id}/avatar.small" class="search-result-icon search-lane-image" alt="topBarAvatar" title="${title}" height="20" width="20" /><span class="search-results-txt">${title}{{if m.currentUser.userID != user_id}}<span class="search-lanes-rel">(${user.first_name} ${user.last_name})</span>{{/if}}</span></a></li>{{/if}}',
empty:'<li class="clearfix search-no-results">'+a.i18n.t("No lanes match that search term")+"</li>"},"search-users":{results:'<li class="clearfix"><a href="/${username}" title="'+a.i18n.t("view user profile")+'"><img src="/${username}/images" height="20" width="20" class="search-result-icon search-user-avatar" alt="'+a.i18n.t("top bar avatar","this labels the lane avatar")+'"/><span class="search-results-txt">${first_name} ${last_name}<span class="search-users-username">(${username})</span></span> {{if friend=="pending" || friend=="self" || friend=="accepted" || m.currentUser === null}}{{else}}<a href="#" data-first_name="${first_name}" data-last_name="${last_name}" data-username="${username}" class="request-friendship" title="'+
a.i18n.t("request friendship")+'">'+a.i18n.t("Request Friendship")+"</a>{{/if}}</a></li>",empty:'<li class="clearfix search-no-results">'+a.i18n.t("No users match that search term")+"</li>"}}}}(this,jQuery,this.undefined);m.search.initialize();
m.timeline=function(f,a,b){return{$timeline:a("#timeline"),$fixedIndicator:a("#timelineCurrent"),$hoverIndicator:a("#timelineHover"),$hoverIndicatorTooltip:a("#timeline-tooltip"),timelineWidth:null,timelineInnerWidth:0,beginDateWidth:0,endDateWidth:0,fixedIndicatorWidth:0,fixedIndicatorXRatio:0,initialize:function(){a("#timelineBeginDate").text(m.utilities.dateFormat(m.currentLane.first_memo*1E3,"UTC:m/d/yy"));a("#timelineEndDate").text(m.utilities.dateFormat(m.currentLane.last_memo*1E3,"UTC:m/d/yy"));
this.$timeline.bind(m.clickOrTouchEnd,a.proxy(this.handleClick,this));Modernizr.touch||this.$timeline.bind("mousemove",a.proxy(this.showHoverIndicator,this)).bind("mouseleave",a.proxy(this.hideHoverIndicator,this));this.resetSizeValues()},resetSizeValues:function(){this.timelineWidth=this.$timeline.width();this.beginDateWidth=a("#timelineBeginDate").outerWidth();this.endDateWidth=a("#timelineEndDate").outerWidth();this.timelineInnerWidth=this.timelineWidth-this.beginDateWidth-this.endDateWidth;this.fixedIndicatorWidth=
this.$fixedIndicator.outerWidth()},showFixedIndicator:function(c,d){var e=true;c==b&&this.fixedIndicatorXRatio!=b?c=this.fixedIndicatorXRatio:c==b&&(c=1,e=false);c<=0?c=0:c>=1&&(c=1);if(e)this.fixedIndicatorXRatio=c;d||(d=Math.round(m.currentLane.first_memo+(m.currentLane.last_memo-m.currentLane.first_memo)*c));a("#timelineDate").text(m.utilities.dateFormat(d*1E3,"mediumDate"));this.fixedIndicatorWidth=this.$fixedIndicator.outerWidth();e=c*this.timelineInnerWidth+this.beginDateWidth;e>this.timelineWidth-
this.endDateWidth&&(e=this.timelineWidth-this.endDateWidth);e+this.fixedIndicatorWidth>=this.timelineWidth-this.endDateWidth?(e-=this.fixedIndicatorWidth,this.$fixedIndicator.css("left",Math.round(e)+"px").addClass("indicatorRight")):this.$fixedIndicator.css("left",Math.round(e)+"px").removeClass("indicatorRight");this.$fixedIndicator.is(":hidden")&&this.$fixedIndicator.show()},onResize:function(a){this.resetSizeValues();this.showFixedIndicator(a)},showFixedIndicatorByTimestamp:function(a){if(!a)a=
m.lane.currentlyCenteredLaneMemoTime;xRatio=(a-m.currentLane.first_memo)/(m.currentLane.last_memo-m.currentLane.first_memo);this.showFixedIndicator(xRatio,a)},showHoverIndicator:function(a){var b=null,b=null,b=(a.pageX-this.beginDateWidth)/this.timelineInnerWidth,b=Math.round(m.currentLane.first_memo+(m.currentLane.last_memo-m.currentLane.first_memo)*b),a=a.pageX-3;this.$hoverIndicator.css("left",a+"px");this.$hoverIndicatorTooltip.css("left",a-47+"px");a>this.timelineWidth-this.endDateWidth||a<=
this.beginDateWidth?(this.$hoverIndicator.hide(),this.$hoverIndicatorTooltip.hide()):(this.$hoverIndicator.show(),this.$hoverIndicatorTooltip.text(m.utilities.dateFormat(b*1E3,"UTC:mmm d, yyyy")).show())},hideHoverIndicator:function(){this.$hoverIndicator.hide();this.$hoverIndicatorTooltip.hide()},handleClick:function(a){var b=null,e=null;if(a.originalEvent.touches||a.originalEvent.changedTouches)var g=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0];a.target.id=="timelineBeginDate"?
(b=0,e=m.currentLane.first_memo):a.target.id=="timelineEndDate"?(b=1,e=m.currentLane.last_memo):(b=((a.pageX||g.pageX)-this.beginDateWidth)/this.timelineInnerWidth,e=Math.round(m.currentLane.first_memo+(m.currentLane.last_memo-m.currentLane.first_memo)*b));this.showFixedIndicator(b);a="";m.isEmbedded&&(a+="&embedded=true");m.embeddedParams.background!=""&&(a+="&embedded_background="+m.embeddedParams.background);m.embeddedParams.border!=""&&(a+="&embedded_border="+m.embeddedParams.border);f.location.href=
m.utilities.breakURLCache("/"+m.currentLane.owner.username+"/"+m.currentLane.title)+a+"#time="+e}}}(this,jQuery,this.undefined);m.timeline.initialize();
m.laneLayout=function(f,a){return{timelineHeight:42,heightOfHeader:m.isEmbedded?0:120,heightOfDateBar:25,heightOfBranding:m.isEmbedded?38:0,initialize:function(){a(f).bind("resize",function(a){m.laneLayout.runLayout(a)});this.runLayout(false)},runLayout:function(b){var c=a("#lane-viewport"),d=a("#lane");a(".lane-slot");var e=a(".lane-slot-memos"),g=a("#content"),h=a("body"),f=a("#lane-drawer-content"),k=a("#lane-drawer"),l=a("#lane-drawer-tab"),n=a("#header"),o=a(".screenBtn"),r=a(".slot-loader"),
q=a("#drawer-actions"),s=a("#embedded-branding"),v=a("#shadow"),t=a("#screenLeftBtn"),q=q.length?43:0;if(m.isEmbedded){n.hide();l.hide();k.hide();o.css("top",28);r.css("top",28);if(!m.embeddedParams.background||m.embeddedParams.background==""||m.embeddedParams.background=="default")m.embeddedParams.background="black";m.embeddedParams.background!="memolane"&&h.css("background",m.embeddedParams.background);if(!m.embeddedParams.border||m.embeddedParams.border==""||m.embeddedParams.border=="default")m.embeddedParams.border=
"1px solid #FFF";g.css("border",m.embeddedParams.border);g.data("custom-hostname",m.embeddedParams.custom_hostname);g.data("custom-pathname",m.embeddedParams.custom_pathname);v.css("bottom",41+this.heightOfBranding);s.show();t.css("left",0)}g.css("visibility","hidden");f.height(h.height()-this.timelineHeight-k.position().top-22-q+"px");c.height(h.height()-this.heightOfHeader-this.timelineHeight-this.heightOfBranding+"px");d.height(c.height()+"px");o.add(".slot-loader").height(c.height()-this.heightOfDateBar-
20+"px");e.height(c.height()-(this.heightOfDateBar+20)+"px");a("#content .lane-slot-memos").isotope({layoutMode:"fitColumns",animationEngine:"jquery",animationOptions:{duration:0,queue:false}});var u=0;a("#content .lane-slot").each(function(){u+=a(this).outerWidth()});d.width(u+"px");g.css("visibility")==="hidden"&&g.css("visibility","visible");f.data("jsp")&&f.data("jsp").reinitialise();a(".openMemo").length&&m.memos.closeMemo();a(".dd-container").filter(function(){return a(this).css("visibility")==
"visible"}).length&&m.topBarDropDowns.positionDropdown();setTimeout(function(){m.lane.stretchSlot()},1E3);if(b!=false)m.timeline.onResize(),m.laneLoadMemos.numberOfMemosToLoad=Math.round(a("body").width()/250*(a("#lane-viewport").height()/250))*4,m.lane.onLaneEndRemoveNavBtn()}}}(this,jQuery,this.undefined);m.laneLayout.initialize();
m.drawer=function(f,a){return{$drawer:a("#lane-drawer"),$drawerContent:a("#lane-drawer-content"),$drawerActions:a("#drawer-actions"),$laneDrawerEdit:a("#lane-drawer-edit"),$laneDrawerView:a("#lane-drawer-view"),$content:a("#content"),$slotLoaderLeft:a("#slot-loader-left"),$headerLaneTitle:a("h2.lane-title"),$drawerHandler:a("#lane-drawer-tab"),$screenLeftBtn:a("#screenLeftBtn"),$drawerHandlerIcon:a("#lane-drawer-tab").find("span"),drawerIsOpen:true,currentUserIsOwner:m.currentLane.user_is_owner,currentUserIsContributor:m.currentLane.user_is_contributor,
urlHashObject:m.utilities.urlHash.get(),initialize:function(){var b=this,c=m.currentLane.mode;this.$drawerHandler.bind(m.clickOrTouchStart,a.proxy(this.onClickOrTouchStart,this));Modernizr.sessionstorage&&!sessionStorage.getItem("drawerAware")&&c!=="new"&&this.urlHashObject.drawer!=="open"&&this.urlHashObject.drawer!=="edit"?(sessionStorage.setItem("drawerAware",true),this.$screenLeftBtn.stop().animate({left:this.$drawer.outerWidth()},400,"easeOutCubic"),this.$drawer.css("visibility","visible"),setTimeout(function(){b.closeDrawer(1E3)},
9E3)):c==="new"||this.urlHashObject.drawer==="open"||this.urlHashObject.drawer==="edit"||m.currentLane.total_memos===0||m.currentLane.visible_memos===0?(this.$screenLeftBtn.stop().animate({left:this.$drawer.outerWidth()},400,"easeOutCubic"),this.$drawer.css("visibility","visible")):this.closeDrawer(0,function(){b.$drawer.css("visibility","visible")});a("#lane-drawer-content").jScrollPane({verticalGutter:10});a(document).keyup(function(b){if(a("input:focus,textarea:focus,select:focus").length)return false;
switch(b.which){case 68:m.drawer.drawerIsOpen?m.drawer.closeDrawer():m.drawer.openDrawer()}});c==="new"?(this.addNewView(),a('<div class="notifications warningnews-notice"><div class="notice-text"><p class="zeroMarginBottom">'+a.i18n.t("Don't forget to turn on the services you want to stream on this lane.")+'</p><a href="#" class="close-notice">X</a></div></div>').notify({expires:7500})):this.urlHashObject.drawer==="edit"?this.addEditView():this.addLaneView();this.urlHashObject.firstLane==="yes"&&
(sessionStorage.getItem("drawerAware")&&setTimeout(function(){b.closeDrawer(1E3)},9E3),a('<div class="notifications warningnews-notice"><div class="notice-text"><p>'+a.i18n.t("Welcome to Memolane!")+'</p><p class="zeroMarginBottom">'+a.i18n.t("By default your first lane streams all the services you have just added. When creating new lanes you'll have to select the services you want to appear on each lane in the lane drawer or add memos individually.")+'</p><a href="#" class="close-notice">X</a></div></div>').notify({expires:false}));
a(".openDrawerOnClick").live("click",function(){m.drawer.openDrawer();return false});a(".openDrawerEditViewOnClick").live("click",function(){a("#drawer-edit-lane-link").trigger("click");m.drawer.openDrawer();return false})},addNewView:function(){var b=this;this.showDrawerLoader();_.delay(a.proxy(this.openDrawer,this),1E3);a.when(a.ajax({url:"/lanes/"+m.currentLane.id+"/available_services"}),a.ajax({url:"/lanes/"+m.currentLane.id+"/available_contributors"})).done(function(c,d){var e=a.tmpl(b.templates.drawerNew,
{ser:c[0],contr:d[0],currentUser:m.currentUser,avatar:m.currentLane.avatar}).html();b.hideDrawerLoader();b.$drawerContent.after(b.templates.createLaneAction).find(".jspPane").append(e).end().height(b.$drawerContent.height()-43).data("jsp").reinitialise();b.setupEditViewAndNewViewEvents();b.$drawer.delegate("#streaming-services input","click",function(a,c){b.serviceCheckboxToggle(this);if(c)return false});a("#lane-contrib-list li").bind("click",function(c){a(c.target).is("input")?b.contributorToggle(c.target):
($checkbox=a(this).find("input"),$checkbox.prop("checked")?$checkbox.prop("checked",false):$checkbox.prop("checked",true),b.contributorToggle($checkbox))});a("#cancel-lane-creation a").bind(m.clickOrTouchStart,function(){b.hideDrawerContent();b.showDrawerLoader();a.ajax({type:"delete",url:"/lanes/"+m.currentLane.id,success:function(){f.history.back()}});return false});a("#create-new-lane-btn").bind(m.clickOrTouchStart,function(){b.saveLane()})})},contributorToggle:function(b){var c=this,b=a(b);b.prop("checked")?
a.ajax({url:"/lanes/contributor",type:"POST",data:{lane_id:m.currentLane.id,username:b.data("username")}}).success(function(){a.ajax({url:"/lanes/"+m.currentLane.id+"/available_services",cache:false}).success(function(b){b=a.tmpl(c.templates.drawerNewServList,{ser:b}).html();a("#streaming-services").html(b);c.$drawerContent.data("jsp").reinitialise()})}):a.ajax({url:"/lanes/contributor",type:"DELETE",data:{lane_id:m.currentLane.id,username:b.data("username")}}).success(function(){a.ajax({url:"/lanes/"+
m.currentLane.id+"/available_services",cache:false}).success(function(b){b=a.tmpl(c.templates.drawerNewServList,{ser:b}).html();a("#streaming-services").html(b);c.$drawerContent.data("jsp").reinitialise()})})},serviceCheckboxToggle:function(b){a(b).is(":checked")?a.ajax({url:"/lanes/service",type:"POST",data:{lane_id:m.currentLane.id,service:a(b).data("service-name")}}):a.ajax({url:"/lanes/service",type:"DELETE",data:{lane_id:m.currentLane.id,service:a(b).data("service-name")}})},saveLane:function(){var b=
this;this.hideDrawerContent();this.showDrawerLoader();a("#drawer-actions").addClass("visibility-hidden");var c=a("#lane-title-input"),d=c.attr("placeholder"),e=c.val(),g=a("#lane-descrip-input"),c=g.attr("placeholder"),g=g.val(),h=a("#lane-input-start-date"),p=h.val(),k=h.data("date")||"",h=a("#lane-input-end-date"),l=h.val(),n=h.data("date")||"";a.when(e!==""&&e!==d&&m.currentLane.title!==e?a.ajax({url:"/lanes/title",type:"POST",data:{lane_id:m.currentLane.id,title:e}}):false,g!==c?a.ajax({url:"/lanes/description",
type:"POST",data:{lane_id:m.currentLane.id,description:g}}):false,function(){if(p===k&&l===n)return false;var b=p===""?-1:Math.round((new Date(p)).getTime()/1E3),c=l===""?-1:Math.round((new Date(l)).getTime()/1E3);return a.ajax({url:"/lanes/bounds",type:"POST",data:{lane_id:m.currentLane.id,from:b,to:c}})}()).done(function(a){a?f.location.href="/"+m.currentUser.username+"/"+e+"#drawer=open":(f.location.href="/"+m.currentUser.username+"/"+m.currentLane.title+"#drawer=open",m.currentLane.mode!=="new"&&
f.location.reload())}).fail(function(){b.showDrawerContent();b.hideDrawerLoader();a("#drawer-actions").removeClass("visibility-hidden");a("#lane-title-input").focus().tipsy({trigger:"manual",gravity:"w",fallback:a.i18n.t("You already have a lane with this name. We can't create another lane with the same exact name.")}).tipsy("show").blur(function(){a("#lane-title-input").tipsy("hide")})})},setupEditViewAndNewViewEvents:function(){a(".lane-input-date").datepicker({dateFormat:"mm/dd/yy",constrainInput:true,
changeYear:true,prevText:"<",nextText:">",closeText:"Close",onClose:function(b,c){a(c.input).val()==="mm/dd/yyyy"&&a(c.input).val("")},beforeShow:function(b){a(b).val()===""&&a(b).val("mm/dd/yyyy")}});a(".calendar-icon").click(function(){a(this).next("input").focus()});a(".uncheck-all-checkbox").bind("click",function(b){var c=a("#streaming-services input:checked");a("#streaming-services input").prop("checked",false);c.trigger("click",[b.target]);return false});a(".check-all-checkbox").bind("click",
function(b){var c=a("#streaming-services input:not(:checked)");a("#streaming-services input").prop("checked",true);c.trigger("click",[b.target]);return false});a(".lane-upload-input-file").ajaxfileupload({action:"/lanes/"+m.currentLane.id+"/avatar.upload",params:{_csrf:m.csrf},onComplete:function(){a(".lane-drawer-avatar").load(function(){a("#avatar-loader").removeClass("avatar-loader")}).attr("src",a(".lane-drawer-avatar").attr("src")+"?time="+new Date)},onStart:function(){a("#avatar-loader").addClass("avatar-loader")}});
a("#lane-title-input").alphanumeric({ichars:"#/?%:!"}).keypress(function(b){a(this);(b.which==35||b.which==63||b.which==47||b.which==37||b.which==92||b.which==33)&&a("#lane-title-input").tipsy({trigger:"manual",gravity:"w",fallback:a.i18n.t("Lane titles cannot contain the following characters # % ? /  ! :")}).tipsy("show")}).blur(function(){a("#lane-title-input").tipsy("hide")});a("#cherryPickingCopy").tipsy({trigger:"hover",offset:5,html:true,gravity:"w",fallback:"<p>"+a.i18n.t("Contributors to this lane can add or remove individual memos from this lane by clicking on the [+] or [-] buttons on an open memo they created.")+
'</p><p class="zeroMarginBottom">'+a.i18n.t("The creator of the lane can individually add or remove their own memos, and the memos of any lane contributors.")+"</p>"});a("#streamingCopy").tipsy({trigger:"hover",offset:5,html:true,gravity:"w",fallback:'<p class="zeroMarginBottom">'+a.i18n.t("Streaming a service means that you are adding all the memos that this person shares with you on this service to your lane.")+"</p>"})},addEditView:function(){var b=this;this.showDrawerLoader();_.delay(a.proxy(this.openDrawer,
this),1E3);a.when(a.ajax({url:"/friends/all"})).done(function(){var c=a.tmpl(b.templates.drawerEdit,{laneInfo:m.currentLane,ser:m.currentLane.available_services}).html();b.hideDrawerLoader();b.showDrawerContent();b.$drawerContent.after(b.templates.saveLaneAction).find(".jspPane").append(c).end().height(b.$drawerContent.height()-43).data("jsp").reinitialise();a("#cancel-lane-edit").bind(m.clickOrTouchStart,function(){b.saveLane();return false});a("#lane-edit-delete").bind(m.clickOrTouchStart,function(){b.removeLaneDialog();
return false});b.setupEditViewAndNewViewEvents();a("#lane-contrib-list li").bind("click",function(c){a(c.target).is("input")?b.contributorToggle(c.target):($checkbox=a(this).find("input"),$checkbox.prop("checked")?$checkbox.prop("checked",false):$checkbox.prop("checked",true),b.contributorToggle($checkbox))});b.$drawer.delegate("#streaming-services input","click",function(a,c){b.serviceCheckboxToggle(this);if(c)return false})})},removeLaneDialog:function(){var b=a.tmpl(m.globalTemplates.dialogs.removeLane,
{title:m.currentLane.title});b.find(".removeConfirm").bind(m.clickOrTouchEnd,function(){a.ajax({type:"delete",url:"/lanes/"+m.currentLane.id,success:function(){f.location.href="/"+m.currentUser.username}});return false});b.lightbox_me({centered:true})},removeMyContribDialog:function(){var b=a.tmpl(this.templates.removeLaneContrib,{title:m.currentLane.title});b.find(".removeConfirm").bind(m.clickOrTouchEnd,function(){a.ajax({type:"delete",url:"/lanes/contributor",data:{lane_id:m.currentLane.id,username:m.currentUser.username},
success:function(){f.location.reload()}});return false});b.lightbox_me({centered:true})},addLaneView:function(){var b=this;this.showDrawerLoader();this.urlHashObject.drawer==="open"&&_.delay(a.proxy(this.openDrawer,this),1E3);var c=a.tmpl(this.templates.drawerView,m.currentLane).html();this.currentUserIsOwner&&(this.$drawerContent.height(this.$drawerContent.height()-43),this.$drawerContent.after(this.templates.editLaneAction));!this.currentUserIsOwner&&this.currentUserIsContributor&&(this.$drawerContent.height(this.$drawerContent.height()-
43),this.$drawerContent.after(this.templates.removeContribAction));this.hideDrawerLoader();this.showDrawerContent();this.$drawerContent.find(".jspPane").append(c).end().data("jsp").reinitialise();a("#drawer-edit-lane-link").bind(m.clickOrTouchStart,function(){b.hideDrawerContent();b.$drawerContent.height(b.$drawerContent.height()+43).find(".jspPane").empty();a("#drawer-actions").remove();b.addEditView();m.utilities.urlHash.go(m.utilities.urlHash.set("drawer=edit"));return false});a("#remove-my-memos-link").bind(m.clickOrTouchStart,
function(){b.removeMyContribDialog();return false})},showDrawerLoader:function(){this.$drawer.addClass("small-loader-on-grey")},hideDrawerLoader:function(){this.$drawer.removeClass("small-loader-on-grey")},hideDrawerContent:function(){this.$drawerContent.addClass("visibility-hidden")},showDrawerContent:function(){this.$drawerContent.removeClass("visibility-hidden")},openDrawer:function(){if(!this.drawerIsOpen)this.drawerIsOpen=true,this.$headerLaneTitle.hide(),a("#screenLeftBtn,#screenRightBtn").trigger("mouseout"),
this.$screenLeftBtn.stop().animate({left:this.$drawer.outerWidth()},400,"easeOutCubic"),this.$drawer.stop().animate({left:"0"},400,"easeOutCubic"),this.$slotLoaderLeft.stop().animate({left:this.$drawer.outerWidth()},400,"easeOutCubic"),a("#openMemo").length&&m.memos.rePositionOpenedMemo(),this.$drawerHandlerIcon.animate({rotate:"+=180deg"},500)},closeDrawer:function(b,c,d){var b=b||200,e=Modernizr.sessionstorage?sessionStorage.getItem("drawerAware")?0:500:0;this.drawerIsOpen=false;this.$headerLaneTitle.show();
this.$screenLeftBtn.stop().animate({left:"0px"},200,"easeOutCubic");this.$slotLoaderLeft.stop().animate({left:0},200,"easeOutCubic");this.$drawer.stop().animate({left:-this.$drawer.outerWidth()},b,"easeOutCubic",c||jQuery.noop());a("#openMemo").length&&m.memos.rePositionOpenedMemo();this.$drawerHandlerIcon.animate({rotate:"-=180deg"},e);if(a(d).is("#lane-drawer-tab")||a(d).closest("#lane-drawer-tab").length===1)f.location.hash=""},onClickOrTouchStart:function(a){this.drawerIsOpen?this.closeDrawer(200,
null,a.target):this.openDrawer();return false},templates:{drawerView:'<div><img src="${avatar}" alt="laneDrawerAvatar" width="37" height="37" class="lane-drawer-avatar" /><h2 class="header lane-drawer-title">${title}</h2><p class="lane-drawer-description clearfix">${description}</p><div class="lane-drawer-section">\t<div class="lane-drawer-section-title">'+a.i18n.t("Streaming","streaming memos from")+" ${visible_memos} "+a.i18n.t("memos","streaming memos from")+" {{if visible_memos !== 0 }}"+a.i18n.t("from",
"streaming memos from")+'{{/if}}:</div></div><ul class="services-used" style="margin:7px 0 5px 5px;">  {{each available_services}}  {{if $value.selected}}\t\t<li title="${$value.service}" class="services-used-${$value.service}">\t\t\t${$value.service}\t\t</li>\t{{/if}}  {{/each}}</ul>{{if visible_memos !== 0 }}<div class="lane-drawer-date-range clearfix">\t<div class="lane-drawer-date-range-txt">'+a.i18n.t("First memo:")+' <strong>${m.utilities.dateFormat(first_memo*1000,"UTC:mmmm d, yyyy")}</strong></div>\t<div class="lane-drawer-date-range-txt">'+
a.i18n.t("Last memo:")+' <strong>${m.utilities.dateFormat(last_memo*1000,"UTC:mmmm d, yyyy")}</strong></div></div>{{else}}<div class="drawer-add-txt"><strong>'+a.i18n.t("This lane contains no memos.</strong> If you are the owner of this lane try adjusting the streaming services or add memos individually. If you are a contributor try adding memos individually by opening a memo and click the [+] button.")+'</div>{{/if}}<div class="lane-drawer-section">\t<div class="lane-drawer-section-title">'+a.i18n.t("Memos contributed by:")+
'</div></div><ul id="memos-from">  {{each available_contributors}}  {{if $value.selected}}\t<li>\t\t<a href="/${username}" title="view dashboard">      {{if role === "owner"}}\t\t\t<div class="lane-owner-icon">owner</div>\t\t{{else}}      \t{{if m.currentUser && m.currentUser.username === username}}\t\t\t\t<div class="lane-you-icon">you</div>      \t{{/if}}      {{/if}}\t\t<img src="/${username}/image" alt="topBarAvatar" width="20" height="20" /><span class="memos-from-name">${full_name}<span class="memos-from-username">(${username})</span></span>\t\t</a>\t</li>\t{{/if}}  {{/each}}</ul></div>',
drawerEdit:'<div><img src="${m.utilities.breakURLCache(laneInfo.avatar)}" alt="laneDrawerAvatar" width="37" height="37" class="lane-drawer-avatar" /><div id="avatar-loader"></div><div id="avatar-button"><a href="#" id="add-edit-lane-avatar">'+a.i18n.t("change","change lane avatar lane")+'</a><input type="file" name="img_raw" class="lane-upload-input-file" width:"5px" /></div><input type="text" class="display-block float-right" id="lane-title-input" style="width:187px;margin-bottom:5px;" value="${laneInfo.title}" placeholder="'+
a.i18n.t("Enter name of lane")+'" /><textarea class="display-block float-right" id="lane-descrip-input" rows="5" placeholder="'+a.i18n.t("Enter lane description")+'" style="width:187px">${laneInfo.description}</textarea><div class="lane-drawer-section">\t<div class="lane-drawer-section-title">'+a.i18n.t("Select the lane contributors:")+'</div>\t<div class="lane-drawer-section-title-sub">'+a.i18n.t('Contributors provide the memos. You can <a href="#" id="streamingCopy">stream</a> or <a href="#" id="cherryPickingCopy">individually add/remove</a> memos from contributors.')+
'\t</div></div><ul id="lane-contrib-list">{{each laneInfo.available_contributors}}\t<li>\t\t<img src="/${username}/image" width="20" height="20" /><input type="checkbox" {{if $value.selected }}checked="checked"{{/if}} data-username="${$value.username}" /><span class="lane-contrib-list-name">${full_name} <span class="lane-contrib-list-username">(${username})</span></span>\t</li>{{/each}}</ul><div class="lane-drawer-section">\t<div class="lane-drawer-section-title">'+a.i18n.t("Set memo streaming rules for contributors:")+
'</div>\t<div class="lane-drawer-section-title-sub">'+a.i18n.t("Individually selected memos (+/-) are not subject to streaming rules.")+'</div></div><div class="lane-drawer-section-label">'+a.i18n.t("Services to stream:")+' <span class="all-none-checkbox"> <a href="#" class="check-all-checkbox">'+a.i18n.t("all","select all")+'</a> | <a href="#" class="uncheck-all-checkbox">'+a.i18n.t("none","select none")+'</a></span></div>{{tmpl m.drawer.templates.drawerNewServList}}<div class="lane-drawer-section-label">'+
a.i18n.t("Start Streaming Date:")+'</div><div class="streaming-date-range">\t<div id="stream-start-date">\t<div class="calendar-icon"></div>\t\t<input type="text" id="lane-input-start-date" value="{{if laneInfo.bounds.from}}${m.utilities.dateFormat(laneInfo.bounds.from*1000,"shortDateWithZero")}{{/if}}" data-date="{{if laneInfo.bounds.from}}${m.utilities.dateFormat(laneInfo.bounds.from*1000,"shortDateWithZero")}{{/if}}" class="lane-input-date" /><div class="stream-date-txt">'+a.i18n.t("Leave empty to stream as far back as the content goes.")+
'</div>\t</div></div><div class="lane-drawer-section-label">'+a.i18n.t("End Streaming Date:")+'</div><div class="streaming-date-range">\t<div id="stream-end-date">\t\t<div class="calendar-icon"></div>\t\t<input type="text" id="lane-input-end-date" class="lane-input-date" value="{{if laneInfo.bounds.to}}${m.utilities.dateFormat(laneInfo.bounds.to*1000,"shortDateWithZero")}{{/if}}" data-date="{{if laneInfo.bounds.to}}${m.utilities.dateFormat(laneInfo.bounds.to*1000,"shortDateWithZero")}{{/if}}" /> <div class="stream-date-txt">'+
a.i18n.t("Leave empty to stream continuously forever and ever.")+'</div>\t</div></div><div style="clear:both;height:1px;"></div></div>',drawerNew:'<div><img src="${m.utilities.breakURLCache(avatar)}" alt="laneDrawerAvatar" width="37" height="37" class="lane-drawer-avatar" /><div id="avatar-loader"></div><div id="avatar-button"><a href="#" id="add-edit-lane-avatar">'+a.i18n.t("change","change lane avatar lane")+'</a><input type="file" name="img_raw" class="lane-upload-input-file" /></div><input type="text" class="display-block float-right" id="lane-title-input" style="width:187px;margin-bottom:5px;" placeholder="'+
a.i18n.t("Enter name of lane")+'" /><textarea class="display-block float-right" id="lane-descrip-input" rows="5" style="width:187px" placeholder="'+a.i18n.t("Enter lane description")+'"></textarea><div class="lane-drawer-section">\t<div class="lane-drawer-section-title">'+a.i18n.t("Select lane contributors:")+'</div>\t<div class="lane-drawer-section-title-sub">'+a.i18n.t('Contributors provide the memos. You can <a href="#" id="streamingCopy">stream</a> or <a href="#" id="cherryPickingCopy">individually add/remove</a> memos from contributors.')+
'\t</div></div><ul id="lane-contrib-list">  {{each contr}}\t<li>\t\t<img src="/${$value.username}/image" width="20" height="20" /><input type="checkbox" {{if $value.selected }}checked="checked"{{/if}} data-username="${$value.username}" /><span class="lane-contrib-list-name">${$value.full_name} <span class="lane-contrib-list-username">(${$value.username})</span></span>\t</li>  {{/each}}</ul><div class="lane-drawer-section">\t<div class="lane-drawer-section-title">'+a.i18n.t("Set memo streaming rules for contributors:")+
'</div>\t<div class="lane-drawer-section-title-sub">'+a.i18n.t("Individually selected memos (+/-) are not subject to streaming rules.")+'</div></div><div class="lane-drawer-section-label">'+a.i18n.t("Services to stream:")+' <span class="all-none-checkbox"> <a href="#" class="check-all-checkbox">'+a.i18n.t("all","select all")+'</a> | <a href="#" class="uncheck-all-checkbox">'+a.i18n.t("none","select none")+'</a></span></div>{{tmpl m.drawer.templates.drawerNewServList}}<div class="lane-drawer-section-label">'+
a.i18n.t("Start streaming date:")+'</div><div class="streaming-date-range">\t<div id="stream-start-date">\t<div class="calendar-icon"></div>\t\t<input type="text" id="lane-input-start-date" value="" data-date="" class="lane-input-date" /><div class="stream-date-txt">'+a.i18n.t("Leave empty to stream as far back as there is content.")+'</div>\t</div></div><div class="lane-drawer-section-label">'+a.i18n.t("End Streaming date:")+'</div><div class="streaming-date-range">\t<div id="stream-end-date">\t\t<div class="calendar-icon"></div>\t\t<input type="text" id="lane-input-end-date" class="lane-input-date" value="" date-date="" /> <div class="stream-date-txt">'+
a.i18n.t("Leave empty to stream continuously forever and ever.")+'</div>\t</div></div><div style="clear:both;height:1px;"></div>',drawerNewServList:'<ul id="streaming-services" class="clearfix">{{if ser.length}}  {{each ser}}\t<li>\t\t<label title="${$value.service}"><input data-service-name="${$value.service}" type="checkbox" {{if $value.selected }}checked="checked"{{/if}} /><div class="${$value.service}-icon service-icon">${$value.service}</div></label>  {{/each}}{{else}}\t\t<li id="streaming-services-nonselected">'+
a.i18n.t("Choose (above) who to stream memos from.")+"</li>{{/if}}</ul>",removeLaneContrib:'<div id="" class="memolaneDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">'+a.i18n.t("Remove Lane Contributions")+'</div>\t\t<div class="close closeMemolaneDialog cancelAddingBtn">'+a.i18n.t("cancel","close dialog")+'</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<p><strong>'+a.i18n.t("Are you sure you want to remove your contributions to")+" ${title}</strong>?</p>\t\t<p>"+
a.i18n.t("All memo contributions will be lost, and any work you've put into curating this lane will be permanently erased!")+'</p>\t\t<p><a href="#" class="btn-red float-left removeConfirm close">'+a.i18n.t("Yes, REMOVE")+'</a> <a href="#" class="secondaryAction float-left close">'+a.i18n.t("No, I don't want that")+"</a></p>\t</div></div>",editLaneAction:'<div id="drawer-actions"><div class="gear-icon float-left"></div><a href="#" id="drawer-edit-lane-link">'+a.i18n.t("Edit this lane")+"</a></div>",
removeContribAction:'<div id="drawer-actions"><div class="delete-icon float-left"></div><a href="#" id="remove-my-memos-link">'+a.i18n.t("Remove myself and my memos from this lane")+"</a></div>",saveLaneAction:'<div id="drawer-actions"><a href="#" class="btn-green" id="cancel-lane-edit">'+a.i18n.t("Done editing")+'</a><a href="#" id="lane-edit-delete">'+a.i18n.t("Delete Lane")+"</a></div>",createLaneAction:'<div id="drawer-actions"><button class="btn-green float-left" id="create-new-lane-btn">'+a.i18n.t("Done",
"done editing lane from drawer")+'</button><div id="cancel-lane-creation">'+a.i18n.t('or never mind <a href="#">delete</a> this lane</div></div>')}}}(this,jQuery,this.undefined);m.drawer.initialize();
m.laneNavBtns=function(f,a){return{$screenLeftBtn:a("#screenLeftBtn"),$screenRightBtn:a("#screenRightBtn"),$screenBtn:a("#screenLeftBtn,#screenRightBtn"),initialize:function(){this.$screenBtn.bind(m.mouseOverOrTouchStart,this.onMouseOverOrTouchStart).bind(m.mouseOutOrTouchEnd,this.onMouseOutOrTouchEnd);this.$screenLeftBtn.bind(m.clickOrTouchStart,this.onClickLeftBtn);this.$screenRightBtn.bind(m.clickOrTouchStart,this.onClickRightBtn);a(document).keyup(function(b){if(a("input:focus,textarea:focus,select:focus").length)return false;
switch(b.which){case 37:a("#screenLeftBtn").trigger("click");break;case 39:a("#screenRightBtn").trigger("click")}})},onMouseOverOrTouchStart:function(){a(this).stop().animate({width:"50px",opacity:0.9},100,"swing");return false},onMouseOutOrTouchEnd:function(){if(a("#slot-loader-left").is(":visible")||a("#slot-loader-right").is(":visible"))return false;a(this).stop().animate({width:"25px",opacity:0.6},100,"swing");return false},onClickLeftBtn:function(){if(a(this).is(":hidden")||m.lane.cancelLaneMovement===
true)return false;var b=a("#lane-viewport"),c=b.scrollLeft(),d=m.drawer.drawerIsOpen?a("#lane-drawer").width():0;if(c<=0)return false;m.lane.moveLane({xpos:c-(b.width()-d),animate:true});return false},onClickRightBtn:function(){if(a(this).is(":hidden")||m.lane.cancelLaneMovement===true)return false;var b=a("#lane-viewport"),c=b.scrollLeft(),d=m.drawer.drawerIsOpen?a("#lane-drawer").width():0;if(c>=a("#lane").width())return false;m.lane.moveLane({xpos:c+(b.width()-d),animate:true});return false}}}(this,
jQuery,this.undefined);m.laneNavBtns.initialize();
m.lane=function(f,a){return{$laneViewport:a("#lane-viewport"),$lane:a("#lane"),$content:a("#content"),$screenLeftBtn:a("#screenLeftBtn"),$screenRightBtn:a("#screenRightBtn"),$laneViewportAndLanNav:a("#lane-viewport,.screenBtn"),currentlyCenteredLaneMemoTime:"",cancelLaneMovement:false,initialize:function(){this.$laneViewport.bind(m.mouseDownOrTouchStart,this.onMouseDownOrTouchStart).bind(m.mouseUpOrTouchEnd,this.onMouseUpOrTouchEnd).bind(m.mouseMoveOrTouchMove,a.proxy(this.onMouseMoveOrTouchMove,
this)).bind("mouseleave",this.onMouseUpOrTouchEnd).mousewheel(a.proxy(this.onMouseWheel,this));a("#favorite-un-fav").bind(m.clickOrTouchEnd,this.favUnFavLane)},moveLane:function(a){if(this.cancelLaneMovement===true)return false;var c=this;a.animate?(this.cancelLaneMovement=true,this.$laneViewport.stop().animate({scrollLeft:a.xpos},1E3,"easeOutCubic",function(){c.moveLaneComplete()})):(this.$laneViewport.scrollLeft(a.xpos),this.moveLaneComplete());this.updateCurrentlyCenteredLaneMemoTime();m.timeline.showFixedIndicatorByTimestamp()},
moveLaneComplete:function(){m.memos.closeOpenedMemoWhenOffScreen();this.loadMoreMemos();this.updateCurrentlyCenteredLaneMemoTime();m.timeline.showFixedIndicatorByTimestamp();this.onLaneEndRemoveNavBtn();this.cancelLaneMovement=false},moveLaneToMemo:function(b){b=a("#"+b).offset().left;b=b<0?this.$laneViewport.scrollLeft()-Math.abs(b):this.$laneViewport.scrollLeft()+b;this.moveLane({xpos:Math.round(b-(a("#lane-viewport").width()/2-100))})},updateCurrentlyCenteredLaneMemoTime:function(){var b=this;
a(".memo").each(function(){var c=a(this).offset().left,c=c<0?b.$laneViewport.scrollLeft()-Math.abs(c):b.$laneViewport.scrollLeft()+c;if(c>=a("#lane-viewport").scrollLeft()+a("#lane-viewport").width()/2)return b.currentlyCenteredLaneMemoTime=a(this).data("time"),false})},trimLaneLeft:function(){var b=a("#lane-viewport").width(),c=b*3,d=0;a("#lane .lane-slot").each(function(){var e=a(this);e.offset().left<0&&Math.abs(e.offset().left)>c&&e.width()<c-b&&(e.addClass("removeSlot"),d+=e.width())});if(d>
0){var e=this.$laneViewport.scrollLeft();a(".removeSlot").remove();this.$lane.width(a("#lane").width()-d);this.$laneViewport.scrollLeft(e-d)}},trimLaneRight:function(){var b=a("#lane-viewport").width(),c=b*3,d=0;a("#lane .lane-slot").each(function(){var e=a(this);e.offset().left>c&&e.width()<c-b&&(e.addClass("removeSlot"),d+=e.width())});d>0&&(a(".removeSlot").remove(),this.$lane.width(a("#lane").width()-d))},loadMoreMemos:function(){var b=a("#lane-viewport"),c=parseInt(a("#content .memo").first().data("time")),
d=parseInt(a("#content .memo").last().data("time"));c!=m.currentLane.first_memo&&b[0].scrollLeft<b.width()*2&&m.laneLoadMemos.loadMemosLeft();d!=m.currentLane.last_memo&&b[0].scrollWidth-b[0].scrollLeft<b.width()*2&&m.laneLoadMemos.loadMemosRight()},onMouseDownOrTouchStart:function(b){if(!a(b.target).closest(".openMemo").length){if(b.originalEvent.touches||b.originalEvent.changedTouches)var c=b.originalEvent.touches[0]||b.originalEvent.changedTouches[0];a(this).data("down",true).data("x",b.pageX||
c.pageX).data("scrollLeft",this.scrollLeft).data("currentMouseX",b.pageX||c.pageX).data("currentMouseY",b.pageY||c.pageX).css("cursor","ew-resize");b.preventDefault()}},onMouseUpOrTouchEnd:function(b){a("#lane-viewport").data("down",false).css("cursor","default");a(".memo").css("cursor","pointer");f.setTimeout(function(){a("#lane-viewport").data("drag",false)},100);b.stopPropagation()},onMouseMoveOrTouchMove:function(b){var c=a(b.currentTarget);if(b.originalEvent.touches||b.originalEvent.changedTouches)var d=
b.originalEvent.touches[0]||b.originalEvent.changedTouches[0];if(this.$laneViewport.data("down")===true){var e=b.pageX-c.data("currentMouseX"),g=b.pageY-c.data("currentMouseY");Math.abs(e)+Math.abs(g)>5&&(this.$laneViewport.data("drag",true),a(".memo").css("cursor","ew-resize"));this.moveLane({xpos:c.data("scrollLeft")+c.data("x")-(b.pageX||d.pageX)})}return false},onMouseWheel:function(b,c){this.cancelLaneMovement!==true&&a(b.target).closest(".openMemo").length!==1&&m.lane.moveLane({xpos:b.currentTarget.scrollLeft-=
c*30})},onLaneEndRemoveNavBtn:function(){this.$laneViewport.scrollLeft()===0?this.$screenLeftBtn.hide():this.$screenLeftBtn.show();this.$laneViewport.scrollLeft()+this.$laneViewport.width()===a("#lane").width()||a("#lane").width()<this.$laneViewport.width()?this.$screenRightBtn.hide():this.$screenRightBtn.show()},stretchSlot:function(){var b=a("#lane").width();if(b<=this.$laneViewport.width()){a("#lane").width(this.$laneViewport.width());var c=a("#lane .lane-slot").filter(":last").find(".lane-slot-memos");
c.width(this.$laneViewport.width()-b+c.width())}},hideLane:function(){this.$laneViewportAndLanNav.css("visibility","hidden")},showLane:function(){this.$laneViewportAndLanNav.css("visibility","visible")},hideLaneLoader:function(){this.$content.removeClass("lane-load")},showLaneLoader:function(){this.$content.addClass("lane-load")},favUnFavLane:function(){var b=a(this);b.data("fav")===false?a.ajax({url:"/lanes/favorite",type:"POST",data:{lane_id:m.currentLane.id}}).success(function(){b.attr("title",
a.i18n.t("Un-favorite Lane")).data("fav","true");b.addClass("favorited")}):a.ajax({url:"/lanes/favorite",type:"DELETE",data:{lane_id:m.currentLane.id}}).success(function(){b.attr("title",a.i18n.t("Favorite Lane")).data("fav",false);b.removeClass("favorited")});return false}}}(this,jQuery,this.undefined);m.lane.initialize();
m.memos=function(f,a){return{$memo:a(".memo"),$laneViewport:a("#lane-viewport"),openMemoCommentsOnPageLoad:m.utilities.urlHash.get("showcomments"),memoStore:{},initialize:function(){this.$laneViewport.delegate(".memo",m.clickOrTouchEnd,a.proxy(this.openMemo,this));this.$laneViewport.delegate(".closeOpenMemo",m.clickOrTouchEnd,a.proxy(this.closeMemo,this));this.$laneViewport.delegate(".memoAvatar",m.clickOrTouchEnd,a.proxy(this.goToMemoOwnersDashboard,this));this.$laneViewport.delegate(".music-play-btn",
m.clickOrTouchEnd,a.proxy(this.handleMusicClick,this))},goToMemoOwnersDashboard:function(a){a.stopPropagation()},openMemo:function(b){var c=this;if(this.$laneViewport.data("drag"))return this.$laneViewport.data("drag",false),false;var d=a(".openMemo");if(d.length){a(".largeMemoDialog .close").click();var e=d.data("memoOpenInfo");d.add(".memoGhost").addClass("memoClosing");_.size(e)?a(".memoClosing").animate({height:e.memoH,width:e.memoW,top:e.memoY,left:e.memoX},400,"easeInExpo",function(){e.memo.css("visibility",
"visible");a(this).remove()}):(a(".memoClosing").remove(),a(".memo").css("visibility","visible"))}var g=a(b.currentTarget),h=this.memoStore[g.attr("id")],b=this.$laneViewport.append(a.tmpl(this.templates.largeMemos[h.service]?this.templates.largeMemos[h.service]:this.templates.largeMemos["default"],h)).find(".openMemo").filter(":last"),d=a(".openMemo:not(.memoClosing) .largeMemoFooterBar");d.find(".memo_privacy").bind(m.clickOrTouchEnd,function(){c.setMemoPrivacyDialog(h);return false});d.find(".memo_laneAdd").bind(m.clickOrTouchEnd,
function(){c.addMemoToLaneDialog(h);return false});d.find(".memo_laneRemove").bind(m.clickOrTouchEnd,function(){c.removeMemoFromLaneDialog(h);return false});d.find("a.memo_like").bind(m.clickOrTouchEnd,function(a){c.likeOrUnlikeMemo(a,h);return false});d.find(".memo_like_text").bind(m.clickOrTouchEnd,function(a){c.whoLikedIt(a,h);return false});d.find("#changeMemoDate").bind(m.clickOrTouchEnd,function(a){c.changeMemoDate(a,h);return false});var f=a("#lane-viewport").height()-20,d=a("#lane-viewport").width(),
k=a(".openMemo:not(.memoClosing)").outerWidth(true);a(".openMemo:not(.memoClosing)").outerHeight(true);k>d&&(k=d,a(".openMemo:not(.memoClosing)").width(d).css("max-width",d));b.find(".memoMapContainer").length&&this.handleMapMemos();a(".openMemo:not(.memoClosing) .largeMemoContent img").length?a(".largeMemoContent img").imagesLoaded(function(){a(".openMemo:not(.memoClosing) .lrgMemoImg").length?c.renderMemoWithFittedImgDimensions(g,f):c.renderMemoDimensions(g,f)}):this.renderMemoDimensions(g,f)},
whoLikedIt:function(b,c){a.ajax({url:"/memos/"+c.id+"/liked_by",type:"GET"}).success(function(b){a.tmpl(m.globalTemplates.dialogs.genericListOfUsersDialog,b,{dialogTitle:a.i18n.t("Users who like this memo")}).lightbox_me({destroyOnClose:true})});return false},changeMemoDate:function(b,c){f._gaq.push(["_trackEvent","date picker","open"]);a('<div id="changeDateAndTimeDialog" class="memolaneDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">'+a.i18n.t("Change memo date and time")+'</div>\t\t<div class="closeMemolaneDialog">'+
a.i18n.t("close","clicking on this button closes the dialog window")+'</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t<input type="text" id="memoDateInput" value="12-12-2011 11:23:01 PM" class="visibility-hidden" />\t<a href="#" id="saveMemoDateChange" class="btn-green">save</a>  <p class="float-right display-none" id="changeMemoDateReload">'+a.i18n.t('Actual changes to the lane occur when lane is <a href="#">reloaded</a>')+"</p>\t</div></div>").find(".closeMemolaneDialog").bind(m.clickOrTouchEnd,
function(){a("#memoDateInput").AnyTime_noPicker().remove();a("#changeDateAndTimeDialog").trigger("close")}).end().find("#saveMemoDateChange").bind(m.clickOrTouchEnd,function(){var b=a(this),e=(new AnyTime.Converter({format:"%m-%d-%Y %h:%i:%s %p"})).parse(a("#memoDateInput").val());b.text("saving").addClass("inactive");a.ajax({url:"/memos/"+c.id+"/move",type:"POST",data:{timestamp:e.getTime()/1E3}}).success(function(){b.text("saved");f._gaq.push(["_trackEvent","date picker","change saved"]);a("#changeMemoDateReload:hidden").fadeIn();
setTimeout(function(){b.text("save").removeClass("inactive")},2E3)});return false}).end().find("#changeMemoDateReload a").bind(m.clickOrTouchEnd,function(){f._gaq.push(["_trackEvent","date picker","reload"]);f.location.reload();return false}).end().find("#memoDateInput").val(m.utilities.dateFormat(c.created_at*1E3,"dateTimeForMemoChangeDate")).end().lightbox_me({onLoad:function(){a("#memoDateInput").AnyTime_picker({hideInput:true,placement:"inline",labelDayOfMonth:"Day",labelTitle:"",format:"%m-%d-%Y %h:%i:%s %p",
labelDismiss:"close"})},onClose:function(){a("#memoDateInput").AnyTime_noPicker().remove()}});return false},renderMemoDimensions:function(b,c){var d=this;this.shrinkLargeMemoWhitespace();var e=a(".openMemo:not(.memoClosing)").outerWidth(true),g=a(".openMemo:not(.memoClosing)").outerHeight(true),h=a(".openMemo:not(.memoClosing)");h.height()>c&&(g=h.find(".largeMemoTitleBar").outerHeight(true)+h.find(".largeMemoFooterBar").outerHeight(true),h.find(".largeMemoContent").css("height",Math.floor(c-g)),
g=c);var h=d.$laneViewport.scrollLeft(),f=d.$laneViewport.width()/2-e/2,k=d.$laneViewport.height()/2-g/2,l=(m.drawer.drawerIsOpen?a("#lane-drawer").width():0)/2;b.css("visibility","hidden");a(".openMemo:not(.memoClosing), .memoGhost").css({left:b.offset().left+h-10,top:b.position().top+25}).height(b.height()).width(b.width()).show().filter(".openMemo").css("visibility","visible").data("memoOpenInfo",{memoX:b.offset().left+h-10,memoY:b.position().top+25,memoH:b.height(),memoW:b.width(),memo:b}).animate({height:g,
width:e,top:k,left:f+h+l-12},500,"easeOutExpo",function(){if(d.openMemoCommentsOnPageLoad==="true")return a(".openMemo .memo_comments").trigger("click"),false})},renderMemoWithFittedImgDimensions:function(b,c){var d=this,e=a(".openMemo:not(.memoClosing)");e.width();var g=e.height(),h=e.find(".largeMemoTitleBar").outerHeight(true)+e.find(".largeMemoFooterBar").outerHeight(true),f=e.find(".largeMemoContent").outerHeight(true)-e.find(".largeMemoContent img").outerHeight(true),k=e.find(".lrgMemoImg img:first");
k.width();k.height();g>c&&(g=Math.floor(c-h-f),g<50&&(g=50),e.find(".largeMemoContent img").attr("height",g));a(".openMemo:not(.memoClosing)").outerHeight(true)>c&&(g=c,a(".openMemo:not(.memoClosing)").height(c).css("max-height",c));d.shrinkLargeMemoWhitespace();var e=a(".openMemo:not(.memoClosing)").outerWidth(true),g=a(".openMemo:not(.memoClosing)").outerHeight(true),h=d.$laneViewport.scrollLeft(),f=d.$laneViewport.width()/2-e/2,k=d.$laneViewport.height()/2-g/2,l=(m.drawer.drawerIsOpen?a("#lane-drawer").width():
0)/2;b.css("visibility","hidden");a(".openMemo:not(.memoClosing), .memoGhost").css({left:b.offset().left+h-10,top:b.position().top+25}).height(b.height()).width(b.width()).show().filter(".openMemo").css("visibility","visible").data("memoOpenInfo",{memoX:b.offset().left+h-10,memoY:b.position().top+25,memoH:b.height(),memoW:b.width(),memo:b}).animate({height:g,width:e,top:k,left:f+h+l-12},500,"easeOutExpo",function(){if(d.openMemoCommentsOnPageLoad==="true")return a(".openMemo .memo_comments").trigger("click"),
false})},shrinkLargeMemoWhitespace:function(){},closeMemo:function(){a(".largeMemoDialog .close").click();var b=a(".openMemo:first").data("memoOpenInfo");_.size(b)?a(".openMemo:first").animate({height:b.memoH,width:b.memoW,top:b.memoY,left:b.memoX},400,"easeInExpo",function(){b.memo.css("visibility","visible");a(".openMemo, .memoGhost").remove()}):(a(".openMemo:first").remove(),a(".memo").css("visibility","visible"))},closeOpenedMemoWhenOffScreen:function(){if(a(".openMemo:first").length){var b=this.$laneViewport.width(),
c=a(".openMemo:first").offset().left;c<0?Math.abs(c)>b&&this.closeMemo():c>b*2&&this.closeMemo()}},rePositionOpenedMemo:function(){var b=a(".openMemo"),c=(m.drawer.drawerIsOpen?a("#lane-drawer").width():0)/2,d=b.width(),e=b.height(),d=this.$laneViewport.width()/2-d/2,e=(this.$laneViewport.height()+25)/2-e/2;b.css({top:e,left:d+this.$laneViewport.scrollLeft()+c-12})},setMemoPrivacyDialog:function(b){var c=a.tmpl(this.templates.dialogs.setPrivacy,b);c.find("#"+b.privacy).addClass("smallButtonActive");
c.find("#"+b.privacy+"TabDescription").css("display","block");c.find(".smallButtonBar li a").bind("mouseenter mouseleave ",function(b){var e=a(this).attr("id");b.type=="mouseenter"?(a(".privacyTabDescription div").hide(),a("#"+e+"TabDescription").show()):c.find(".smallButtonActive").length?(a(".privacyTabDescription div").hide(),b=c.find(".smallButtonActive").attr("id"),a("#"+b+"TabDescription").show()):a(".privacyTabDescription div").hide()});c.find(".smallButtonBar li a").bind(m.clickOrTouchEnd,
function(){var d=this;a.ajax({type:"post",url:"/memos/"+encodeURIComponent(b.id)+"/privacy",data:{privacy:a(d).attr("id")},success:function(){var e=c.find(".smallButtonActive").attr("id"),g=a(d).attr("id");c.find("#"+e).removeClass("smallButtonActive");c.find("#"+e+"TabDescription").hide();c.find("#"+g).addClass("smallButtonActive");c.find("#"+g+"TabDescription").show();a(".openMemo .memo_"+e).removeClass("memo_"+e).addClass("memo_"+g);var h=m.utilities.cleanMemoId(b.id);a("#"+h).find(".memo_privacy").removeClass("memo_"+
e).addClass("memo_"+g);m.memos.memoStore[h].privacy=g}})});c.lightbox_me({destroyOnClose:true})},addMemoToLaneDialog:function(b){var c=this,d=a.tmpl(this.templates.dialogs.addMemoToLane.loading,b);d.lightbox_me({destroyOnClose:true});a.ajax({type:"get",url:"/memos/"+b.id+"/can_be_added_to",success:function(e){var g={};g.lanes=e;e=a.tmpl(c.templates.dialogs.addMemoToLane.loaded,g).html();d.find(".dialogContent").html(e);d.trigger("reposition");d.find(".addMemoToLane").bind(m.clickOrTouchEnd,function(c){var d=
a(this).parent();d.html(a.i18n.t("Adding...","this is a temporary status that tells the user that the system is in the process of associating the memo to the lane"));a.ajax({type:"post",url:"/lanes/include_memo",data:{lane_id:a(this).attr("id"),memo_id:b.id},success:function(){d.html(a.i18n.t("Added!","this is a status that tells the user that the memo has been associated to the lane"))}});c.preventDefault()})}})},removeMemoFromLaneDialog:function(b){var c=this,d=a.tmpl(this.templates.dialogs.removeMemoFromLane,
b);d.find(".removeMemoConfirm").bind(m.clickOrTouchEnd,function(d){a.ajax({type:"delete",url:"/lanes/include_memo",data:{lane_id:m.currentLane.id,memo_id:b.id},success:function(){c.closeMemo();var d=m.utilities.cleanMemoId(b.id);a("#"+d).remove();delete m.memos.memoStore[d]}});d.preventDefault()});d.lightbox_me({destroyOnClose:true})},likeOrUnlikeMemo:function(b,c){$link=a(b.currentTarget);if(!$link.is(".liking")){var d=m.utilities.cleanMemoId(c.id),e=a("#"+d+" .memo_like");$link.is(".liked")?($link.removeClass("liked").addClass("liking"),
a.ajax({type:"post",url:"/memos/"+c.id+"/un_like",data:{lane:m.currentLane.id},success:function(){m.memos.memoStore[d].liked_by_current_user=false;m.memos.memoStore[d].like_count--;$link.removeClass("liking");m.memos.memoStore[d].like_count==0?(m.memos.memoStore[d].like_count=0,$link.siblings(".textWithIcon").text(""),e.removeClass("memo_like_show")):($link.siblings(".textWithIcon").text(m.memos.memoStore[d].like_count),e.removeClass("memo_liked_by_current_user").text(m.memos.memoStore[d].like_count))},
error:function(){$link.removeClass("liking").addClass("liked")}})):($link.addClass("liking"),a.ajax({type:"post",url:"/memos/"+c.id+"/like",data:{lane:m.currentLane.id},success:function(){m.memos.memoStore[d].liked_by_current_user=true;m.memos.memoStore[d].like_count++;$link.removeClass("liking").addClass("liked");$link.siblings(".textWithIcon").text(m.memos.memoStore[d].like_count);e.addClass("memo_liked_by_current_user memo_like_show").text(m.memos.memoStore[d].like_count)},error:function(){$link.removeClass("liking")}}))}b.preventDefault()},
handleMapMemos:function(){var b=a(".openMemo").filter(":last"),c=b.find(".memoMapContainer");if(c.length){var d=m.memos.memoStore[b.data("memo-id")].doc.geo,b=d.poi,e=(d=d.polyline)||_.size(b)>1?true:false;if(e)var g=d?Number(d[0].lat):Number(b[0].lat),h=g,f=d?Number(d[0].lon):Number(b[0].lon),k=f;var l={zoom:14,center:new google.maps.LatLng(b[0].lat,b[0].lon),disableDefaultUI:true,mapTypeControl:false,draggable:true,scrollwheel:false,mapTypeId:google.maps.MapTypeId.ROADMAP},c=new google.maps.Map(c.get(0),
l);if(b)for(i in l=function(a,b,c,d){google.maps.event.addListener(b,"click",function(){var e=new google.maps.InfoWindow,g='<div style="line-height:16px;">';g+='<strong style="font-size:15px; line-height:18px;">'+d.name+"</strong>";d.description&&(g+='<br style="line-height:24px;" />'+d.description);g+="</div>";e.setContent(g);e.setPosition(c);e.open(a,b)})},b){var n=b[i];e&&(n.lat<g?g=Number(n.lat):n.lat>h&&(h=Number(n.lat)),n.lon<f?f=Number(n.lon):n.lon>k&&(k=Number(n.lon)));var o=new google.maps.LatLng(n.lat,
n.lon),r=new google.maps.Marker({position:o});l(c,r,o,n);r.setMap(c)}if(d){b=[];for(j in d)e&&(d[j].lat<g?g=Number(d[j].lat):d[j].lat>h&&(h=Number(d[j].lat)),d[j].lon<f?f=Number(d[j].lon):d[j].lon>k&&(k=Number(d[j].lon))),b.push(new google.maps.LatLng(d[j].lat,d[j].lon));(new google.maps.Polyline({path:b,strokeColor:"#FD7768",strokeOpacity:1,strokeWeight:4})).setMap(c)}e&&(g=new google.maps.LatLng(g,f),h=new google.maps.LatLng(h,k),h=new google.maps.LatLngBounds(g,h),c.fitBounds(h))}},setWidthAndHeightInMemoContent:function(b,
c,d,e){c=c?c:585;d=d?d:390;e||(e=1.5);var g=e/1,h=c,f=d,k=a("#lane-viewport").width(),l=a("#lane-viewport").height()-20-61;k<h&&(h=k);l<f&&(f=l);if(h<c||f<d)f*e>=h?f=h*g:h=f*e;b=b.replace(/__WIDTH__/gi,h);b=b.replace(/__HEIGHT__/gi,f);return b=this.setWmodeInVideoMemos(b)},setWmodeInVideoMemos:function(b){return a("<div>").append(b).find("object, embed").attr("wmode","transparent").end().html()},handleMusicClick:function(b){var c=a(b.currentTarget),d=c.text(),e=c.data("track-name"),g=c.data("artist-name"),
f="amazon",p="/utils/amazon_url";m.currentUser&&m.currentUser.music_provider=="spotify"&&(f="spotify",p="/utils/spotify_url");var k=function(){c.replaceWith('<span style="color:red; font-weight:bold;">'+a.i18n.t("There was an error setting your music provider.","this error denotes that there was a problem when the user tried to set which music provider they would use in the application")+"</span>")};c.text(a.i18n.t("Loading...","this temporary status message tells the user that their requested action is being processed"));
a.ajax({url:p,data:{artist:g,track:e},dataType:"text",error:function(){k()},success:function(a){a!='""'?(c.text(d),f=="spotify"?window.location.href=a:window.open(a,"amazon")):k()}});b.preventDefault()},templates:{largeMemos:{"default":'<div class="memoGhost"></div><div class="openMemo ${service}">\t<div class="largeMemoTitleBar">\t\t{{if (doc && doc.source_url)}}\t\t\t<a href="${doc.source_url}" target="_blank" class="memoServiceIcon" title="'+a.i18n.t("Go back to source","this tells the user that if they click on this button they will be taken to the source of the memo on the service that it was created on")+
"{{if doc && doc.author && doc.author.name}} ("+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'){{/if}}" target="_blank"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon" {{if doc && doc.author && doc.author.name}}title="'+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+
'"{{/if}}></div>\t\t{{/if}}\t\t{{if (doc && doc.title && doc.title.thumbnail) && (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<div class="ownerThumbnail"><div class="thumbText">'+a.i18n.t("From","this label precedes a small image of the user who posted the memo and signifies memo ownership and origin")+' </div><img src="/${user_id}/image" /></div>\t\t{{/if}}\t\t{{if doc.author}}<div class="thumbText"> ('+a.i18n.t("originally by","this label precedes the linked name of the author of the memo and signifies memo ownership and origin")+
' <a href="${doc.author.url}">${doc.author.name}</a>)</div>{{/if}}\t\t<a class="closeOpenMemo">'+a.i18n.t("close","clicking on this button closes the dialog window")+'</a>\t</div>\t<div class="largeMemoContent">\t\t{{if doc && doc.title && doc.title.text}}\t\t\t<p>${doc.title.text}</p>\t\t{{/if}}\t\t{{if doc && doc.image && doc.image.url}}\t\t\t<div class="lrgMemoImg"><img src="${doc.image.url}" /></div>\t\t{{/if}}\t</div>{{tmpl m.memos.templates.largeMemos.largeMemoFooter}}</div>',facebook:'<div class="memoGhost"></div><div class="openMemo facebook">\t<div class="largeMemoTitleBar">\t\t{{if (doc.source_url)}}\t\t\t<a href="${doc.source_url}" target="_blank" class="memoServiceIcon" title="'+
a.i18n.t("Go back to source","this tells the user that if they click on this button they will be taken to the source of the memo on the service that it was created on")+"{{if doc.author && doc.author.name}} ("+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'){{/if}}" target="_blank"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon" {{if doc.author && doc.author.name}}title="'+
a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'"{{/if}}></div>\t\t{{/if}}\t\t{{if (doc.title && doc.title.thumbnail) && (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<div class="ownerThumbnail"><div class="thumbText">'+a.i18n.t("From","this label precedes a small image of the user who posted the memo and signifies memo ownership and origin")+
' </div><img src="${doc.title.thumbnail}" /></div>\t\t{{/if}}\t\t{{if doc.author}}<div class="thumbText"> ('+a.i18n.t("originally by","this label precedes the linked name of the author of the memo and signifies memo ownership and origin")+' <a href="${doc.author.url}">${doc.author.name}</a>)</div>{{/if}}\t\t<a class="closeOpenMemo">'+a.i18n.t("close","clicking on this button closes the dialog window")+'</a>\t</div>\t<div class="largeMemoContent">\t\t{{if doc.sub_type == "status"}}\t\t\t<h3>${doc.title.text}</h3>\t\t{{/if}}\t\t{{if doc.sub_type == "event"}}\t\t\t<h3>${doc.title.text}</h3>\t\t\t<div class="memo-event">\t\t\t{{if created_at}}\t\t\t\t<div class="memo-event-data"><h4>'+
a.i18n.t("Time","this tells the viewer the time of the Facebook event")+'</h4><div><p>${m.utilities.dateFormat( created_at * 1000, "fullDatePlusTime" ).replace("-", "&middot;")}</p></div></div>\t\t\t{{/if}}\t\t\t{{if doc.event && doc.event.location}}\t\t\t\t<div class="memo-event-data"><h4>'+a.i18n.t("Location","this tells the viewer the location of the Facebook event")+'</h4><div><p>${doc.event.location}</p></div></div>\t\t\t{{/if}}\t\t\t{{if doc.author && doc.author.name}}\t\t\t\t<div class="memo-event-data"><h4>'+
a.i18n.t("Created by","attribution for the author of the memo")+'</h4><div><p>${doc.author.name}</p></div></div>\t\t\t{{/if}}\t\t\t{{if doc.text && doc.text.text}}\t\t\t\t<div class="memo-event-data"><h4>'+a.i18n.t("More info","tells the user that additional info is located below")+'</h4><div><p>${doc.text.text}</p></div></div>\t\t\t{{/if}}\t\t\t</div>\t\t{{/if}}\t\t{{if doc.sub_type == "photo"}}\t\t\t<div class="lrgMemoImg"><img src="${doc.image.url}" /></div>\t\t\t{{if doc.title && doc.title.text}}\t\t\t\t<p>${doc.title.text}</p>\t\t\t{{/if}}\t\t{{/if}}\t\t{{if doc.sub_type == "note"}}\t\t\t{{if doc.title && doc.title.text}}\t\t\t\t<h3>${doc.title.text}</h3>\t\t\t{{/if}}\t\t\t{{if doc.text && doc.text.text}}\t\t\t\t<div class="memoIncomingHTML">{{html doc.text.text}}</div>\t\t\t{{/if}}\t\t{{/if}}\t\t{{if doc.sub_type == "link"}}\t\t\t{{if doc.title && doc.title.text}}\t\t\t\t<h3 style="padding:0; padding-bottom:20px; margin:25px; margin-bottom:0; border-bottom:1px solid #ddd;">${doc.title.text}</h3>\t\t\t{{/if}}\t\t\t<div style="padding:5px 20px 10px;">\t\t\t\t<p><a href="${doc.link.url}" target="_blank">${doc.link.name}</a></p>\t\t\t\t{{if doc.link.url != doc.link.name}}<p style="padding-top:0; margin-top:-12px; color:#999;">${doc.link.url}</p>{{/if}}\t\t\t\t{{if doc.link.description}}<p style="color:#999; padding-top:0;">${doc.link.description}</p>{{/if}}\t\t\t</div>\t\t{{/if}}\t\t{{if doc.sub_type == "video"}}\t\t\t<div class="memoVideoContainer">{{html m.memos.setWmodeInVideoMemos( doc.video.video_player )}}</div>\t\t\t{{if doc.title && doc.title.text}}\t\t\t\t<h3>${doc.title.text}</h3>\t\t\t{{/if}}\t\t\t{{if doc.description && doc.description.text.length}}\t\t\t\t<p>${doc.description.text}</p>\t\t\t{{/if}}\t\t{{/if}}\t</div>{{tmpl m.memos.templates.largeMemos.largeMemoFooter}}</div>',
"facebook-pages":'<div class="memoGhost"></div><div class="openMemo facebook-pages">\t<div class="largeMemoTitleBar">\t\t{{if (doc.source_url)}}\t\t\t<a href="${doc.source_url}" target="_blank" class="memoServiceIcon" title="'+a.i18n.t("Go back to source","this tells the user that if they click on this button they will be taken to the source of the memo on the service that it was created on")+"{{if doc.author && doc.author.name}} ("+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+
'){{/if}}" target="_blank"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon" {{if doc.author && doc.author.name}}title="'+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'"{{/if}}></div>\t\t{{/if}}\t\t{{if (doc.title && doc.title.thumbnail) && (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<div class="ownerThumbnail"><div class="thumbText">'+
a.i18n.t("From","this label precedes a small image of the user who posted the memo and signifies memo ownership and origin")+' </div><img src="${doc.title.thumbnail}" /></div>\t\t{{/if}}\t\t<a class="closeOpenMemo">'+a.i18n.t("close","clicking on this button closes the dialog window")+'</a>\t</div>\t<div class="largeMemoContent">\t\t{{if doc.sub_type == "status"}}\t\t\t<h3>${doc.title.text}</h3>\t\t{{/if}}\t\t{{if doc.sub_type == "event"}}\t\t\t<h3>${doc.title.text}</h3>\t\t\t<div class="memo-event">\t\t\t{{if created_at}}\t\t\t\t<div class="memo-event-data"><h4>'+
a.i18n.t("Time","this tells the viewer the time of the Facebook event")+'</h4><div><p>${m.utilities.dateFormat( created_at * 1000, "fullDatePlusTime" ).replace("-", "&middot;")}</p></div></div>\t\t\t{{/if}}\t\t\t{{if doc.event && doc.event.location}}\t\t\t\t<div class="memo-event-data"><h4>'+a.i18n.t("Location","this tells the viewer the location of the Facebook event")+'</h4><div><p>${doc.event.location}</p></div></div>\t\t\t{{/if}}\t\t\t{{if doc.author && doc.author.name}}\t\t\t\t<div class="memo-event-data"><h4>'+
a.i18n.t("Created by","attribution for the author of the memo")+'</h4><div><p>${doc.author.name}</p></div></div>\t\t\t{{/if}}\t\t\t{{if doc.text && doc.text.text}}\t\t\t\t<div class="memo-event-data"><h4>'+a.i18n.t("More info","tells the user that additional info is located below")+'</h4><div><p>${doc.text.text}</p></div></div>\t\t\t{{/if}}\t\t\t</div>\t\t{{/if}}\t\t{{if doc.sub_type == "photo"}}\t\t\t<div class="lrgMemoImg"><img src="${doc.image.url}" /></div>\t\t\t{{if doc.title && doc.title.text}}\t\t\t\t<p>${doc.title.text}</p>\t\t\t{{/if}}\t\t{{/if}}\t\t{{if doc.sub_type == "note"}}\t\t\t{{if doc.title && doc.title.text}}\t\t\t\t<h3>${doc.title.text}</h3>\t\t\t{{/if}}\t\t\t{{if doc.text && doc.text.text}}\t\t\t\t<div class="memoIncomingHTML">{{html doc.text.text}}</div>\t\t\t{{/if}}\t\t{{/if}}\t\t{{if doc.sub_type == "link"}}\t\t\t{{if doc.title && doc.title.text}}\t\t\t\t<h3 style="padding:0; padding-bottom:20px; margin:25px; margin-bottom:0; border-bottom:1px solid #ddd;">${doc.title.text}</h3>\t\t\t{{/if}}\t\t\t<div style="padding:5px 20px 10px;">\t\t\t\t<p><a href="${doc.link.url}" target="_blank">${doc.link.name}</a></p>\t\t\t\t{{if doc.link.url != doc.link.name}}<p style="padding-top:0; margin-top:-12px; color:#999;">${doc.link.url}</p>{{/if}}\t\t\t\t{{if doc.link.description}}<p style="color:#999; padding-top:0;">${doc.link.description}</p>{{/if}}\t\t\t</div>\t\t{{/if}}\t\t{{if doc.sub_type == "video"}}\t\t\t<div class="memoVideoContainer">{{html m.memos.setWmodeInVideoMemos( doc.video.video_player )}}</div>\t\t\t{{if doc.title && doc.title.text}}\t\t\t\t<h3>${doc.title.text}</h3>\t\t\t{{/if}}\t\t\t{{if doc.description && doc.description.text.length}}\t\t\t\t<p>${doc.description.text}</p>\t\t\t{{/if}}\t\t{{/if}}\t</div>{{tmpl m.memos.templates.largeMemos.largeMemoFooter}}</div>',
feed:'<div class="memoGhost"></div><div class="openMemo feed">\t<div class="largeMemoTitleBar">\t\t{{if (doc && doc.source_url)}}\t\t\t<a href="${doc.source_url}" class="memoServiceIcon" title="'+a.i18n.t("Go back to source","this tells the user that if they click on this button they will be taken to the source of the memo on the service that it was created on")+"{{if doc && doc.author && doc.author.name}} ("+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+
'){{/if}}" target="_blank"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon" {{if doc && doc.author && doc.author.name}}title="'+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'"{{/if}}></div>\t\t{{/if}}\t\t{{if doc.author && doc.author.name && doc.author.name.length}}<div class="thumbText"> '+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+
'</div>{{/if}}\t\t<a class="closeOpenMemo">'+a.i18n.t("close","clicking on this button closes the dialog window")+'</a>\t</div>\t<div class="largeMemoContent">\t\t{{if doc && doc.category && doc.category.text}}\t\t\t<div class="memoHeaderHTML">\t\t\t\t${doc.category.text}{{if doc.title && doc.title.text}}<br />${doc.title.text}{{/if}}\t\t\t</div>\t\t{{/if}}\t\t{{if doc && doc.text && doc.text.text}}\t\t\t<div class="memoIncomingHTML">{{html m.memos.setWmodeInVideoMemos( doc.text.text )}}</div>\t\t{{/if}}\t</div>{{tmpl m.memos.templates.largeMemos.largeMemoFooter}}</div>',
flickr:'<div class="memoGhost"></div><div class="openMemo flickr">\t<div class="largeMemoTitleBar">\t\t{{if (doc.source_url)}}\t\t\t<a href="${doc.source_url}" target="_blank" class="memoServiceIcon" title="'+a.i18n.t("Go back to source","this tells the user that if they click on this button they will be taken to the source of the memo on the service that it was created on")+"{{if doc.author && doc.author.name}} ("+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+
'){{/if}}" target="_blank"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon" {{if doc.author && doc.author.name}}title="'+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'"{{/if}}></div>\t\t{{/if}}\t\t{{if (doc.title && doc.title.thumbnail) && (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<div class="ownerThumbnail"><div class="thumbText">'+
a.i18n.t("From","this label precedes a small image of the user who posted the memo and signifies memo ownership and origin")+' </div><img src="${doc.title.thumbnail}" /></div>\t\t{{/if}}\t\t{{if doc.author}}<div class="thumbText"> ('+a.i18n.t("originally by","this label precedes the linked name of the author of the memo and signifies memo ownership and origin")+' <a href="${doc.author.url}">${doc.author.name}</a>)</div>{{/if}}\t\t<a class="closeOpenMemo">'+a.i18n.t("close","clicking on this button closes the dialog window")+
'</a>\t</div>\t<div class="largeMemoContent">\t\t{{if doc.sub_type == "image"}}\t\t\t<div class="lrgMemoImg"><img src="${doc.image.url}" /></div>\t\t{{else}}\t\t\t<div class="memoVideoContainer">{{html m.memos.setWidthAndHeightInMemoContent( doc.video.video_player )}}</div>\t\t{{/if}}\t\t{{if doc.title && doc.title.text}}\t\t\t<h3>${doc.title.text}</h3>\t\t{{/if}}\t\t{{if doc.description && doc.description.text}}\t\t\t<p>${doc.description.text}</p>\t\t{{/if}}\t</div>{{tmpl m.memos.templates.largeMemos.largeMemoFooter}}</div>',
foursquare:'<div class="memoGhost"></div><div class="openMemo foursquare" data-memo-id="${m.utilities.cleanMemoId(id)}">\t<div class="largeMemoTitleBar">\t\t{{if (doc.source_url)}}\t\t\t<a href="${doc.source_url}" target="_blank" class="memoServiceIcon" title="'+a.i18n.t("Go back to source","this tells the user that if they click on this button they will be taken to the source of the memo on the service that it was created on")+"{{if doc.author && doc.author.name}} ("+a.i18n.t("by ${doc.author.name}",
"this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'){{/if}}" target="_blank"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon" {{if doc.author && doc.author.name}}title="'+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'"{{/if}}></div>\t\t{{/if}}\t\t{{if (doc.title && doc.title.thumbnail) && (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<div class="ownerThumbnail"><div class="thumbText">'+
a.i18n.t("From","this label precedes a small image of the user who posted the memo and signifies memo ownership and origin")+' </div><img src="${doc.title.thumbnail}" /></div>\t\t{{/if}}\t\t{{if doc.author}}<div class="thumbText"> ('+a.i18n.t("originally by","this label precedes the linked name of the author of the memo and signifies memo ownership and origin")+' <a href="${doc.author.url}">${doc.author.name}</a>)</div>{{/if}}\t\t<a class="closeOpenMemo">'+a.i18n.t("close","clicking on this button closes the dialog window")+
"</a>\t</div>\t<div class=\"largeMemoContent\">\t\t{{html m.memos.setWidthAndHeightInMemoContent( \"<div class='memoMapContainer' width='__WIDTH__' height='__HEIGHT__' style='width:__WIDTH__px; height:__HEIGHT__px;'></div>\" )}}\t\t{{if doc.title && doc.title.text}}\t\t\t<h3>At ${doc.title.text} <span>(${m.utilities.dateFormat( (created_at*1000), \"shortTime\" )})</span></h3>\t\t{{/if}}\t\t{{if doc.geo.poi[0].description}}\t\t\t<p style=\"padding-bottom:25px;\">${doc.geo.poi[0].description}</p>\t\t{{/if}}\t</div>{{tmpl m.memos.templates.largeMemos.largeMemoFooter}}</div>",
instagram:'<div class="memoGhost"></div><div class="openMemo instagram">\t<div class="largeMemoTitleBar">\t\t{{if (doc.source_url)}}\t\t\t<a href="${doc.source_url}" target="_blank" class="memoServiceIcon" title="'+a.i18n.t("Go back to source","this tells the user that if they click on this button they will be taken to the source of the memo on the service that it was created on")+"{{if doc.author && doc.author.name}} ("+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+
'){{/if}}" target="_blank"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon" {{if doc.author && doc.author.name}}title="'+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'"{{/if}}></div>\t\t{{/if}}\t\t{{if (doc.title && doc.title.thumbnail) && (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<div class="ownerThumbnail"><div class="thumbText">'+
a.i18n.t("From","this label precedes a small image of the user who posted the memo and signifies memo ownership and origin")+' </div><img src="${doc.title.thumbnail}" /></div>\t\t{{/if}}\t\t{{if doc.author}}<div class="thumbText"> ('+a.i18n.t("originally by","this label precedes the linked name of the author of the memo and signifies memo ownership and origin")+' <a href="${doc.author.url}">${doc.author.name}</a>)</div>{{/if}}\t\t<a class="closeOpenMemo">'+a.i18n.t("close","clicking on this button closes the dialog window")+
'</a>\t</div>\t<div class="largeMemoContent">\t\t<div class="lrgMemoImg"><img src="${doc.image.url}" alt="Instagram photo" /></div>\t\t{{if doc.title && doc.title.text}}\t\t\t<p>${doc.title.text}</p>\t\t{{/if}}\t</div>{{tmpl m.memos.templates.largeMemos.largeMemoFooter}}</div>',lastfm:'<div class="memoGhost"></div><div class="openMemo lastfm">\t<div class="largeMemoTitleBar">\t\t{{if (doc.track && doc.track.url)}}\t\t\t<a href="http://${doc.track.url}" target="_blank" class="memoServiceIcon" title="'+
a.i18n.t("Go to Last.fm page for this track","this link text tells the user that they can go to Last.fm to listen to this memo's track")+'" target="_blank"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon" title="Last.fm"></div>\t\t{{/if}}\t\t{{if !m.currentUser || user_id != m.currentUser.userID}}\t\t\t<div class="ownerThumbnail"><div class="thumbText">'+a.i18n.t("From","this label precedes a small image of the user who posted the memo and signifies memo ownership and origin")+' </div><a href="/users/${user_id}"><img src="/users/${user_id}/image.small" /></a></div>\t\t{{/if}}\t\t<a class="closeOpenMemo">'+
a.i18n.t("close","clicking on this button closes the dialog window")+'</a>\t</div>\t<div class="largeMemoContent">\t\t<div>\t\t\t{{if (doc.track && doc.track.artist && doc.track.artist.thumbnail)}}\t\t\t\t<img src="${doc.track.artist.thumbnail}" alt="'+a.i18n.t("By ${doc.track.artist.name}","this phrase indicates that the associated track was performed by the given artist")+'" />\t\t\t{{/if}}\t\t\t<h3>${doc.track.artist.name}</h3>\t\t\t<h4>${doc.track.name}</h4>\t\t\t<p>${doc.track.playcount} {{if doc.track.playcount > 1}}'+
a.i18n.t("plays","this label follows the track play count and indicates that the given track has been played some number of times")+"{{else}}"+a.i18n.t("play","this label follows the track play count of 1 and indicates that the given track has been played one time")+'{{/if}}</p>\t\t\t<p><a href="#" class="music-play-btn" data-track-name="${doc.track.name.replace(/"/g, "&quot;")}" data-artist-name="${doc.track.artist.name.replace(/"/g, "&quot;")}">\t\t\t\t{{if m.currentUser && m.currentUser.music_provider && (m.currentUser.music_provider == "spotify")}}'+
a.i18n.t("Listen with Spotify","this link text informs the user that they can listen to the given track on the Spotify music service")+"{{else}}"+a.i18n.t("Listen with Amazon","this link text informs the user that they can listen to the given track on the Amazon music service")+"{{/if}}\t\t\t</a></p>\t\t</div>\t</div>{{tmpl m.memos.templates.largeMemos.largeMemoFooter}}</div>",myspace:'<div class="memoGhost"></div><div class="openMemo myspace">\t<div class="largeMemoTitleBar">\t\t{{if (doc.source_url)}}\t\t\t<a href="{{if doc.source_url.substr(0,4) != "http"}}http://www.myspace.com{{/if}}${doc.source_url}" target="_blank" class="memoServiceIcon" title="'+
a.i18n.t("Go back to source","this tells the user that if they click on this button they will be taken to the source of the memo on the service that it was created on")+"{{if doc.author && doc.author.name}} ("+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'){{/if}}" target="_blank"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon" {{if doc.author && doc.author.name}}title="'+
a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'"{{/if}}></div>\t\t{{/if}}\t\t{{if (doc.title && doc.title.thumbnail) && (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<div class="ownerThumbnail"><div class="thumbText">'+a.i18n.t("From","this label precedes a small image of the user who posted the memo and signifies memo ownership and origin")+
' </div><img src="${doc.title.thumbnail}" /></div>\t\t{{/if}}\t\t{{if doc.author}}<div class="thumbText"> ('+a.i18n.t("originally by","this label precedes the linked name of the author of the memo and signifies memo ownership and origin")+' <a href="${doc.author.url}">${doc.author.name}</a>)</div>{{/if}}\t\t<a class="closeOpenMemo">'+a.i18n.t("close","clicking on this button closes the dialog window")+'</a>\t</div>\t<div class="largeMemoContent">\t\t{{if doc.sub_type == "photo"}}\t\t\t<div class="lrgMemoImg"><img src="${doc.image.url}" /></div>\t\t{{/if}}\t\t{{if doc.sub_type == "video"}}\t\t\t<div class="memoVideoContainer">{{html m.memos.setWidthAndHeightInMemoContent( doc.video.video_player )}}</div>\t\t{{/if}}\t\t{{if doc.title && doc.title.text}}\t\t\t<h3>{{if doc.sub_type == "mood" && doc.title && doc.title.thumbnail}}<img src="${doc.title.thumbnail}" alt="'+
a.i18n.t("mood image","this tells the user that this type of image is a MySpace mood image")+'" style="padding-right:10px;" />{{/if}}${doc.title.text}</h3>\t\t{{/if}}\t</div>{{tmpl m.memos.templates.largeMemos.largeMemoFooter}}</div>',picasa:'<div class="memoGhost"></div><div class="openMemo picasa">\t<div class="largeMemoTitleBar">\t\t{{if (doc.source_url)}}\t\t\t<a href="${doc.source_url}" target="_blank" class="memoServiceIcon" title="'+a.i18n.t("Go back to source","this tells the user that if they click on this button they will be taken to the source of the memo on the service that it was created on")+
"{{if doc.author && doc.author.name}} ("+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'){{/if}}" target="_blank"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon" {{if doc.author && doc.author.name}}title="'+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+
'"{{/if}}></div>\t\t{{/if}}\t\t{{if (doc.title && doc.title.thumbnail) && (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<div class="ownerThumbnail"><div class="thumbText">'+a.i18n.t("From","this label precedes a small image of the user who posted the memo and signifies memo ownership and origin")+' </div><img src="${doc.title.thumbnail}" /></div>\t\t{{/if}}\t\t{{if doc.author}}<div class="thumbText"> ('+a.i18n.t("originally by","this label precedes the linked name of the author of the memo and signifies memo ownership and origin")+
' <a href="${doc.author.url}">${doc.author.name}</a>)</div>{{/if}}\t\t<a class="closeOpenMemo">'+a.i18n.t("close","clicking on this button closes the dialog window")+'</a>\t</div>\t<div class="largeMemoContent">\t\t\t<div class="lrgMemoImg"><img src="${doc.image.url}" /></div>\t\t{{if doc.title && doc.title.text}}\t\t\t<h3>${doc.title.text}</h3>\t\t{{/if}}\t\t{{if doc.description && doc.description.text}}\t\t\t<p>${doc.description.text}</p>\t\t{{/if}}\t</div>{{tmpl m.memos.templates.largeMemos.largeMemoFooter}}</div>',
soundcloud:'<div class="memoGhost"></div><div class="openMemo soundcloud">\t<div class="largeMemoTitleBar">\t\t{{if (doc.source_url)}}\t\t\t<a href="${doc.source_url}" target="_blank" class="memoServiceIcon" title="'+a.i18n.t("Go back to source","this tells the user that if they click on this button they will be taken to the source of the memo on the service that it was created on")+"{{if doc.author && doc.author.name}} ("+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+
'){{/if}}"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon" {{if doc.author && doc.author.name}}title="'+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'"{{/if}}></div>\t\t{{/if}}\t\t{{if (doc.title && doc.title.thumbnail) && (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<div class="ownerThumbnail"><div class="thumbText">'+a.i18n.t("From",
"this label precedes a small image of the user who posted the memo and signifies memo ownership and origin")+' </div><img src="${doc.title.thumbnail}" /></div>\t\t{{/if}}\t\t{{if doc.author}}<div class="thumbText"> ('+a.i18n.t("originally by","this label precedes the linked name of the author of the memo and signifies memo ownership and origin")+' <a href="${doc.author.url}">${doc.author.name}</a>)</div>{{/if}}\t\t<a class="closeOpenMemo">'+a.i18n.t("close","clicking on this button closes the dialog window")+
'</a>\t</div>\t<div class="largeMemoContent">\t\t<h3>{{if doc.artwork.url}}<img src="${doc.artwork.url}" alt="'+a.i18n.t("album artwork","this is a label that tells the user that the given image is album artwork")+'" />{{/if}}${doc.title.text}</h3>\t\t<div class="memoVideoContainer" style="margin:5px 25px 20px;">\t\t\t<object height="81" width="100%" wmode="transparent">\t\t\t\t<param name="movie" value="http://player.soundcloud.com/player.swf?show_artwork=false&url=${doc.play_url.resource}%3Fsecret_token%3D${doc.play_url.secret_token}%26client_id%3D${doc.play_url.client_id}"></param>\t\t\t\t<param name="allowscriptaccess" value="always"></param>\t\t\t\t<embed src="http://player.soundcloud.com/player.swf?show_artwork=false&url=${doc.play_url.resource}%3Fsecret_token%3D${doc.play_url.secret_token}%26client_id%3D${doc.play_url.client_id}" allowscriptaccess="always" height="81"  type="application/x-shockwave-flash" width="100%"  wmode="transparent"></embed>\t\t\t</object>\t\t</div>\t</div>{{tmpl m.memos.templates.largeMemos.largeMemoFooter}}</div>',
tripit:'<div class="memoGhost"></div><div class="openMemo tripit" data-memo-id="${m.utilities.cleanMemoId(id)}">\t<div class="largeMemoTitleBar">\t\t{{if (doc.source_url)}}\t\t\t<a href="${doc.source_url}" target="_blank" class="memoServiceIcon" title="'+a.i18n.t("Go back to source","this tells the user that if they click on this button they will be taken to the source of the memo on the service that it was created on")+"{{if doc.author && doc.author.name}} ("+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+
'){{/if}}" target="_blank"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon" {{if doc.author && doc.author.name}}title="'+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'"{{/if}}></div>\t\t{{/if}}\t\t{{if (doc.title && doc.title.thumbnail) && (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<div class="ownerThumbnail"><div class="thumbText">'+
a.i18n.t("From","this label precedes a small image of the user who posted the memo and signifies memo ownership and origin")+' </div><img src="${doc.title.thumbnail}" /></div>\t\t{{/if}}\t\t{{if doc.author}}<div class="thumbText"> ('+a.i18n.t("originally by","this label precedes the linked name of the author of the memo and signifies memo ownership and origin")+' <a href="${doc.author.url}">${doc.author.name}</a>)</div>{{/if}}\t\t<a class="closeOpenMemo">'+a.i18n.t("close","clicking on this button closes the dialog window")+
'</a>\t</div>\t<div class="largeMemoContent">\t\t{{html m.memos.setWidthAndHeightInMemoContent( "<div class=\'memoMapContainer\' width=\'__WIDTH__\' height=\'__HEIGHT__\' style=\'width:__WIDTH__px; height:__HEIGHT__px;\'></div>" )}}\t\t{{each doc.geo.poi}}\t\t\t{{if $index < (doc.geo.poi.length - 1)}}\t\t\t\t<div class="tripitLeg">\t\t\t\t\t<div class="tripitFlightDatum tripitAirports">${$value.name.substr(-3)} <span style="color:#80bbe2;">&rsaquo;</span> ${doc.geo.poi[$index+1].name.substr(-3)}</div>\t\t\t\t\t<div class="tripitFlightDatum">${m.utilities.dateFormat( ($value.time*1000), "shortTime" )} - ${m.utilities.dateFormat( (doc.geo.poi[$index+1].time*1000), "shortTime" )}</div>\t\t\t\t\t<div class="tripitFlightDatum">${$value.description.replace("Arrival (", "").replace("Departure (", "").replace(")", "")}</div>\t\t\t\t</div>\t\t\t{{/if}}\t\t{{/each}}\t</div>{{tmpl m.memos.templates.largeMemos.largeMemoFooter}}</div>',
twitter:'<div class="memoGhost"></div><div class="openMemo twitter">\t<div class="largeMemoTitleBar">\t\t{{if doc.source_url}}\t\t\t<a href="${doc.source_url}" target="_blank" class="memoServiceIcon" title="'+a.i18n.t("Go back to source","this tells the user that if they click on this button they will be taken to the source of the memo on the service that it was created on")+"{{if doc.author && doc.author.name}} ("+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+
'){{/if}}" target="_blank"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon" {{if doc.author && doc.author.name}}title="'+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'"{{/if}}></div>\t\t{{/if}}\t\t{{if (doc.title && doc.title.thumbnail) && (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<div class="ownerThumbnail"><div class="thumbText">'+
a.i18n.t("From","this label precedes a small image of the user who posted the memo and signifies memo ownership and origin")+' </div><img src="${doc.title.thumbnail}" /></div>\t\t{{/if}}\t\t{{if doc.author}}<div class="thumbText"> ('+a.i18n.t("originally by","this label precedes the linked name of the author of the memo and signifies memo ownership and origin")+' <a href="${doc.author.url}">${doc.author.name}</a>)</div>{{/if}}\t\t<a class="closeOpenMemo">'+a.i18n.t("close","clicking on this button closes the dialog window")+
'</a>\t</div>\t<div class="largeMemoContent">\t\t<p>{{html m.utilities.convertURLstringsToAnchors( doc.title.text )}}</p>\t\t{{if doc.image}}\t\t\t<div class="lrgMemoImg"><img src="${doc.image.url}" /></div>\t\t{{/if}}\t</div>{{tmpl m.memos.templates.largeMemos.largeMemoFooter}}</div>',vimeo:'<div class="memoGhost"></div><div class="openMemo vimeo">\t<div class="largeMemoTitleBar">\t\t{{if (doc.source_url)}}\t\t\t<a href="${doc.source_url}" class="memoServiceIcon" title="'+a.i18n.t("Go back to source",
"this tells the user that if they click on this button they will be taken to the source of the memo on the service that it was created on")+"{{if doc.author && doc.author.name}} ("+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'){{/if}}" target="_blank"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon" {{if doc.author && doc.author.name}}title="'+a.i18n.t("by ${doc.author.name}",
"this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'"{{/if}}></div>\t\t{{/if}}\t\t{{if (doc.title && doc.title.thumbnail) && (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<div class="ownerThumbnail"><div class="thumbText">'+a.i18n.t("From","this label precedes a small image of the user who posted the memo and signifies memo ownership and origin")+' </div><img src="${doc.title.thumbnail}" /></div>\t\t{{/if}}\t\t{{if doc.author}}<div class="thumbText"> ('+
a.i18n.t("originally by","this label precedes the linked name of the author of the memo and signifies memo ownership and origin")+' <a href="${doc.author.url}">${doc.author.name}</a>)</div>{{/if}}\t\t<a class="closeOpenMemo">'+a.i18n.t("close","clicking on this button closes the dialog window")+"</a>\t</div>{{tmpl m.memos.templates.largeMemos.largeMemoFooter}}</div>",wordpress:'<div class="memoGhost"></div><div class="openMemo wordpress">\t<div class="largeMemoTitleBar">\t\t{{if (doc && doc.source_url)}}\t\t\t<a href="${doc.source_url}" class="memoServiceIcon" title="'+
a.i18n.t("Go back to source","this tells the user that if they click on this button they will be taken to the source of the memo on the service that it was created on")+"{{if doc && doc.author && doc.author.name}} ("+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'){{/if}}" target="_blank"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon" {{if doc && doc.author && doc.author.name}}title="'+
a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'"{{/if}}></div>\t\t{{/if}}\t\t{{if doc.author && doc.author.name && doc.author.name.length}}<div class="thumbText"> '+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+
'</div>{{/if}}\t\t<a class="closeOpenMemo">'+a.i18n.t("close","clicking on this button closes the dialog window")+'</a>\t</div>\t<div class="largeMemoContent">\t\t{{if (doc && doc.category && doc.category.text) || (doc.title && doc.title.text)}}\t\t\t<div class="memoHeaderHTML">\t\t\t\t{{if doc && doc.category && doc.category.text}}${doc.category.text}{{/if}}\t\t\t\t{{if doc.title && doc.title.text}}<div>${doc.title.text}</div>{{/if}}\t\t\t</div>\t\t{{/if}}\t\t{{if doc && doc.text && doc.text.text}}\t\t\t<div class="memoIncomingHTML">{{html m.memos.setWmodeInVideoMemos( doc.text.text )}}</div>\t\t{{/if}}\t</div>{{tmpl m.memos.templates.largeMemos.largeMemoFooter}}</div>',
youtube:'<div class="memoGhost"></div><div class="openMemo youtube">\t<div class="largeMemoTitleBar">\t\t{{if (doc.source_url)}}\t\t\t<a href="${doc.source_url}" target="_blank" class="memoServiceIcon" title="'+a.i18n.t("Go back to source","this tells the user that if they click on this button they will be taken to the source of the memo on the service that it was created on")+"{{if doc.author && doc.author.name}} ("+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+
'){{/if}}"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon" {{if doc.author && doc.author.name}}title="'+a.i18n.t("by ${doc.author.name}","this tells the viewer the identity of the original author of the memo - the ${doc.author.name} is a variable placeholder that will include the name/identity")+'"{{/if}}></div>\t\t{{/if}}\t\t{{if (doc.title && doc.title.thumbnail) && (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<div class="ownerThumbnail"><div class="thumbText">'+a.i18n.t("From",
"this label precedes a small image of the user who posted the memo and signifies memo ownership and origin")+' </div><img src="${doc.title.thumbnail}" /></div>\t\t{{/if}}\t\t{{if doc.author}}<div class="thumbText"> ('+a.i18n.t("originally by","this label precedes the linked name of the author of the memo and signifies memo ownership and origin")+' <a href="${doc.author.url}">${doc.author.name}</a>)</div>{{/if}}\t\t<a class="closeOpenMemo">'+a.i18n.t("close","clicking on this button closes the dialog window")+
'</a>\t</div>\t<div class="largeMemoContent">\t\t<div class="memoVideoContainer">{{html m.memos.setWidthAndHeightInMemoContent( doc.video.video_player )}}</div>\t\t{{if doc.title}}\t\t\t<h3>${doc.title.text}</h3>\t\t{{/if}}\t\t{{if doc.description && doc.description.text.length}}\t\t\t<p>${doc.description.text}</p>\t\t{{/if}}\t</div>{{tmpl m.memos.templates.largeMemos.largeMemoFooter}}</div>',largeMemoFooter:'\t<div class="largeMemoFooterBar">\t\t<div class="leftFade"></div>\t\t<div class="rightFade"></div>\t\t<ul class="memoOwnerActions">{{if m.currentUser && m.currentUser.userID == user_id}}<li><a href="#" title="'+
a.i18n.t("Privacy Settings","this is a label that indicates that the associated icon deals with privacy settings")+'" class="memo_action memo_privacy memo_${privacy}">${privacy}</a></li>{{/if}}{{if (m.currentUser && m.currentUser.userID == user_id) || ( m.currentUser && m.currentUser.friend_ids.indexOf( user_id ) != -1 )}}<li><a href="#" class="memo_action memo_laneAdd" title="'+a.i18n.t("Add to Lane","clicking on this button allows the user to add this memo to an individual lane")+'">'+a.i18n.t("Add to Lane",
"clicking on this button allows the user to add this memo to an individual lane")+'</a></li>{{/if}}{{if (m.currentUser && m.currentUser.userID == m.currentLane.user_id) || (m.currentUser && m.currentUser.userID == user_id)}}<li><a href="#" class="memo_action memo_laneRemove" title="'+a.i18n.t("Remove from Lane","clicking on this button allows the user to add this memo to an individual lane")+'">'+a.i18n.t("Remove from Lane","clicking on this button allows the user to add this memo to an individual lane")+
'</a></li>{{/if}}</ul>{{if m.currentUser && m.currentUser.userID == user_id}}\t\t<div class="memo_dateAdded"><a href="#" id="changeMemoDate">${ m.utilities.dateFormat( (created_at*1000), "fullDateAndTime" ) }</a></div>{{else}}\t\t<div class="memo_dateAdded"><a href="/users/${user_id}" class="largeMemoUserAvatar"><img align="middle" src="/users/${user_id}/image.small" height="16" width="16" /></a>{{if m.currentUser && m.currentUser.userID == user_id}}<a href="#" id="changeMemoDate">${ m.utilities.dateFormat( (created_at*1000), "fullDateAndTime")}</a> {{else}}${ m.utilities.dateFormat( (created_at*1000), "fullDateAndTime")}{{/if}} '+
a.i18n.t("by","X memo date by X user")+'</div>{{/if}}\t\t<ul class="memoActions">\t\t\t<li><a href="#" title="'+a.i18n.t("Share this memo","this is the call to action that appears when a memo is shared")+'" data-share-text="'+a.i18n.t("Check out this memo on Memolane","this is the call to action that appears when memolane is shared via Twitter or Facebook")+'" data-share-dialog-text="'+a.i18n.t("Share memo on","this is the phrase that precedes either Twitter or Facebook and serves as a label for memo sharing")+
'" data-share-link="'+m.utilities.breakURLCache(window.location.pathname)+'#time=${created_at}&memo=${m.utilities.cleanMemoId( id )}" class="memo_action memo_share shareURL">'+a.i18n.t("Share","a user clicks on this button to complete the process of sharing a memo on Twitter or Facebook")+'</a></li>\t\t\t{{if m.currentUser}}\t\t\t\t<li><a href="#" title="Comment on memo" class="memo_action memo_comments" data-id="${id}">Comment on memo</a><span class="textWithIcon"><span class="commentCount">{{if comment_count}}${comment_count}{{/if}}</span></span></li>\t\t\t\t<li><a href="#" title="'+
a.i18n.t("Like/Unlike memo","call to action for user to like OR unlike memo")+'" class="memo_action memo_like{{if liked_by_current_user}} liked{{/if}}">'+a.i18n.t("Like/Unlike memo","call to action for user to like OR unlike memo")+'</a><a href="#" title="'+a.i18n.t("click to view who liked this memo")+'"class="memo_like_text textWithIcon">{{if like_count}}${like_count}{{/if}}</a></li>\t\t\t{{else}}\t\t\t\t<li><div title="Comments on memo" class="memo_action memo_comments" data-id="${id}">Comments on memo</div><span class="memo_like_text textWithIcon">{{if comment_count > 0}}${comment_count}{{/if}}</span></li>\t\t\t\t{{if like_count > 0}}\t\t\t\t\t<li><div class="memo_action memo_like{{if liked_by_current_user}} liked{{/if}}"></div><a href="#" title="'+
a.i18n.t("click to view who liked this memo")+'" class="textWithIcon">{{if like_count}}${like_count}{{/if}}</a></li>\t\t\t\t{{/if}}\t\t\t{{/if}}\t\t</ul>\t</div>'},dialogs:{setPrivacy:'<div id="privacyDialog" class="memolaneDialog largeMemoDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">'+a.i18n.t("Set Privacy","this is the button the user clicks on to change the privacy of a memo")+'</div>\t\t<div class="close closeMemolaneDialog">'+a.i18n.t("close","this is where the user clicks to close the dialog window")+
'</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<h2 class="${service}"></h2>\t\t<a href="#" class="close" id="setPrivacyDone" style="display:none;">'+a.i18n.t("Close","the text link to close the dialog window")+"</a>\t\t<p>"+a.i18n.t("The privacy setting you select for this memo will be uniformly applied to all lanes on which it exists. Your choice here will override your service-level setting.","this tells the user that the privacy they select for individual memos changes the privacy setting for the memo only, and not the entire service")+
"</p>\t\t<p>"+a.i18n.t("Please choose a setting to continue:","this asks the user to choose a privacy setting")+'</p>\t\t<ul class="privacyTabs smallButtonBar">\t\t\t<li><a href="#" id="public">'+a.i18n.t("Public","this is the public button, clicking on this button makes the memo public")+'</a></li>\t\t\t<li><a href="#" id="friends">'+a.i18n.t("Friends Only","this is the friends only button, clicking on this button makes the memo friends only")+'</a></li>\t\t\t<li><a href="#" id="private">'+a.i18n.t("Private",
"this is the private button, clicking on this button makes the memo private")+'</a></li>\t\t</ul>\t\t<div class="privacyTabDescription">\t\t\t<div id="publicTabDescription"><h3>'+a.i18n.t("Public","this is the title of the public privacy setting")+"</h3><p>"+a.i18n.t("This memo will be visible to anyone viewing the lanes where it appears, and it can be contributed to lanes created by your Memolane friends. We will notify you by email whenever any of your memos are contributed to a lane created by one of your Memolane friends so you can remove it if you choose.",
"this lets users know that public memos can be viewed by anyone who views their lanes and pulled into the lanes of their Memolane friends")+'</p></div>\t\t\t<div id="friendsTabDescription"><h3>'+a.i18n.t("Friends Only","this is the title of the friends only privacy setting")+"</h3><p>"+a.i18n.t("This memo will only be visible to you and your Memolane friends on all lanes where it appears. We will notify you by email whenever any of your memos are contributed to a lane created by one of your Memolane friends so you can remove it if you choose.",
"this lets users know that friends only memos can be viewed by their Memolane friends when viewing their lanes, and they can be pulled into lanes created by their Memolane friends")+'</p></div>\t\t\t<div id="privateTabDescription"><h3>'+a.i18n.t("Private","this is the title of the private privacy setting")+"</h3><p>"+a.i18n.t("This memo will only be visible to you on all lanes where it appears. Your Memolane friends can contribute the service where this memo was created to their lanes, but it will still only be visible to you.",
"this tells the user that private memos will only be able to be viewed by them.")+"</p></div>\t\t</div>\t</div></div>",addMemoToLane:{loading:'<div id="removeMemoDialog" class="memolaneDialog largeMemoDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">'+a.i18n.t("Add this memo to a lane","this prompts the user to add the memo they are viewing to a lane")+'</div>\t\t<div class="close closeMemolaneDialog">'+a.i18n.t("close","clicking on this button closes the dialog window")+'</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<h2 class="header typeJ" style="text-align:center; margin-bottom:0;"><img src="/img/common/smallLoaderOnWhite.gif" alt="'+
a.i18n.t("loading lanes...","tells the user the lanes they are trying to view are loading")+'" /></h2>\t</div></div>',loaded:"<div><p>"+a.i18n.t('Adding a memo to a lane keeps it on the lane even if the service it is streamed from is removed - service streaming is controlled in the <a href="#" class="openDrawerEditViewOnClick">lane drawer edit view</a>. You can add an individual memo to any lane shown below, including the lane where you are viewing this memo:')+'</p><div id="laneListScroller"><ul class="lane-list">\t{{each lanes}}\t\t<li>\t\t\t<img src="{{if avatar_url}}${avatar_url}{{else}}/lanes/${id}/avatar{{/if}}" class="float-left" alt="'+
a.i18n.t("lane avatar","designates the avatar associated with the lane")+'" />\t\t\t${title}\t\t\t<div class="float-right addMemoStatus">\t\t\t\t{{if already_included}}\t\t\t\t\t'+a.i18n.t("Added","this informs the user that the memo has already been added to the given lane")+'\t\t\t\t{{else}}\t\t\t\t\t<a href="#" id="${id}" class="btn-green addMemoToLane">'+a.i18n.t("Add","this button allows the user to add the memo at hand to the given lane")+"</a>\t\t\t\t{{/if}}\t\t\t</div>\t\t</li>\t{{/each}}</ul></div></div>"},
removeMemoFromLane:'<div id="removeMemoDialog" class="memolaneDialog largeMemoDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">'+a.i18n.t("Remove memo from lane","tells the user that they can remove this memo from a lane")+'</div>\t\t<div class="close closeMemolaneDialog">'+a.i18n.t("cancel","the cancel button to close the dialog window")+'</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<h2 class="header typeJ">'+a.i18n.t("Whoa, are you sure?",
"this prompts the user to make sure that they are sure they want to remove the memo from the lane")+"</h2>\t\t<p>"+a.i18n.t("This will NOT remove this memo from any other lane(s) on which it appears.","this tells the user that they are only removing the memo from the lane they are currently viewing")+'</p>\t\t<p><a href="#" class="btn-red float-left removeMemoConfirm close">'+a.i18n.t("Yes, remove this memo from this lane","this is a confirmation prompt for the removal of the memo")+'</a> <a href="#" class="secondaryAction float-left close">'+
a.i18n.t("No, I don't want that","clicking on this button allows the user to leave the dialog without making changes")+"</a></p>\t</div></div>"}}}}(this,jQuery,this.undefined);m.memos.initialize();
m.laneLoadMemos=function(f,a){return{$laneViewport:a("#lane-viewport"),$lane:a("#lane"),$laneSlot:a(".lane-slot"),urlHashObjectOnPageLoad:m.utilities.urlHash.get(),preloadingLeft:false,preloadingRight:false,numberOfMemosToLoad:Math.round(a("body").width()/250*(a("#lane-viewport").height()/250))*4,initialize:function(){this.loadLaneOnThisTime=this.urlHashObjectOnPageLoad.time?this.urlHashObjectOnPageLoad.time:Math.round((new Date).getTime()/1E3);m.currentLane.mode!=="new"&&(m.currentLane.total_memos===
0||m.currentLane.visible_memos===0?(a("#lane-drawer").css("visibility","visible"),m.drawer.openDrawer()):(m.lane.showLaneLoader(),this.initialLoadMemos()))},initialLoadMemos:function(){var b=this;a.ajax({url:"/lanes/"+m.currentLane.id+"/memos",data:{timestamp:this.loadLaneOnThisTime,left:b.numberOfMemosToLoad,right:b.numberOfMemosToLoad,public_only:m.isEmbedded}}).success(function(c){var d=c[0].created_at-m.utilities.fixedModulus(c[0].created_at,86400),e=c[c.length-1].created_at-m.utilities.fixedModulus(c[c.length-
1].created_at,86400)+86400;d===e&&(e+=86399);d=b.createSlotsAndMemos(d,e,c,86400);b.$lane.empty().append(d);a(".lane-slot-memos").find("img:not([height])").imagesLoaded(function(){m.laneLayout.runLayout();m.lane.hideLaneLoader();m.lane.showLane();m.lane.moveLaneToMemo(b.getMemoIdClosesToTime(c,b.loadLaneOnThisTime));b.updateMemoStore(c);b.urlHashObjectOnPageLoad.memo&&b.deepLinkToMemo()})})},deepLinkToMemo:function(){var b=this;f.setTimeout(function(){a("#"+b.urlHashObjectOnPageLoad.memo).trigger("click")},
500)},getMemoIdClosesToTime:function(a,c){var d=0,e=m.utilities.cleanMemoId,g,f=a.length;if(a[f-1].created_at<=c)g=e(a[f-1].id);else for(;d<f;){if(a[d].created_at>=c){a[d].created_at==c?g=e(a[d].id):(g=Math.abs(a[d].created_at-c),f=Math.abs(a[d===0?0:d-1].created_at-c),g=g>f?e(a[d-1].id):e(a[d].id));break}d++}return g},createSlotsAndMemos:function(b,c,d,e){for(var g="",f=this.templates.smallMemos;b<c;){var p="",k=_.select(d,function(a){return a.created_at>=b&&a.created_at<b+e});k.length&&(_.each(k,
function(b){p+=f[b.service]?a.tmpl(f[b.service],b).html():a.tmpl(f["default"],b).html()}),g+='<div class="lane-slot" id="'+b+'">\t<div class="lane-circle"></div>\t<div class="lane-slot-title">'+m.utilities.dateFormat(b*1E3,"UTC:ddd, mmmm d, yyyy")+'</div>\t<div class="lane-slot-memos">'+p+"</div></div>");b+=e}return g},getHTMLForNewMemos:function(a){if(a.length===0)return"";var c=a[0].created_at-m.utilities.fixedModulus(a[0].created_at,86400),d=a[a.length-1].created_at-m.utilities.fixedModulus(a[a.length-
1].created_at,86400);c===d&&(d+=86399);return this.createSlotsAndMemos(c,d,a,86400)},getUpdatedHTMLforNewMemos:function(b,c,d){if(b.length===0)return"";var e=m.laneLoadMemos.templates.smallMemos,f="";_.each(b,function(b){var c="";c+=e[b.service]?a.tmpl(e[b.service],b).html():a.tmpl(e["default"],b).html();f+=c});return a("#lane .lane-slot")[c]().clone().find(".lane-slot-memos")[d](f).end().clone()},loadMemosRight:function(){if(this.preloadingRight)return false;var b=this;this.preloadingRight=true;
a.ajax({url:"/lanes/"+m.currentLane.id+"/memos",data:{timestamp:a(".memo").last().data("time")+1,right:b.numberOfMemosToLoad,public_only:m.isEmbedded}}).success(function(c){if(c.length===0)return false;c.length!=1&&c.shift();var d=a(".lane-slot"),e=a(".lane-slot").last(),g=a("#lane");lastSlotTime=parseInt(d.last().attr("id"));secondsInDay=86400;$laneViewport=a("#lane-viewport");$preMemoRight=a("#preMemoRight");$screenRightBtn=a("#screenRightBtn");$slotLoaderRight=a("#slot-loader-right");memosForSlot=
_.select(c,function(a){return a.created_at>lastSlotTime&&a.created_at<lastSlotTime+secondsInDay});memosNoSlotYet=_.select(c,function(a){return a.created_at>lastSlotTime+secondsInDay});memosForSlotHtml=b.getUpdatedHTMLforNewMemos(memosForSlot,"last","append");oldWidthBeforeUpdate=a("#lane .lane-slot-memos").last().width();memoNoSlotYetHtml=b.getHTMLForNewMemos(memosNoSlotYet);$preMemoRight.append(memosForSlotHtml).append(memoNoSlotYetHtml).find(".lane-slot-memos").height(g.find(".lane-slot-memos").height()).end().find(".lane-slot-memos").isotope({layoutMode:"fitColumns",
animationEngine:"jquery",animationOptions:{duration:0,queue:false}});b.rightContentLoaded=true;var h=f.setInterval(function(){if($laneViewport[0].scrollLeft+$laneViewport.width()>=$laneViewport[0].scrollWidth){clearInterval(h);$slotLoaderRight.show();$screenRightBtn.hide();$laneViewport.stop().trigger(m.mouseUpOrTouchEnd);m.lane.cancelLaneMovement=true;var c=f.setInterval(function(){if(b.rightContentLoaded){clearInterval(c);var d=a(".openMemo"),f=0;$preMemoRight.find(".lane-slot").each(function(){f+=
a(this).width()});var h=$preMemoRight.html();memosForSlot.length?(g.width(g.width()+f-(oldWidthBeforeUpdate+40)),e.remove(),g.append(h),d.length&&d.css("left",d[0].offsetLeft+(f-(oldWidthBeforeUpdate+40)))):(g.width(g.width()+f),g.append(h),d.length&&d.css("left",d[0].offsetLeft+f));$preMemoRight.children().remove();$slotLoaderRight.hide();m.lane.cancelLaneMovement=false;$laneViewport.stop();$screenRightBtn.show();b.updateMemoStore(memosForSlot);b.updateMemoStore(memosNoSlotYet);m.lane.trimLaneLeft();
b.preloadingRight=false}},500)}else if($laneViewport[0].scrollLeft<$laneViewport[0].scrollWidth-$laneViewport.width()*3)clearInterval(h),b.preloadingRight=false,$preMemoRight.empty()},500)})},loadMemosLeft:function(){if(this.preloadingLeft)return false;var b=this;this.preloadingLeft=true;a.ajax({url:"/lanes/"+m.currentLane.id+"/memos",data:{timestamp:a(".memo").first().data("time")-1,left:b.numberOfMemosToLoad,public_only:m.isEmbedded}}).success(function(c){if(c.length===0)return false;c.length!=
1&&c.pop();var d=a(".lane-slot"),e=a(".lane-slot").first(),g=a("#lane"),h=parseInt(d.eq(0).attr("id")),p=a("#lane-viewport"),k=a("#preMemoLeft"),l=a("#screenLeftBtn"),n=a("#slot-loader-left"),o=_.select(c,function(a){return a.created_at>h&&a.created_at<h+86400}),r=_.select(c,function(a){return a.created_at<h}),c=b.getUpdatedHTMLforNewMemos(o,"first","prepend"),q=a("#lane .lane-slot-memos").first().width(),d=b.getHTMLForNewMemos(r);a("#preMemoLeft").append(c).prepend(d).find(".lane-slot-memos").height(g.find(".lane-slot-memos").height()).end().find(".lane-slot-memos").isotope({layoutMode:"fitColumns",
animationEngine:"jquery",animationOptions:{duration:0,queue:false}});b.leftContentLoaded=true;var s=f.setInterval(function(){if(p.scrollLeft()<=0){clearInterval(s);n.show();l.hide();p.stop().trigger(m.mouseUpOrTouchEnd);m.lane.cancelLaneMovement=true;var c=f.setInterval(function(){if(b.leftContentLoaded){clearInterval(c);var d=a(".openMemo"),f=0;k.find(".lane-slot").each(function(){f+=a(this).width()});var h=k.html();o.length?(g.width(g.width()+f-(q+40)),e.remove(),g.prepend(h),p.scrollLeft(f-(q+
40)),d.length&&d.css("left",d[0].offsetLeft+(f-(q+40)))):(g.width(g.width()+f),g.prepend(h),p.scrollLeft(f),d.length&&d.css("left",d[0].offsetLeft+f));k.children().remove();n.hide();m.lane.cancelLaneMovement=false;p.stop();l.show();b.updateMemoStore(o);b.updateMemoStore(r);m.lane.trimLaneRight();b.preloadingLeft=false}},500)}else if(p[0].scrollLeft>=p.width()*3)clearInterval(s),b.preloadingLeft=false,k.empty()},500)})},updateMemoStore:function(a){var c=a.length;if(c===0)return false;for(var d=m.memos.memoStore,
e=m.utilities.cleanMemoId,f=0;f<c;)d[e(a[f].id)]=a[f],f++},pullImageFromHTML:function(b){var b=a("<span>"+b+"</span>"),c=b.find("img:first").removeAttr("style").removeAttr("height"),d="";return d=c.length?'<div class="fixed-photo-height">'+a("<div></div>").append(c).html()+"</div>":"<p>"+b.text().substr(0,200)+"...</p>"},googleMapImageURL:function(b){var c=0,d=0,e="&markers=color:0x1587C8|size:small|";a.each(b.poi,function(a,b){e+=b.lat+","+b.lon+"|";c++});var e=e.slice(0,-1),f="";b.polyline&&(f=
"&path=color:0xE5831A|weight:3|",a.each(b.polyline,function(a,b){f+=b.lat+","+b.lon+"|";d++}),f=f.slice(0,-1));b="";d==0&&c==1&&(b="&zoom=14");return"http://maps.google.com/maps/api/staticmap?size=200x150"+b+"&sensor=false"+e+"&maptype=roadmap"+f},mapquestMapImageURL:function(b){var c=0,d=0,e="&pois=";a.each(b.poi,function(a,b){e+="blue,"+b.lat+","+b.lon+"|";c++});var e=e.slice(0,-1),f="";b.polyline&&(f="&polyline=color:0xE5831A|width:3|",a.each(b.polyline,function(a,b){f+=b.lat+","+b.lon+",";d++}),
f=f.slice(0,-1));var h="&bestfit=";d==0&&c==1&&(h="&zoom=7&center="+b.poi[0].lat+","+b.poi[0].lon);return"http://www.mapquestapi.com/staticmap/v3/getmap?key=Fmjtd%7Cluu2nu0tn5%2C8x%3Do5-h01x9"+h+"&size=200,150&type=map&imagetype=jpeg&scalebar=false"+e+f},templates:{smallMemos:{"default":'<div><div id="${m.utilities.cleanMemoId( id )}" class="memo ${service}" data-time="${created_at}">\t<div class="memoTitleBar">\t\t{{if (source_url)}}\t\t\t<a href="${source_url}" class="memoServiceIcon" title="'+
a.i18n.t("Go back to source")+"{{if doc && doc.author && doc.author.name}} ("+a.i18n.t("by","this lane was created by X person")+' ${doc.author.name}){{/if}}"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon" {{if doc && doc.author && doc.author.name}}title="'+a.i18n.t("By","this lane was created by X person")+' ${doc.author.name}"{{/if}}></div>\t\t{{/if}}\t\t{{if (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<a href="/users/${user_id}" class="memoAvatar killEvent" title="'+a.i18n.t("Go to Dashboard")+
'">\t\t\t\t<img src="/users/${user_id}/image.small" height="20" width="20" />\t\t\t</a>\t\t{{/if}}\t</div>\t<div class="memoContent">\t\t{{if doc && doc.image && doc.image.thumbnail}}\t\t\t<img src="${doc.image.thumbnail}" />\t\t{{else}}\t\t\t{{if doc && doc.title && doc.title.text}}\t\t\t\t<p>${doc.title.text}</p>\t\t\t{{/if}}\t\t{{/if}}\t</div>\t<div class="memoFooterBar">\t\t{{if (m.currentUser && m.currentUser.userID == user_id)}}\t\t\t<ul class="memoOwnerActions">\t\t\t\t<li><div class="memo_icon memo_privacy memo_${privacy}">${privacy}</div></li>\t\t\t</ul>\t\t{{/if}}\t\t<ul class="memoActions">\t\t\t<li><div class="memo_icon memo_comments{{if (comment_count)}} memo_comments_show{{/if}}">${comment_count}</div></li>\t\t\t<li><div class="memo_icon memo_like{{if (liked_by_current_user)}} memo_liked_by_current_user{{/if}}{{if (like_count)}} memo_like_show{{/if}}">${like_count}</div></li>\t\t</ul>\t</div></div></div>',
facebook:'<div><div id="${m.utilities.cleanMemoId( id )}" class="memo facebook" data-time="${created_at}">\t<div class="memoTitleBar">\t\t{{if (source_url)}}\t\t\t<a href="${source_url}" class="memoServiceIcon" title="'+a.i18n.t("Go back to source")+'"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon"></div>\t\t{{/if}}\t\t{{if (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<a href="/users/${user_id}" class="memoAvatar killEvent" title="'+a.i18n.t("Go to Dashboard")+'">\t\t\t\t<img src="/users/${user_id}/image.small" height="20" width="20" />\t\t\t</a>\t\t{{/if}}\t</div>\t{{if doc.sub_type == "photo"}}\t\t{{if doc.image.sizes && doc.image.sizes.url}}\t\t\t{{if doc.image.sizes.url.width <= 200}}\t\t\t\t<div class="memoContent" style="height:${doc.image.sizes.url.height}px;">\t\t\t\t\t<img src="${doc.image.url}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t\t\t</div>\t\t\t{{else}}\t\t\t\t<div class="memoContent" style="height:${Math.round((doc.image.sizes.url.height/doc.image.sizes.url.width)*200)}px;">\t\t\t\t\t<img style="width:200px;" src="${doc.image.url}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t\t\t</div>\t\t\t{{/if}}\t\t{{else}}\t\t\t<div class="memoContent fixed-photo-height">\t\t\t\t<img src="${doc.image.url}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t\t</div>\t\t{{/if}}\t{{else}}\t\t<div class="memoContent {{if doc.sub_type == "photo"}}memo-fixed-photo-height{{/if}}">\t\t\t{{if doc.sub_type == "status"}}\t\t\t\t<p>${doc.title.text}</p>\t\t\t{{/if}}\t\t\t{{if doc.sub_type == "event"}}\t\t\t\t<h3>${doc.title.text}</h3>\t\t\t\t<p>${m.utilities.dateFormat( created_at * 1000, "fullDatePlusTime" ).replace("-", "&middot;")}</p>\t\t\t{{/if}}\t\t\t{{if doc.sub_type == "note"}}\t\t\t\t<h3>${doc.title.text}</h3>\t\t\t\t<p>${jQuery(doc.text.text).text().substr(0, 200) +"..."}</p>\t\t\t{{/if}}\t\t\t{{if doc.sub_type == "link"}}\t\t\t\t{{if doc.title && doc.title.text}}<p style="padding:0 0 10px 0; margin:10px 10px 0 10px; border-bottom:1px solid #ddd;">${doc.title.text}</p>{{/if}}\t\t\t\t<p class="aStyle" style="margin-right:10px; padding-right:0; overflow:hidden;">${doc.link.name}</p>\t\t\t{{/if}}\t\t\t{{if doc.sub_type == "video" && doc.video.thumbnail}}\t\t\t\t<img src="${doc.video.thumbnail}" style="height:150px;" />\t\t\t\t<img src="/img/lane/icon-video.png" class="small-memo-video" alt="video link" />\t\t\t{{/if}}\t\t</div>\t{{/if}}\t<div class="memoFooterBar">\t\t{{if (m.currentUser && m.currentUser.userID == user_id)}}\t\t\t<ul class="memoOwnerActions">\t\t\t\t<li><div class="memo_icon memo_privacy memo_${privacy}">${privacy}</div></li>\t\t\t</ul>\t\t{{/if}}\t\t<ul class="memoActions">\t\t\t<li><div class="memo_icon memo_comments{{if (comment_count)}} memo_comments_show{{/if}}">${comment_count}</div></li>\t\t\t<li><div class="memo_icon memo_like{{if (liked_by_current_user)}} memo_liked_by_current_user{{/if}}{{if (like_count)}} memo_like_show{{/if}}">${like_count}</div></li>\t\t</ul>\t</div></div></div>',
"facebook-pages":'<div><div id="${m.utilities.cleanMemoId( id )}" class="memo facebook-pages" data-time="${created_at}">\t<div class="memoTitleBar">\t\t{{if (source_url)}}\t\t\t<a href="${source_url}" class="memoServiceIcon" title="'+a.i18n.t("Go back to source")+'"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon"></div>\t\t{{/if}}\t\t{{if (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<a href="/users/${user_id}" class="memoAvatar killEvent" title="'+a.i18n.t("Go to Dashboard")+'">\t\t\t\t<img src="/users/${user_id}/image.small" height="20" width="20" />\t\t\t</a>\t\t{{/if}}\t</div>\t{{if doc.sub_type == "photo"}}\t\t{{if doc.image.sizes && doc.image.sizes.url}}\t\t\t{{if doc.image.sizes.url.width <= 200}}\t\t\t\t<div class="memoContent" style="height:${doc.image.sizes.url.height}px;">\t\t\t\t\t<img src="${doc.image.url}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t\t\t</div>\t\t\t{{else}}\t\t\t\t<div class="memoContent" style="height:${Math.round((doc.image.sizes.url.height/doc.image.sizes.url.width)*200)}px;">\t\t\t\t\t<img style="width:200px;" src="${doc.image.url}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t\t\t</div>\t\t\t{{/if}}\t\t{{else}}\t\t\t<div class="memoContent fixed-photo-height">\t\t\t\t<img src="${doc.image.url}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t\t</div>\t\t{{/if}}\t{{else}}\t\t<div class="memoContent {{if doc.sub_type == "photo"}}memo-fixed-photo-height{{/if}}">\t\t\t{{if doc.sub_type == "status"}}\t\t\t\t<p>${doc.title.text}</p>\t\t\t{{/if}}\t\t\t{{if doc.sub_type == "event"}}\t\t\t\t<h3>${doc.title.text}</h3>\t\t\t\t<p>${m.utilities.dateFormat( created_at * 1000, "fullDatePlusTime" ).replace("-", "&middot;")}</p>\t\t\t{{/if}}\t\t\t{{if doc.sub_type == "note"}}\t\t\t\t<h3>${doc.title.text}</h3>\t\t\t\t<p>${jQuery(doc.text.text).text().substr(0, 200) +"..."}</p>\t\t\t{{/if}}\t\t\t{{if doc.sub_type == "link"}}\t\t\t\t{{if doc.title && doc.title.text}}<p style="padding:0 0 10px 0; margin:10px 10px 0 10px; border-bottom:1px solid #ddd;">${doc.title.text}</p>{{/if}}\t\t\t\t<p class="aStyle" style="margin-right:10px; padding-right:0; overflow:hidden;">${doc.link.name}</p>\t\t\t{{/if}}\t\t\t{{if doc.sub_type == "video" && doc.video.thumbnail}}\t\t\t\t<img src="${doc.video.thumbnail}" style="height:150px;" />\t\t\t\t<img src="/img/lane/icon-video.png" class="small-memo-video" alt="video link" />\t\t\t{{/if}}\t\t</div>\t{{/if}}\t<div class="memoFooterBar">\t\t{{if (m.currentUser && m.currentUser.userID == user_id)}}\t\t\t<ul class="memoOwnerActions">\t\t\t\t<li><div class="memo_icon memo_privacy memo_${privacy}">${privacy}</div></li>\t\t\t</ul>\t\t{{/if}}\t\t<ul class="memoActions">\t\t\t<li><div class="memo_icon memo_comments{{if (comment_count)}} memo_comments_show{{/if}}">${comment_count}</div></li>\t\t\t<li><div class="memo_icon memo_like{{if (liked_by_current_user)}} memo_liked_by_current_user{{/if}}{{if (like_count)}} memo_like_show{{/if}}">${like_count}</div></li>\t\t</ul>\t</div></div></div>',
feed:'<div><div id="${m.utilities.cleanMemoId( id )}" class="memo feed" data-time="${created_at}">\t<div class="memoTitleBar">\t\t{{if (source_url)}}\t\t\t<a href="${source_url}" class="memoServiceIcon" title="'+a.i18n.t("Go back to source")+'"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon"></div>\t\t{{/if}}\t\t{{if (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<a href="/users/${user_id}" class="memoAvatar killEvent" title="'+a.i18n.t("Go to Dashboard")+'">\t\t\t\t<img src="/users/${user_id}/image.small" height="20" width="20" />\t\t\t</a>\t\t{{/if}}\t</div>\t<div class="memoContent">\t\t{{if doc && doc.category && doc.category.text}}\t\t\t<div class="memoHeaderHTML">\t\t\t\t${doc.category.text}\t\t\t\t{{if doc.title && doc.title.text}}\t\t\t\t\t<br />${doc.title.text}\t\t\t\t{{/if}}\t\t\t</div>\t\t{{/if}}\t\t{{if doc.custom_preview}}\t\t\t<span id="custom_preview">{{html doc.custom_preview}}</span>\t\t{{else doc && doc.text && doc.text.text}}\t\t\t{{html m.laneLoadMemos.pullImageFromHTML( doc.text.text )}}\t\t{{/if}}\t</div>\t<div class="memoFooterBar">\t\t{{if (m.currentUser && m.currentUser.userID == user_id)}}\t\t\t<ul class="memoOwnerActions">\t\t\t\t<li><div class="memo_icon memo_privacy memo_${privacy}">${privacy}</div></li>\t\t\t</ul>\t\t{{/if}}\t\t<ul class="memoActions">\t\t\t<li><div class="memo_icon memo_comments{{if (comment_count)}} memo_comments_show{{/if}}">${comment_count}</div></li>\t\t\t<li><div class="memo_icon memo_like{{if (liked_by_current_user)}} memo_liked_by_current_user{{/if}}{{if (like_count)}} memo_like_show{{/if}}">${like_count}</div></li>\t\t</ul>\t</div></div></div>',
flickr:'<div><div id="${m.utilities.cleanMemoId( id )}" class="memo flickr" data-time="${created_at}">\t<div class="memoTitleBar">\t\t{{if (source_url)}}\t\t\t<a href="${source_url}" class="memoServiceIcon" title="'+a.i18n.t("Go back to source")+'"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon"></div>\t\t{{/if}}\t\t{{if (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<a href="/users/${user_id}" class="memoAvatar killEvent" title="'+a.i18n.t("Go to Dashboard")+'">\t\t\t\t<img src="/users/${user_id}/image.small" height="20" width="20" />\t\t\t</a>\t\t{{/if}}\t</div>\t{{if doc.sub_type == "image"}}\t\t{{if doc.image.sizes && doc.image.sizes.thumbnail}}\t\t\t{{if doc.image.sizes.thumbnail.width <= 200}}\t\t\t\t<div class="memoContent" style="height:${doc.image.sizes.thumbnail.height}px;">\t\t\t\t\t<img src="${doc.image.thumbnail}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t\t\t</div>\t\t\t{{else}}\t\t\t\t<div class="memoContent" style="height:${Math.round((doc.image.sizes.thumbnail.height/doc.image.sizes.thumbnail.width)*200)}px;">\t\t\t\t\t<img style="width:200px;" src="${doc.image.thumbnail}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t\t\t</div>\t\t\t{{/if}}\t\t{{else}}\t\t\t<div class="memoContent fixed-photo-height">\t\t\t\t<img src="${doc.image.thumbnail}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t\t</div>\t\t{{/if}}\t{{else}}\t\t<div class="memoContent">\t\t\t<img style="height:150px;" src="${doc.video.thumbnail}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t\t<img src="/img/lane/icon-video.png" class="small-memo-video" alt="video link" />\t\t</div>\t{{/if}}\t<div class="memoFooterBar">\t\t{{if (m.currentUser && m.currentUser.userID == user_id)}}\t\t\t<ul class="memoOwnerActions">\t\t\t\t<li><div class="memo_icon memo_privacy memo_${privacy}">${privacy}</div></li>\t\t\t</ul>\t\t{{/if}}\t\t<ul class="memoActions">\t\t\t<li><div class="memo_icon memo_comments{{if (comment_count)}} memo_comments_show{{/if}}">${comment_count}</div></li>\t\t\t<li><div class="memo_icon memo_like{{if (liked_by_current_user)}} memo_liked_by_current_user{{/if}}{{if (like_count)}} memo_like_show{{/if}}">${like_count}</div></li>\t\t</ul>\t</div></div></div>',
foursquare:'<div><div id="${m.utilities.cleanMemoId( id )}" class="memo foursquare" data-time="${created_at}">\t<div class="memoTitleBar">\t\t{{if (source_url)}}\t\t\t<a href="${source_url}" class="memoServiceIcon" title="'+a.i18n.t("Go back to source")+'"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon"></div>\t\t{{/if}}\t\t{{if (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<a href="/users/${user_id}" class="memoAvatar killEvent" title="'+a.i18n.t("Go to Dashboard")+'">\t\t\t\t<img src="/users/${user_id}/image.small" height="20" width="20" />\t\t\t</a>\t\t{{/if}}\t</div>\t<div class="memoContent">\t\t{{if doc.title && doc.title.text}}<p>At ${doc.title.text}</p>{{/if}}\t\t<img src="${m.laneLoadMemos.mapquestMapImageURL( doc.geo )}" width="200" height="150"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t</div>\t<div class="memoFooterBar">\t\t{{if (m.currentUser && m.currentUser.userID == user_id)}}\t\t\t<ul class="memoOwnerActions">\t\t\t\t<li><div class="memo_icon memo_privacy memo_${privacy}">${privacy}</div></li>\t\t\t</ul>\t\t{{/if}}\t\t<ul class="memoActions">\t\t\t<li><div class="memo_icon memo_comments{{if (comment_count)}} memo_comments_show{{/if}}">${comment_count}</div></li>\t\t\t<li><div class="memo_icon memo_like{{if (liked_by_current_user)}} memo_liked_by_current_user{{/if}}{{if (like_count)}} memo_like_show{{/if}}">${like_count}</div></li>\t\t</ul>\t</div></div></div>',
instagram:'<div><div id="${m.utilities.cleanMemoId( id )}" class="memo instagram" data-time="${created_at}">\t<div class="memoTitleBar">\t\t{{if (source_url)}}\t\t\t<a href="${source_url}" class="memoServiceIcon" title="'+a.i18n.t("Go back to source")+'"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon"></div>\t\t{{/if}}\t\t{{if (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<a href="/users/${user_id}" class="memoAvatar killEvent" title="'+a.i18n.t("Go to Dashboard")+'">\t\t\t\t<img src="/users/${user_id}/image.small" height="20" width="20" />\t\t\t</a>\t\t{{/if}}\t</div>\t<div class="memoContent">\t\t<img src="${doc.image.thumbnail}"{{if doc.title && doc.title.text}} title="${doc.title.text}"{{else}} title="Instagram photo"{{/if}} height="150" width="150" />\t</div>\t<div class="memoFooterBar">\t\t{{if (m.currentUser && m.currentUser.userID == user_id)}}\t\t\t<ul class="memoOwnerActions">\t\t\t\t<li><div class="memo_icon memo_privacy memo_${privacy}">${privacy}</div></li>\t\t\t</ul>\t\t{{/if}}\t\t<ul class="memoActions">\t\t\t<li><div class="memo_icon memo_comments{{if (comment_count)}} memo_comments_show{{/if}}">${comment_count}</div></li>\t\t\t<li><div class="memo_icon memo_like{{if (liked_by_current_user)}} memo_liked_by_current_user{{/if}}{{if (like_count)}} memo_like_show{{/if}}">${like_count}</div></li>\t\t</ul>\t</div></div></div>',
lastfm:'<div><div id="${m.utilities.cleanMemoId( id )}" class="memo lastfm" data-time="${created_at}">\t<div class="memoTitleBar">\t\t{{if (source_url)}}\t\t\t<a href="${source_url}" class="memoServiceIcon" title="'+a.i18n.t("Go back to source")+'"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon"></div>\t\t{{/if}}\t\t{{if (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<a href="/users/${user_id}" class="memoAvatar killEvent" title="'+a.i18n.t("Go to Dashboard")+'">\t\t\t\t<img src="/users/${user_id}/image.small" height="20" width="20" />\t\t\t</a>\t\t{{/if}}\t</div>\t<div class="memoContent">\t\t{{if (doc.track && doc.track.artist && doc.track.artist.thumbnail)}}\t\t\t<div class="lastfmImgMask">\t\t\t\t<img src="${doc.track.artist.thumbnail}" alt="'+
a.i18n.t("By")+' ${doc.track.artist.name}" />\t\t\t\t<h3>${doc.track.artist.name}</h3>\t\t\t\t<p>${doc.track.name}</p>\t\t\t</div>\t\t{{else}}\t\t\t<div style="margin:10px;">\t\t\t\t<h3>${doc.track.artist.name}</h3>\t\t\t\t<p>${doc.track.name}</p>\t\t\t</div>\t\t{{/if}}\t</div>\t<div class="memoFooterBar">\t\t{{if (m.currentUser && m.currentUser.userID == user_id)}}\t\t\t<ul class="memoOwnerActions">\t\t\t\t<li><div class="memo_icon memo_privacy memo_${privacy}">${privacy}</div></li>\t\t\t</ul>\t\t{{/if}}\t\t<ul class="memoActions">\t\t\t<li><div class="memo_icon memo_comments{{if (comment_count)}} memo_comments_show{{/if}}">${comment_count}</div></li>\t\t\t<li><div class="memo_icon memo_like{{if (liked_by_current_user)}} memo_liked_by_current_user{{/if}}{{if (like_count)}} memo_like_show{{/if}}">${like_count}</div></li>\t\t</ul>\t</div></div></div>',
myspace:'<div><div id="${m.utilities.cleanMemoId( id )}" class="memo myspace" data-time="${created_at}">\t<div class="memoTitleBar">\t\t{{if (source_url)}}\t\t\t<a href="${source_url}" class="memoServiceIcon" title="'+a.i18n.t("Go back to source")+'"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon"></div>\t\t{{/if}}\t\t{{if (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<a href="/users/${user_id}" class="memoAvatar killEvent" title="'+a.i18n.t("Go to Dashboard")+'">\t\t\t\t<img src="/users/${user_id}/image.small" height="20" width="20" />\t\t\t</a>\t\t{{/if}}\t</div>\t<div class="memoContent">\t\t{{if doc.sub_type == "mood"}}\t\t\t<p>{{if doc.title && doc.title.thumbnail}}<img src="${doc.title.thumbnail}" alt="mood image" style="padding-right:5px; float:left;" />{{/if}}${doc.title.text}</p>\t\t{{/if}}\t\t{{if doc.sub_type == "photo"}}\t\t\t<img class="memo-mainPhoto" src="${doc.image.url}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t{{/if}}\t\t{{if doc.sub_type == "video"}}\t\t\t<img style="height:150px;" src="${doc.video.thumbnail}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t\t<img src="/img/lane/icon-video.png" class="small-memo-video" alt="video link" />\t\t{{/if}}\t</div>\t<div class="memoFooterBar">\t\t{{if (m.currentUser && m.currentUser.userID == user_id)}}\t\t\t<ul class="memoOwnerActions">\t\t\t\t<li><div class="memo_icon memo_privacy memo_${privacy}">${privacy}</div></li>\t\t\t</ul>\t\t{{/if}}\t\t<ul class="memoActions">\t\t\t<li><div class="memo_icon memo_comments{{if (comment_count)}} memo_comments_show{{/if}}">${comment_count}</div></li>\t\t\t<li><div class="memo_icon memo_like{{if (liked_by_current_user)}} memo_liked_by_current_user{{/if}}{{if (like_count)}} memo_like_show{{/if}}">${like_count}</div></li>\t\t</ul>\t</div></div></div>',
picasa:'<div><div id="${m.utilities.cleanMemoId( id )}" class="memo picasa" data-time="${created_at}">\t<div class="memoTitleBar">\t\t{{if (source_url)}}\t\t\t<a href="${source_url}" class="memoServiceIcon" title="'+a.i18n.t("Go back to source")+'"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon"></div>\t\t{{/if}}\t\t{{if (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<a href="/users/${user_id}" class="memoAvatar killEvent" title="'+a.i18n.t("Go to Dashboard")+'">\t\t\t\t<img src="/users/${user_id}/image.small" height="20" width="20" />\t\t\t</a>\t\t{{/if}}\t</div>\t{{if doc.image.sizes && doc.image.sizes.thumbnail}}\t\t{{if doc.image.sizes.thumbnail.width <= 200}}\t\t\t<div class="memoContent" style="height:${doc.image.sizes.thumbnail.height}px;">\t\t\t\t<img src="${doc.image.thumbnail}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t\t</div>\t\t{{else}}\t\t\t<div class="memoContent" style="height:${Math.round((doc.image.sizes.thumbnail.height/doc.image.sizes.thumbnail.width)*200)}px;">\t\t\t\t<img style="width:200px;" src="${doc.image.thumbnail}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t\t</div>\t\t{{/if}}\t{{else}}\t\t<div class="memoContent fixed-photo-height">\t\t\t<img src="{{if doc.image.thumbnail}}${doc.image.thumbnail}{{else}}${doc.image.url}{{/if}}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t</div>\t{{/if}}\t<div class="memoFooterBar">\t\t{{if (m.currentUser && m.currentUser.userID == user_id)}}\t\t\t<ul class="memoOwnerActions">\t\t\t\t<li><div class="memo_icon memo_privacy memo_${privacy}">${privacy}</div></li>\t\t\t</ul>\t\t{{/if}}\t\t<ul class="memoActions">\t\t\t<li><div class="memo_icon memo_comments{{if (comment_count)}} memo_comments_show{{/if}}">${comment_count}</div></li>\t\t\t<li><div class="memo_icon memo_like{{if (liked_by_current_user)}} memo_liked_by_current_user{{/if}}{{if (like_count)}} memo_like_show{{/if}}">${like_count}</div></li>\t\t</ul>\t</div></div></div>',
soundcloud:'<div><div id="${m.utilities.cleanMemoId( id )}" class="memo soundcloud" data-time="${created_at}">\t<div class="memoTitleBar">\t\t{{if (source_url)}}\t\t\t<a href="${source_url}" class="memoServiceIcon" title="'+a.i18n.t("Go back to source")+'"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon"></div>\t\t{{/if}}\t\t{{if (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<a href="/users/${user_id}" class="memoAvatar killEvent" title="'+a.i18n.t("Go to Dashboard")+'">\t\t\t\t<img src="/users/${user_id}/image.small" height="20" width="20" />\t\t\t</a>\t\t{{/if}}\t</div>\t<div class="memoContent">\t\t<p>${doc.title.text}</p>\t\t{{if doc.waveform && doc.waveform.url}}<img src="${doc.waveform.url}" class="soundcloud-waveform" width="200" height="31" title="waveform for this track" />{{/if}}\t</div>\t<div class="memoFooterBar">\t\t{{if (m.currentUser && m.currentUser.userID == user_id)}}\t\t\t<ul class="memoOwnerActions">\t\t\t\t<li><div class="memo_icon memo_privacy memo_${privacy}">${privacy}</div></li>\t\t\t</ul>\t\t{{/if}}\t\t<ul class="memoActions">\t\t\t<li><div class="memo_icon memo_comments{{if (comment_count)}} memo_comments_show{{/if}}">${comment_count}</div></li>\t\t\t<li><div class="memo_icon memo_like{{if (liked_by_current_user)}} memo_liked_by_current_user{{/if}}{{if (like_count)}} memo_like_show{{/if}}">${like_count}</div></li>\t\t</ul>\t</div></div></div>',
tripit:'<div><div id="${m.utilities.cleanMemoId( id )}" class="memo tripit" data-time="${created_at}">\t<div class="memoTitleBar">\t\t{{if (source_url)}}\t\t\t<a href="${source_url}" class="memoServiceIcon" title="'+a.i18n.t("Go back to source")+'"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon"></div>\t\t{{/if}}\t\t{{if (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<a href="/users/${user_id}" class="memoAvatar killEvent" title="'+a.i18n.t("Go to Dashboard")+'">\t\t\t\t<img src="/users/${user_id}/image.small" height="20" width="20" />\t\t\t</a>\t\t{{/if}}\t</div>\t<div class="memoContent">\t\t<p style="text-align:center;">\t\t{{each doc.geo.poi}}\t\t\t${$value.name.substr(-3)}\t\t\t{{if $index < (doc.geo.poi.length - 1)}}<strong class="tripArrow">&rarr;</strong>{{/if}}\t\t{{/each}}\t\t</p>\t\t<img src="${m.laneLoadMemos.mapquestMapImageURL( doc.geo )}" width="200" height="150"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t</div>\t<div class="memoFooterBar">\t\t{{if (m.currentUser && m.currentUser.userID == user_id)}}\t\t\t<ul class="memoOwnerActions">\t\t\t\t<li><div class="memo_icon memo_privacy memo_${privacy}">${privacy}</div></li>\t\t\t</ul>\t\t{{/if}}\t\t<ul class="memoActions">\t\t\t<li><div class="memo_icon memo_comments{{if (comment_count)}} memo_comments_show{{/if}}">${comment_count}</div></li>\t\t\t<li><div class="memo_icon memo_like{{if (liked_by_current_user)}} memo_liked_by_current_user{{/if}}{{if (like_count)}} memo_like_show{{/if}}">${like_count}</div></li>\t\t</ul>\t</div></div></div>',
twitter:'<div><div id="${m.utilities.cleanMemoId( id )}" class="memo twitter" data-time="${created_at}">\t<div class="memoTitleBar">\t\t{{if (source_url)}}\t\t\t<a href="${source_url}" class="memoServiceIcon" title="Go back to source{{if doc.author && doc.author.name}} (by ${doc.author.name}){{/if}}"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon" {{if doc.author && doc.author.name}}title="'+a.i18n.t("By")+' ${doc.author.name}"{{/if}}></div>\t\t{{/if}}\t\t{{if (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<a href="/users/${user_id}" class="memoAvatar killEvent" title="'+
a.i18n.t("Go to Dashboard")+'">\t\t\t\t<img src="/users/${user_id}/image.small" height="20" width="20" />\t\t\t</a>\t\t{{/if}}\t</div>\t{{if doc.image}}\t\t{{if doc.image.sizes && doc.image.sizes.thumbnail}}\t\t\t{{if doc.image.sizes.thumbnail.width <= 200}}\t\t\t\t<div class="memoContent" style="height:${doc.image.sizes.thumbnail.height}px;">\t\t\t\t\t<img src="${doc.image.thumbnail}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t\t\t</div>\t\t\t{{else}}\t\t\t\t<div class="memoContent" style="height:${Math.round((doc.image.sizes.thumbnail.height/doc.image.sizes.thumbnail.width)*200)}px;">\t\t\t\t\t<img style="width:200px;" src="${doc.image.thumbnail}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t\t\t</div>\t\t\t{{/if}}\t\t{{else}}\t\t\t<div class="memoContent fixed-photo-height">\t\t\t\t<img src="{{if doc.image.thumbnail}}${doc.image.thumbnail}{{else}}${doc.image.url}{{/if}}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t\t</div>\t\t{{/if}}\t{{else}}\t\t<div class="memoContent">\t\t\t<p>{{html m.utilities.convertURLstringsToAnchors( doc.title.text, true )}}</p>\t\t</div>\t{{/if}}\t<div class="memoFooterBar">\t\t{{if (m.currentUser && m.currentUser.userID == user_id)}}\t\t\t<ul class="memoOwnerActions">\t\t\t\t<li><div class="memo_icon memo_privacy memo_${privacy}">${privacy}</div></li>\t\t\t</ul>\t\t{{/if}}\t\t<ul class="memoActions">\t\t\t<li><div class="memo_icon memo_comments{{if (comment_count)}} memo_comments_show{{/if}}">${comment_count}</div></li>\t\t\t<li><div class="memo_icon memo_like{{if (liked_by_current_user)}} memo_liked_by_current_user{{/if}}{{if (like_count)}} memo_like_show{{/if}}">${like_count}</div></li>\t\t</ul>\t</div></div></div>',
vimeo:'<div><div id="${m.utilities.cleanMemoId( id )}" class="memo vimeo" data-time="${created_at}">\t<div class="memoTitleBar">\t\t{{if (source_url)}}\t\t\t<a href="${source_url}" class="memoServiceIcon" title="'+a.i18n.t("Go back to source")+'"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon"></div>\t\t{{/if}}\t\t{{if (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<a href="/users/${user_id}" class="memoAvatar killEvent" title="'+a.i18n.t("Go to Dashboard")+'">\t\t\t\t<img src="/users/${user_id}/image.small" height="20" width="20" />\t\t\t</a>\t\t{{/if}}\t</div>\t<div class="memoContent">\t\t{{if doc.video && doc.video.thumbnail}}\t\t\t<img style="height:150px;" src="${doc.video.thumbnail}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t\t<img src="/img/lane/icon-video.png" class="small-memo-video" alt="video link" />\t\t{{/if}}\t</div>\t<div class="memoFooterBar">\t\t{{if (m.currentUser && m.currentUser.userID == user_id)}}\t\t\t<ul class="memoOwnerActions">\t\t\t\t<li><div class="memo_icon memo_privacy memo_${privacy}">${privacy}</div></li>\t\t\t</ul>\t\t{{/if}}\t\t<ul class="memoActions">\t\t\t<li><div class="memo_icon memo_comments{{if (comment_count)}} memo_comments_show{{/if}}">${comment_count}</div></li>\t\t\t<li><div class="memo_icon memo_like{{if (liked_by_current_user)}} memo_liked_by_current_user{{/if}}{{if (like_count)}} memo_like_show{{/if}}">${like_count}</div></li>\t\t</ul>\t</div></div></div>',
wordpress:'<div><div id="${m.utilities.cleanMemoId( id )}" class="memo wordpress" data-time="${created_at}">\t<div class="memoTitleBar">\t\t{{if (source_url)}}\t\t\t<a href="${source_url}" class="memoServiceIcon" title="'+a.i18n.t("Go back to source")+'"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon"></div>\t\t{{/if}}\t\t{{if (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<a href="/users/${user_id}" class="memoAvatar killEvent" title="'+a.i18n.t("Go to Dashboard")+'">\t\t\t\t<img src="/users/${user_id}/image.small" height="20" width="20" />\t\t\t</a>\t\t{{/if}}\t</div>\t<div class="memoContent">\t\t{{if doc}}\t\t\t{{if doc.category && doc.category.text}}\t\t\t\t<div class="memoHeaderHTML">\t\t\t\t\t${doc.category.text}\t\t\t\t\t{{if doc.title && doc.title.text}}\t\t\t\t\t\t<br />${doc.title.text}\t\t\t\t\t{{/if}}\t\t\t\t</div>\t\t\t{{/if}}\t\t\t{{if doc.text && doc.text.text}}\t\t\t\t{{html m.laneLoadMemos.pullImageFromHTML( doc.text.text )}}\t\t\t{{/if}}\t\t{{/if}}\t</div>\t<div class="memoFooterBar">\t\t{{if (m.currentUser && m.currentUser.userID == user_id)}}\t\t\t<ul class="memoOwnerActions">\t\t\t\t<li><div class="memo_icon memo_privacy memo_${privacy}">${privacy}</div></li>\t\t\t</ul>\t\t{{/if}}\t\t<ul class="memoActions">\t\t\t<li><div class="memo_icon memo_comments{{if (comment_count)}} memo_comments_show{{/if}}">${comment_count}</div></li>\t\t\t<li><div class="memo_icon memo_like{{if (liked_by_current_user)}} memo_liked_by_current_user{{/if}}{{if (like_count)}} memo_like_show{{/if}}">${like_count}</div></li>\t\t</ul>\t</div></div></div>',
youtube:'<div><div id="${m.utilities.cleanMemoId( id )}" class="memo youtube" data-time="${created_at}">\t<div class="memoTitleBar">\t\t{{if (source_url)}}\t\t\t<a href="${source_url}" class="memoServiceIcon" title="'+a.i18n.t("Go back to source")+'"></a>\t\t{{else}}\t\t\t<div class="memoServiceIcon"></div>\t\t{{/if}}\t\t{{if (!m.currentUser || user_id != m.currentUser.userID)}}\t\t\t<a href="/users/${user_id}" class="memoAvatar killEvent" title="'+a.i18n.t("Go to Dashboard")+'">\t\t\t\t<img src="/users/${user_id}/image.small" height="20" width="20" />\t\t\t</a>\t\t{{/if}}\t</div>\t<div class="memoContent">\t\t{{if doc.video && doc.video.thumbnail}}\t\t\t<img src="${doc.video.thumbnail}"{{if doc.title}} title="${doc.title.text}"{{else}}{{if doc.description}} title="${doc.description.text}"{{/if}}{{/if}} />\t\t\t<img src="/img/lane/icon-video.png" class="small-memo-video" alt="video link" />\t\t{{/if}}\t</div>\t<div class="memoFooterBar">\t\t{{if (m.currentUser && m.currentUser.userID == user_id)}}\t\t\t<ul class="memoOwnerActions">\t\t\t\t<li><div class="memo_icon memo_privacy memo_${privacy}">${privacy}</div></li>\t\t\t</ul>\t\t{{/if}}\t\t<ul class="memoActions">\t\t\t<li><div class="memo_icon memo_comments{{if (comment_count)}} memo_comments_show{{/if}}">${comment_count}</div></li>\t\t\t<li><div class="memo_icon memo_like{{if (liked_by_current_user)}} memo_liked_by_current_user{{/if}}{{if (like_count)}} memo_like_show{{/if}}">${like_count}</div></li>\t\t</ul>\t</div></div></div>'}}}}(this,
jQuery,this.undefined);m.laneLoadMemos.initialize();
m.share=function(f,a){return{initialize:function(){a(".shareURL").live(m.clickOrTouchStart,a.proxy(this.shareDialog,this))},hostname:function(){return m.embeddedParams.custom_hostname!=""?m.embeddedParams.custom_hostname:window.location.hostname},pathname:function(a){return a!=null?m.embeddedParams.custom_pathname!=""?(a=a.split("?"),m.embeddedParams.custom_pathname+"?"+a[1]):a:m.embeddedParams.custom_pathname},shareDialog:function(b){var c=a(b.target),d=c.data("share-link"),e=this.hostname(),d=this.pathname(d),
f=window.location.protocol+"//"+e+d.replace(/ /g,"%20");a.tmpl(this.templates.shareLaneDialog,{url:encodeURIComponent(f),shareText:encodeURIComponent(c.data("share-text")),shareDialogText:c.data("share-dialog-text")}).find(".shareFacebook").click(function(b){window.open(a(this).attr("href"),a.i18n.t("Share on Facebook"),"width=600,height=400");b.preventDefault()}).end().find(".shareTwitter").click(function(b){window.open(a(this).attr("href"),a.i18n.t("Share on Twitter"),"width=600,height=400");b.preventDefault()}).end().find("#shortenURL").click(function(){a(this).select()}).end().lightbox_me({centered:true});
a.ajax({url:"/shorten?custom_hostname="+encodeURIComponent(window.location.protocol+"//"+e)+"&path="+encodeURIComponent("/"+d),success:function(b){a("#shareURL").css("visibility","visible").find("#shortenURL").val(b.url).focus().select()}});b.preventDefault()},templates:{shareLaneDialog:'<div id="shareLaneDialog" class="memolaneDialog" style="width:400px">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">${shareDialogText}</div>\t\t<div class="close closeMemolaneDialog">'+a.i18n.t("close",
"close share dialog")+'</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<ul class="shareMemoOptions">\t\t\t<li><a href="http://www.facebook.com/share.php?u=${url}&amp;t=${shareText}" class="shareFacebook">'+a.i18n.t("Facebook","Facebook, the online web application")+'</a></li>\t\t\t<li><a href="http://twitter.com/share?via=memolane&amp;text=${shareText}&amp;url=${url}" class="shareTwitter">'+a.i18n.t("Twitter","Twitter, the online web application")+'</a></li>\t\t\t<li id="shareURL">\t\t\t\t<label>'+
a.i18n.t("Link:","a link to the page the user is sharing")+' <input id="shortenURL" type="text"></label>\t\t\t</li>\t\t</ul>\t</div></div>'}}}(this,jQuery,this.undefined);m.share.initialize();
m.memoComments=function(f,a,b){return{$body:a("body"),$laneViewport:a("#lane-viewport"),currentMemoID:"",totalMemoComments:0,initialize:function(){this.$laneViewport.delegate(".openMemo .memo_comments",m.clickOrTouchEnd,a.proxy(this.openCommentsDialog,this));this.$body.delegate("#memoCommentButton",m.clickOrTouchEnd,a.proxy(this.postComment,this));this.$body.delegate(".commentDelete",m.clickOrTouchEnd,a.proxy(this.deleteComment,this));this.$body.delegate("#memoEnterComment textarea","keyup",function(){a.trim(a(this).val())!=
""?a("#memoCommentButton").removeClass("inactive"):a("#memoCommentButton").addClass("inactive")})},openCommentsDialog:function(c){var d=this;f.location.hash=m.utilities.urlHash.set("showcomments=true");this.currentMemoID=a(c.currentTarget).attr("data-id");var e=a.tmpl(this.templates.dialogs.comments.loading);e.lightbox_me({destroyOnClose:true,onClose:function(){f.location.hash=m.utilities.urlHash.remove("showcomments");m.memos.openMemoCommentsOnPageLoad=b},onLoad:function(){a("#memoCommentsDialog").find("textarea").focus()}});
a(".privacyTooltip").tipsy({gravity:"ne",offset:5}).click(function(){return false});a.ajax({type:"get",url:"/comments/by_memo/"+this.currentMemoID,success:function(b){d.totalMemoComments=b.length;var c={};c.comments=b;b=a.tmpl(d.templates.dialogs.comments.loaded,c).html();e.find("#memoComments").html(b);e.find(".dialogTitle .commentCount").text(d.totalMemoComments).show();d.setCommentContainerHeight()}});c.preventDefault()},postComment:function(b){var d=this,e=a(b.currentTarget);if(e.not(".inactive").length){var f=
e.siblings("textarea"),h=f.val();f.text("");e.addClass("inactive").text(a.i18n.t("Posting...","this is a temporary status to let the user know that their comment is in the process of being posted"));a.ajax({type:"post",url:"/comments/"+d.currentMemoID,data:{lane_id:m.currentLane.id,text:h},success:function(b){b.comment.addedComment=true;var c=a("#memoComments").data("jsp")?"#memoComments .jspPane":"#memoComments";a(c).prepend(a.tmpl(d.templates.dialogs.comments.comment,b.comment).html()).find("li:first").css("background",
"#ffc").hide().fadeIn(1500,function(){var b=a(this);setTimeout(function(){b.css("background","none")},1E3)});a("#memoComments").data("jsp")?a("#memoComments").data("jsp").reinitialise():d.setCommentContainerHeight();d.totalMemoComments++;m.memos.memoStore[m.utilities.cleanMemoId(d.currentMemoID)].comment_count=d.totalMemoComments;f.val("");e.addClass("inactive").text(a.i18n.t("Post Comment","this is the button text that informs the user they can post a comment"));a(".openMemo .commentCount, #memoCommentsDialog .commentCount").text(d.totalMemoComments);
a("#"+m.utilities.cleanMemoId(d.currentMemoID)+" .memo_comments").text(d.totalMemoComments).addClass("memo_comments_show")}})}b.preventDefault()},deleteComment:function(b){var d=this,e=a(b.currentTarget),f=e.parents("li:first"),h=f.attr("data-comment-id");e.removeClass("commentDelete").addClass("commentDeleting");a.ajax({type:"delete",url:"/comments/"+h,success:function(){removeCommentFromInterface(f)},error:function(b){e.addClass("commentDelete").removeClass("commentDeleting");if(b.status==410)removeCommentFromInterface();
else{var c="";c+=b.status==401?a.i18n.t("We're sorry, but it seems there was an error deleting the comment. Make sure you're still logged in and try again."):a.i18n.t("We're sorry, but it seems there was an error deleting the comment. This could be a number of issues, but is likely due to connection problems on your side or server problems on ours.  Your best bet is to wait a bit, reload the page, and try again.");f.append('<div class="notifications badnews-notice" style="position:absolute; top:-1px; right:0; margin-top:0;"><div class="notice-text">'+
c+'<a href="#" class="close-notice" title="'+a.i18n.t("remove this notice","this informs the user that they can click to remove a temporary status message")+'">X</a></div></div>').find(".badnews-notice .close-notice").bind(m.clickOrTouchEnd,function(b){a(this).parents(".badnews-notice").fadeOut(function(){a(this).remove()});b.preventDefault()})}}});removeCommentFromInterface=function(){f.fadeOut(function(){var b=a(this);b.parents("#memoComments");b.remove();a("#memoComments").data("jsp")?d.setCommentContainerHeight():
a("#memoCommentsDialog").trigger("reposition")});d.totalMemoComments--;m.memos.memoStore[m.utilities.cleanMemoId(d.currentMemoID)].comment_count=d.totalMemoComments;a(".openMemo .commentCount, #memoCommentsDialog .commentCount").text(d.totalMemoComments);var b=a("#"+m.utilities.cleanMemoId(d.currentMemoID)+" .memo_comments");d.totalMemoComments==0?(b.removeClass("memo_comments_show"),a(".largeMemoFooterBar .commentCount").text("")):b.text(d.totalMemoComments)};b.preventDefault()},setCommentContainerHeight:function(){function b(){if(e<
d){var c=e-(d-f);a("#memoComments").height(c);a("#memoComments").jScrollPane()}a("#memoCommentsDialog").trigger("reposition")}a("#memoComments").data("jsp")&&a("#memoComments").data("jsp").destroy();a("#memoComments").removeAttr("style");var d=a("#memoCommentsDialog").height(),e=a("body").height()-80,f=a("#memoComments").height();if(!f&&m.memoComments.totalMemoComments)var h=setInterval(function(){if(f=a("#memoComments").height())clearInterval(h),b()},25);else b()},parseCommentText:function(a){return a.replace(/\r\n|\n\r|\r|\n/g,
"<br />")},templates:{dialogs:{comments:{loading:'<div id="memoCommentsDialog" class="memolaneDialog largeMemoDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">'+a.i18n.t("Comments","this is the title for the comments dialog")+' (<span class="commentCount"></span>)</div>\t\t<div class="close closeMemolaneDialog">'+a.i18n.t("close","clicking on this button closes the dialog window")+'</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<div id="memoEnterComment">\t\t{{if m.currentUser}}\t\t\t<textarea placeholder="'+
a.i18n.t("Type your comment here...","placeholder text that prompts the user to leave a comment")+'"></textarea>\t\t\t<a href="#" class="btn-green inactive" id="memoCommentButton">'+a.i18n.t("Post Comment","this is the button text that informs the user they can post a comment")+'</a>\t\t\t<a href="#" class="privacyTooltip" original-title="'+a.i18n.t("Comments can be seen by the same people who can see the memo.  If this is a public memo, anyone can see its comments.  If it's a 'friends only' memo, only the friends of the memo owner can see them.")+
'"><span></span>'+a.i18n.t("Learn about comment privacy")+"</a>\t\t{{else}}\t\t\t"+a.i18n.t('Itchin\' to leave a comment?  Why not <a href="/login">log in</a> or <a href="/signup">sign up</a>?')+'\t\t{{/if}}\t\t</div>\t\t<ul id="memoComments">\t\t\t<li style="text-align:center;"><img src="/img/common/smallLoaderOnGrey.gif" alt="'+a.i18n.t("loading comments...","tells the user the comments they are trying to view are loading")+'" /></li>\t\t</ul>\t</div></div>',loaded:"<div>\t{{tmpl( comments ) m.memoComments.templates.dialogs.comments.comment}}</div>",
comment:'{{if addedComment}}<div>{{/if}}\t<li data-comment-id="${id}">\t\t<div class="commentHeader">\t\t\t{{if m.currentUser && (m.currentUser.userID == memo_owner_id || m.currentUser.userID == poster_id)}}<a href="#" class="commentDelete">'+a.i18n.t("Delete","this tells the user they can delete this comment")+'</a>{{/if}}\t\t\t<a href="/${user.username}" title="{{if m.currentUser && (m.currentUser.userID == poster_id)}}'+a.i18n.t("Comment by you","this informs the user that they made the associated comment on the memo")+
"{{else}}"+a.i18n.t("Comment by ${user.full_name}","this informs the user who made this comment on the given memo")+'{{/if}}"><img src="/${user.username}/image.small" class="float-left" alt="'+a.i18n.t("user avatar","this simply labels the small user image, for those who can't see it")+'" /> {{if m.currentUser && (m.currentUser.userID == poster_id)}}'+a.i18n.t("You said:","this shows that the user who is viewing the comment is also the one who made it")+"{{else}}"+a.i18n.t("${user.full_name} said:",
"this shows who made the given comment")+'{{/if}}</a><br />\t\t\t<div class="commentTime">${m.utilities.dateFormatRelative( created_at )}</div>\t\t</div>\t\t<div class="commentText">{{html m.memoComments.parseCommentText( text )}}</div>\t</li>{{if addedComment}}</div>{{/if}}'}}}}}(this,jQuery,this.undefined);m.memoComments.initialize();$.fn.lightbox_me.defaults.destroyOnClose=true;$.fn.lightbox_me.defaults.centered=true;m.utilities.browser.init();var currentBrowser=m.utilities.browser;
(currentBrowser.browser==="Firefox"&&parseInt($.browser.version,10)<6||currentBrowser.browser==="Opera"&&parseInt($.browser.version,10)<11||currentBrowser.browser==="Explorer"&&parseInt($.browser.version,10)<9)&&$('<div class="notifications badnews-notice"><div class="notice-text">'+$.i18n.t("You appear to be using an older browser. Did it come with a free toaster? Memolane and the internet in general looks better with Explorer 9, Opera 11+, Chrome 12+, Firefox 6+, and Safari 5+, so please consider upgrading and come back to visit. P.S. The irony that we don't support viewing on mobile phones is not lost on us.")+
' <a href="#" class="close-notice">X</a></div></div>').notify({expires:false});
(m.deviceIsIphone||Modernizr.touch&&!m.deviceIsIpad&&!m.deviceIsAndroid||m.deviceIsAndroid&&!navigator.userAgent.toLowerCase().match(/android 3/i))&&$('<div class="notifications badnews-notice"><div class="notice-text">'+$.i18n.t("We're working on shrinking Memolane for mobile phones, in the meantime please check out Memolane on a larger screen. We suggest an iPad, Android tablet, or the desktop or laptop of your choice.")+' <a href="#" class="close-notice">X</a></div></div>').notify({expires:false});
$.ajaxSetup({data:{_csrf:m.csrf}});$.ajaxPrefilter(function(f){f.type.toLowerCase()==="delete"&&(f.data+="&_method=DELETE")});
